(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[798],{1641:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>T});var a=t(5155),n=t(2115),s=t(4991);let o="/lightgun-web";function u(e){return"".concat(o).concat(e)}let l=[],i="#6CA6CD",c="url('".concat(o,"/assets/shooting-gallery/PNG/HUD/crosshair_red_small.png') 16 16, auto"),g="url('".concat(o,"/assets/shooting-gallery/PNG/Objects/shot_brown_large.png') 16 16, auto");var m=t(6259);let h=e=>{let{onStart:r,titleSrc:t,backgroundColor:n,cursor:s}=e;return(0,a.jsx)(m.A,{position:"relative",width:"100vw",height:"100vh",sx:{backgroundColor:n,cursor:"pointer"},display:"flex",justifyContent:"center",alignItems:"center",onClick:r,children:(0,a.jsx)(m.A,{component:"img",src:t,alt:"Warbirds",sx:{width:"auto",height:"100%",cursor:s}})})},p="/assets/shooting-gallery/PNG/HUD/text_",d=["/assets/tappyplane/PNG/Planes/planeBlue1.png","/assets/tappyplane/PNG/Planes/planeGreen1.png","/assets/tappyplane/PNG/Planes/planeRed1.png"],f=["green","red"],x=function(e){var r,t;let{ammo:n,medalCount:s,duckCount:o,enemyCount:l,score:i,crashed:g,frameCount:h,activePowerups:f,cursor:x,canvasRef:y,handleClick:w,handleContext:v,resetGame:k,getImg:C}=e,b=C("medalFrames");return(0,a.jsxs)(m.A,{position:"relative",width:"100vw",height:"100vh",children:[(0,a.jsx)(m.A,{position:"absolute",top:16,left:16,display:"flex",zIndex:1,onClick:v,children:Array.from({length:12}).map((e,r)=>(0,a.jsx)(m.A,{component:"img",src:r<n?u("/assets/tanks/PNG/Retina/tank_bullet5.png"):u("/assets/tanks/PNG/Retina/tank_bullet1.png"),width:64,height:64,sx:{mr:1.5,rotate:"-90deg",cursor:c}},r))}),s>0&&(0,a.jsxs)(m.A,{position:"absolute",top:56,left:16,display:"flex",alignItems:"center",zIndex:1,sx:{cursor:c},children:[(0,a.jsx)(m.A,{component:"img",src:(null==(t=b[0])||null==(r=t[0])?void 0:r.src)||u("/assets/medals/PNG/flat_medal1.png"),width:48,height:48,sx:{mr:2}}),(0,a.jsxs)(m.A,{component:"span",sx:{fontSize:48,color:"white",fontWeight:"bold"},children:["x",s]})]}),o>0&&(0,a.jsxs)(m.A,{position:"absolute",top:112,left:16,display:"flex",alignItems:"center",zIndex:1,sx:{cursor:c},children:[(0,a.jsx)(m.A,{component:"img",src:u("/assets/shooting-gallery/PNG/Objects/duck_brown.png"),width:48,height:48,sx:{mr:2}}),(0,a.jsxs)(m.A,{sx:{fontSize:48,color:"white",fontWeight:"bold"},children:["x",o]})]}),l>0&&(0,a.jsxs)(m.A,{position:"absolute",top:168,left:16,display:"flex",alignItems:"center",zIndex:1,sx:{cursor:c},children:[(0,a.jsx)(m.A,{component:"img",src:d[0],width:48,height:48,sx:{mr:2}}),(0,a.jsxs)(m.A,{sx:{fontSize:48,color:"white",fontWeight:"bold"},children:["x",l]})]}),(0,a.jsxs)(m.A,{position:"absolute",top:16,right:16,display:"flex",alignItems:"center",zIndex:1,children:[(0,a.jsx)(m.A,{component:"img",src:u("/assets/shooting-gallery/PNG/HUD/text_score_small.png"),alt:"Score",sx:{mr:1}}),String(i).split("").map((e,r)=>(0,a.jsx)(m.A,{component:"img",src:u("".concat(p).concat(e,".png")),alt:e,width:24,height:32,sx:{mr:.5}},r))]}),(0,a.jsx)("canvas",{ref:y,onClick:w,onContextMenu:v,style:{display:"block",width:"100%",height:"100%",cursor:x}}),g&&(0,a.jsx)(m.A,{component:"img",src:u("/assets/shooting-gallery/PNG/HUD/text_gameover.png"),alt:"Game Over",onClick:k,sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:450,height:"auto",cursor:c}}),!g&&(0,a.jsx)(m.A,{position:"absolute",bottom:16,right:16,display:"flex",gap:1,zIndex:2,children:Object.keys(f).filter(e=>f[e].expires>h).map(e=>{let r=f[e].expires-h,t=C("powerupImgs")[e].src;return(0,a.jsx)(m.A,{component:"img",src:t,width:64,height:64,sx:{opacity:r<60&&r%10<5?.3:1}},e)})})]})},y=e=>{let{phase:r,countdown:t}=e,n=u("ready"===r?"/assets/shooting-gallery/PNG/HUD/text_ready.png":"/assets/shooting-gallery/PNG/HUD/text_go.png");return(0,a.jsxs)(m.A,{position:"relative",width:"100vw",height:"100vh",sx:{backgroundColor:i},display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[(0,a.jsx)(m.A,{component:"img",src:n,alt:r,sx:{width:300,height:"auto"}}),"ready"===r&&null!=t&&(0,a.jsx)(m.A,{component:"img",src:u("".concat(p).concat(t,".png")),alt:"".concat(t),sx:{mt:2,width:120,height:160,animation:"fadeUp 1s ease-out forwards"}})]})},w=["/assets/tappyplane/PNG/groundDirt.png","/assets/tappyplane/PNG/groundGrass.png","/assets/tappyplane/PNG/groundIce.png","/assets/tappyplane/PNG/groundRock.png","/assets/tappyplane/PNG/groundSnow.png"],v=["/assets/shooting-gallery/PNG/Stall/tree_oak.png","/assets/shooting-gallery/PNG/Stall/tree_pine.png"],k=["/assets/shooting-gallery/PNG/Stall/water1.png","/assets/shooting-gallery/PNG/Stall/water2.png"],C=["/assets/tappyplane/PNG/rock.png","/assets/tappyplane/PNG/rockGrass.png","/assets/tappyplane/PNG/rockIce.png","/assets/tappyplane/PNG/rockSnow.png"],b=["artillery","bomb","coin2x","ducksight","freeze","ghost","homing","hourglass","infiniteAmmo","machineGuns","megaducks","napalm","magnet","shield","shrink","skull","gunjam","sticky","heavy","spray","supermag","thunderstrike","windy","wings"],I=["skull","gunjam","sticky","heavy","windy"],M=["artillery","freeze","supermag","megaducks","napalm","thunderstrike"],P=["/assets/flame/flame_frame_1.png","/assets/flame/flame_frame_2.png","/assets/flame/flame_frame_3.png","/assets/flame/flame_frame_4.png"];function A(e,r,t){let a={artillery:{expires:0},bomb:{expires:0},coin2x:{expires:0},ducksight:{expires:0},freeze:{expires:0},ghost:{expires:0},gunjam:{expires:0},heavy:{expires:0},homing:{expires:0},hourglass:{expires:0},infiniteAmmo:{expires:0},machineGuns:{expires:0},megaducks:{expires:0},magnet:{expires:0},napalm:{expires:0},shield:{expires:0},shrink:{expires:0},skull:{expires:0},spray:{expires:0},sticky:{expires:0},supermag:{expires:0},thunderstrike:{expires:0},windy:{expires:0},wings:{expires:0}};l.forEach(e=>{a[e].expires=1200});let n=(e,r)=>a[e].expires>0&&a[e].expires>r;return{dims:e,assets:r,audio:t,cursor:c,frameCount:0,gameOver:!1,y:.2*e.height,vy:0,groundOffset:0,score:0,ammo:12,medalCount:0,duckCount:0,enemyCount:0,dynamicDensity:.01,enemies:[],airships:[],mountains:[],trees:[],clouds:[],waters:[],shotLakes:new Set,ducks:[],powerups:[],medals:[],cannonballs:[],homingMissiles:[],artilleryShells:[],napalmMissiles:[],napalmTiles:[],burstRemaining:0,burstCooldown:0,puffs:[],sparkEffects:[],bulletHoles:[],floatingScores:[],falling:[],activePowerups:a,shieldFlash:0,screenShake:0,thunderCooldown:0,crashed:!1,crashHandled:!1,groundCrashPuffsLeft:0,planeFrame:0,planeFrameCounter:0,groundIndex:0,planeAngle:0,smokeSpawned:!1,groundContactFrames:0,whooshPlaying:!1,artilleryPlaying:!1,missileThrusterPlaying:!1,textLabels:[],streak:0,ouchFrames:0,ouchExplodeIdx:0,readyTimeout:0,goTimeout:0,beepTimeouts:[],isActive:n,enemySpeed:e=>n("hourglass",e)?2.5:5,groundSpeed:e=>n("hourglass",e)?1:2}}let S=["/assets/tanks/PNG/Retina/tank_explosion2.png","/assets/tanks/PNG/Retina/tank_explosion3.png","/assets/tanks/PNG/Retina/tank_explosion4.png"],_=["/assets/shooting-gallery/PNG/Objects/duck_brown.png","/assets/shooting-gallery/PNG/Objects/duck_white.png","/assets/shooting-gallery/PNG/Objects/duck_yellow.png"],G=["/assets/shooting-gallery/PNG/Objects/duck_outline_brown.png","/assets/shooting-gallery/PNG/Objects/duck_outline_white.png","/assets/shooting-gallery/PNG/Objects/duck_outline_yellow.png"],N=["/assets/shooting-gallery/PNG/Objects/duck_target_brown.png","/assets/shooting-gallery/PNG/Objects/duck_target_white.png","/assets/shooting-gallery/PNG/Objects/duck_target_yellow.png"],E=function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let a;try{a=new Audio;let t=e.split(".").pop()||"",n="mp3"===t?"audio/mpeg":"audio/".concat(t);if(""===a.canPlayType(n))return void console.warn("Skipping audio load, unsupported type: ".concat(n));a.src=u(e),a.loop=r,a.load()}catch(r){console.warn("Failed to create/load Audio:",e,r);return}t.current=a},[e,r]),t},F=e=>{e&&e.current&&e.current.pause()},j=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e&&e.current&&(r.loop?e.current.loop=!0:e.current.loop=!1,void 0!==r.volume?e.current.volume=r.volume:e.current.volume=1,e.current.currentTime=0,e.current.play())},R=function(){let[e,r]=(0,n.useState)(null),t=(0,n.useRef)([]),a=(0,n.useRef)(null),s=(0,n.useRef)(null),[o,m]=(0,n.useState)("title"),h=function(){let e=E("/audio/whistle_fall.ogg",!0),r=E("/audio/explosionCrunch_000.ogg"),t=E("/audio/splash.ogg"),a=E("/audio/drop_003.ogg"),s=E("/audio/drop_004.ogg"),o=E("/audio/explosionCrunch_004.ogg"),u=E("/audio/laserRetro_000.ogg"),l=E("/audio/explosionCrunch_002.ogg"),i=E("/audio/select_003.ogg"),c=E("/audio/laser9.ogg"),g=E("/audio/click_001.ogg"),m=E("/audio/engineCircular_001.ogg",!0),h=E("/audio/freeze.ogg"),p=E("/audio/select_005.ogg"),d=E("/audio/explosionCrunch_002.ogg"),f=E("/audio/explosionCrunch_001.ogg"),x=E("/audio/confirmation_003.ogg"),y=E("/audio/explosionCrunch_000.ogg"),w=E("/audio/powerUp8.ogg"),v=E("/audio/scratch_003.ogg"),k=E("/audio/forceField_002.ogg"),C=E("/audio/phaserDown1.ogg"),b=E("/audio/lowDown.ogg"),I=E("/audio/laser4.ogg"),M=E("/audio/thunderstrike.ogg"),P=E("/audio/thrusterFire_000.ogg",!0),A=E("/audio/whoosh.ogg",!0),S=(0,n.useMemo)(()=>({artillerySfx:e,artilleryExplodeSfx:r,artillerySplashSfx:t,beepSfx:a,boopSfx:s,bombSfx:o,cannonballSfx:u,crashSfx:l,duckSfx:i,enemyHitSfx:c,flapSfx:g,freezeSfx:h,flightSfx:m,gameOverSfx:p,groundTouchSfx:d,homingExplSfx:f,medalSfx:x,napalmExplodeSfx:y,powerupSfx:w,reloadSfx:v,shieldSfx:k,shrinkSfx:C,skullSfx:b,shotSfx:I,thunderSfx:M,thrusterSfx:P,whooshSfx:A}),[e,r,t,a,s,o,u,l,i,c,g,h,m,p,d,f,x,y,w,v,k,C,b,I,M,P,A]),_=(0,n.useCallback)((e,r)=>{let t=S[e];t&&t.current&&j(t,r||{loop:t.current.loop,volume:t.current.volume})},[S]),G=(0,n.useCallback)(e=>{let r=S[e];r&&r.current&&F(r)},[S]),N=(0,n.useCallback)(()=>{Object.values(S).forEach(e=>{e.current&&F(e)})},[S]);return(0,n.useMemo)(()=>({play:_,pause:G,pauseAll:N}),[_,G,N])}(),{play:x,pause:y}=h,R=function(){let[e,r]=(0,n.useState)(!1),t=(0,n.useRef)({});return(0,n.useEffect)(()=>{let e=e=>{let r=new window.Image;return r.src=u(e),r};t.current.airshipFrames=Object.fromEntries(f.map(r=>[r,[1,2,3].map(t=>e("/assets/airships/airship_".concat(r,"_").concat(t,".png")))])),t.current.artilleryImg=e("/assets/tanks/PNG/Retina/tank_bulletFly6.png"),t.current.blackSmokeImgs=Array.from({length:25},(r,t)=>e("/assets/smoke/PNG/Black smoke/blackSmoke".concat(String(t).padStart(2,"0"),".png"))),t.current.brokenStickImg=e("/assets/shooting-gallery/PNG/Objects/stick_wood_broken.png"),t.current.bulletHoleImg=e("/assets/shooting-gallery/PNG/Objects/shot_brown_large.png"),t.current.cannonballImg=e("/assets/pirates/PNG/Retina/Ship parts/cannonBall.png"),t.current.digitImgs={};for(let r=0;r<=9;r++)t.current.digitImgs[r.toString()]=e("".concat(p).concat(r,".png"));t.current.duckImgs=_.map(e),t.current.duckOutlineImgs=G.map(e),t.current.duckTargetImgs=N.map(e),t.current.enemyImgs=d.map(e),t.current.enemyFrames=d.map(r=>[1,2,3].map(t=>e(r.replace(/1\.png$/,"".concat(t,".png"))))),t.current.explosionImgs=S.map(e),t.current.fireImgs=[e("/assets/pirates/PNG/Retina/Effects/fire1.png"),e("/assets/pirates/PNG/Retina/Effects/fire2.png")],t.current.flameImgs=P.map(e),t.current.groundImgs=w.map(e),t.current.homingImg=e("/assets/tanks/PNG/Retina/tank_bullet3.png"),t.current.letterImgs={};for(let r=65;r<=90;r++){let a=String.fromCharCode(r);t.current.letterImgs[a]=e("/assets/tappyplane/PNG/Letters/letter".concat(a,".png"))}t.current.medalFrames=[];for(let r=1;r<=9;r++)t.current.medalFrames.push([e("/assets/medals/PNG/flat_medal".concat(r,".png")),e("/assets/medals/PNG/flatshadow_medal".concat(r,".png")),e("/assets/medals/PNG/shaded_medal".concat(r,".png"))]);t.current.napalmImg=e("/assets/tanks/PNG/Retina/tank_bullet4.png"),t.current.numberImgs={};for(let r=0;r<=9;r++)t.current.numberImgs[r.toString()]=e("/assets/tappyplane/PNG/Numbers/number".concat(r,".png"));t.current.planeFrames=[1,2,3].map(r=>e("/assets/tappyplane/PNG/Planes/planeYellow".concat(r,".png"))),t.current.planeImg=t.current.planeFrames[0],t.current.plusImg=e("/assets/shooting-gallery/PNG/HUD/text_plus_small.png"),t.current.powerupImgs=Object.fromEntries(b.map(r=>[r,e("/assets/powerups/".concat(r,".png"))])),t.current.powerupImgs.coin2x=e("/assets/powerups/coin_2x.png"),t.current.powerupImgs.infiniteAmmo=e("/assets/powerups/infinite_ammo.png"),t.current.powerupImgs.machineGuns=e("/assets/powerups/machine_guns.png"),t.current.powerupImgs.shrink=e("/assets/powerups/shrink_effect.png"),t.current.puffLargeImg=e("/assets/tappyplane/PNG/puffLarge.png"),t.current.puffSmallImg=e("/assets/tappyplane/PNG/puffSmall.png"),t.current.rockImgs=C.map(e),t.current.shieldImg=e("/assets/particles/PNG (Transparent)/circle_03.png"),t.current.sparkImgs=Array.from({length:7},(r,t)=>e("/assets/particles/PNG (Transparent)/spark_0".concat(t+1,".png"))),t.current.stickImg=e("/assets/shooting-gallery/PNG/Objects/stick_wood.png"),t.current.targetImgs=[e("/assets/shooting-gallery/PNG/Objects/target_red1.png"),e("/assets/shooting-gallery/PNG/Objects/target_red2.png"),e("/assets/shooting-gallery/PNG/Objects/target_red3.png")],t.current.treeImgs=v.map(e),t.current.waterImgs=k.map(e),t.current.whitePuffImgs=Array.from({length:25},(r,t)=>e("/assets/smoke/PNG/White puff/whitePuff".concat(String(t).padStart(2,"0"),".png"))),r(!0)},[]),{get:(0,n.useCallback)(e=>t.current[e],[]),getImg:(0,n.useCallback)(e=>{var r;return null!=(r=t.current[e])?r:void 0},[]),assetRefs:t.current,ready:e}}(),{getImg:O}=R,T=function(){let[e,r]=(0,n.useState)({width:0,height:0});return(0,n.useEffect)(()=>{function e(){r({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e}(),z=(0,n.useRef)(A(T,R,h)),L=(0,n.useRef)(!1),[D,H]=(0,n.useState)({score:0,medalCount:0,duckCount:0,enemyCount:0,ammo:12,crashed:!1,frameCount:0,activePowerups:Object.fromEntries(b.map(e=>[e,{expires:0}])),cursor:c}),Y=(0,n.useCallback)(()=>{let e=z.current;(D.score!==e.score||D.medalCount!==e.medalCount||D.duckCount!==e.duckCount||D.enemyCount!==e.enemyCount||D.ammo!==e.ammo||D.crashed!==e.crashed||D.frameCount!==e.frameCount||JSON.stringify(D.activePowerups)!==JSON.stringify(e.activePowerups)||D.cursor!==e.cursor)&&H({score:e.score,medalCount:e.medalCount,duckCount:e.duckCount,enemyCount:e.enemyCount,ammo:e.ammo,crashed:e.crashed,activePowerups:Object.fromEntries(Object.entries(e.activePowerups).map(e=>{let[r,t]=e;return[r,{expires:t.expires}]})),frameCount:e.frameCount,cursor:e.cursor})},[D,H,z]),U=(0,n.useCallback)(e=>{let r=z.current.isActive("coin2x",z.current.frameCount)&&e>0;z.current.score+=r?2*e:e},[z]),B=(0,n.useCallback)(()=>{z.current={...A(T,R,h),groundIndex:Math.floor(Math.random()*O("groundImgs").length)}},[T,R,h,O]),W=(0,n.useCallback)((e,r,t,a,n,s,o)=>{let u=0,l=36*r;Array.from(e).forEach(e=>{if(" "===e)u+=l;else{let t=O("letterImgs"),a=O("numberImgs"),n=O("digitImgs"),s=t[e.toUpperCase()]||a[e]||n[e];s&&(u+=s.width*r+2)}});let i=null!=n?n:(T.width-u)/2,c=null!=s?s:.2*T.height;z.current.textLabels.push({text:e,scale:r,fixed:t,fade:a,x:i,y:c,age:0,maxAge:o||(a?60:1/0)})},[T.width,T.height,O]),X=(0,n.useCallback)((e,r,t)=>{let a=6+Math.floor(4*Math.random());for(let n=0;n<a;n++){let a=Math.random()*Math.PI*2,n=Math.sqrt(Math.random()),s=Math.cos(a)*n*200,o=Math.sin(a)*n*100;z.current.napalmTiles.push({x:e+s,y:r+o,vy:0,life:600,maxLife:600,killsPlayer:t})}x("napalmExplodeSfx")},[x]),q=(0,n.useCallback)((e,r)=>{let t=O("blackSmokeImgs"),a=t[Math.floor(Math.random()*t.length)];z.current.puffs.push({x:e-16,y:r-16,vy:-(+Math.random()+.5),img:a,age:0,maxAge:60})},[O]),J=(0,n.useCallback)((e,r)=>(function(e,r,t,a){let n=3+Math.floor(3*Math.random()),s=50+.1*r*Math.random(),o=[];for(let e=0;e<n;e++){let e=t[Math.floor(Math.random()*t.length)],r=(Math.random()-.5)*200,a=(Math.random()-.5)*50,n=1+.5*Math.random();o.push({img:e,dx:r,dy:a,scale:n})}return{x:e+100,y:s,vx:-1*a()*.3,puffs:o}})(e,r,O("whitePuffImgs"),()=>z.current.groundSpeed(z.current.frameCount)),[O,z]),V=(0,n.useCallback)((e,r)=>(function(e,r,t,a,n,s){let o=e+300*Math.random(),u=200+100*Math.random();return Array.from({length:3+Math.floor(3*Math.random())}).map((n,s)=>{let l=function(e,r,t,a,n,s){let o=t[Math.floor(Math.random()*t.length)],u=1+Math.random()*(2-n),l=u*(.8+.4*Math.random())*3,i=2*u,c=o.width*l,g=o.height*i;return{x:e+200*Math.random(),y:r-50-g,vx:-1*a()*.2,img:o,width:c,height:g,scaleX:l,scaleY:i}}(e,r,t,a,1,2);return l.x=o+s*u*(.8+.4*Math.random()),l})})(e,r,O("rockImgs"),()=>z.current.groundSpeed(z.current.frameCount),0,0),[O,z]),$=(0,n.useCallback)((e,r,t)=>(function(e,r,t,a,n){let s=t[Math.floor(Math.random()*t.length)],o=null!=n?n:.5+Math.random(),u=s.width*o,l=s.height*o;return{x:e+200*Math.random(),y:r-50-l+40,vx:-1*a()*.2,img:s,width:u,height:l,scaleX:o,scaleY:o}})(e,r,O("treeImgs"),()=>z.current.groundSpeed(z.current.frameCount),t),[O,z]),K=(0,n.useCallback)((e,r)=>{x("shotSfx");let t=O("powerupImgs"),a=-8;z.current.isActive("heavy",z.current.frameCount)&&(a*=.5),z.current.isActive("sticky",z.current.frameCount)&&(a=0),z.current.isActive("wings",z.current.frameCount)&&(a*=2),z.current.y;let n=!1;for(let a=0;a<z.current.airships.length;a++){let s=z.current.airships[a],o=80*Math.sin(.05*z.current.frameCount+s.bobOffset),u=s.baseY+o;if(e>=s.x&&e<=s.x+164&&r>=u&&r<=u+164){if(n=!0,z.current.airships.splice(a,1),"green"===s.color){let e=M[Math.floor(Math.random()*M.length)];z.current.powerups.push({x:s.x,y:u,img:t[e],type:e})}else{X(s.x+82,u+82,!0);let e=I[Math.floor(Math.random()*I.length)];z.current.powerups.push({x:s.x,y:u,img:t[e],type:e})}break}}for(let t=0;t<z.current.ducks.length;t++){let a=z.current.ducks[t],s=z.current.isActive("megaducks",z.current.frameCount)?3:z.current.isActive("ducksight",z.current.frameCount)?1.33:1,o=a.width*s,u=a.height*s,l=(o-a.width)/2,i=(u-a.height)/2,c=a.x-l,g=a.y-i;if(!a.hit&&e>=c&&e<=c+o&&r>=g&&r<=g+u){x("duckSfx"),U(1e3),a.hit=!0,a.fadeAge=0,a.fadeMax=60,a.targetImg=O("duckTargetImgs")[a.srcIdx],z.current.floatingScores.push({x:a.x+a.width/2,y:a.y+a.height/2,vy:-1,amount:1e3,age:0,maxAge:60}),z.current.shotLakes.add(a.waterRef),z.current.duckCount+=1,n=!0;break}}for(let t=0;t<z.current.powerups.length;t++){let a=z.current.powerups[t];if(!a.collected&&e>=a.x&&e<=a.x+128&&r>=a.y&&r<=a.y+128){a.collected=!0,["bomb"].includes(a.type)?(x("bombSfx"),z.current.activePowerups.bomb.expires=z.current.frameCount+1):I.includes(a.type)?["sticky","heavy","windy"].includes(a.type)?z.current.activePowerups[a.type].expires=1200:z.current.activePowerups[a.type].expires=z.current.frameCount+30:"machineGuns"===a.type?(z.current.activePowerups.machineGuns.expires=z.current.frameCount+1200,z.current.burstRemaining=5,z.current.burstCooldown=0):"shrink"===a.type?(z.current.activePowerups.shrink.expires=z.current.frameCount+1200,x("shrinkSfx")):"freeze"===a.type?(z.current.activePowerups.freeze.expires=z.current.frameCount+1200,x("freezeSfx")):(z.current.activePowerups[a.type].expires=z.current.frameCount+1200,x("powerupSfx")),"skull"===a.type?(x("skullSfx"),Object.keys(z.current.activePowerups).forEach(e=>{"skull"!==e&&(z.current.activePowerups[e].expires=0)}),U(-500),W("Skull! Lose 500",1,!0,!0,T.width-800,.8*T.height,120)):"gunjam"===a.type&&(z.current.activePowerups.gunjam.expires=z.current.frameCount+1200,U(-25),x("reloadSfx"),W("Gunjam Lose 25",1,!0,!0,T.width-800,.8*T.height,120),z.current.ammo=0),n=!0,z.current.powerups.splice(t,1);break}}for(let t=0;t<z.current.medals.length;t++){let a=z.current.medals[t];if(e>=a.x&&e<=a.x+64&&r>=a.y&&r<=a.y+64){x("medalSfx"),U(500),z.current.floatingScores.push({x:a.x+32,y:a.y+32,vy:-1,amount:500,age:0,maxAge:60}),z.current.medals.splice(t,1),z.current.medalCount+=1,n=!0;break}}let s=O("targetImgs")[0],o=s.width,u=s.height;for(let a of z.current.enemies){let s=a.hasStick?0:101.25-u;if(a.alive&&a.hasStick&&!a.stickBroken&&e>=a.x+67.5-o/2&&e<=a.x+67.5+o/2&&r>=a.y+s&&r<=a.y+s+u&&(n=!0,a.stickBroken=!0,a.targetHit=!0,x("enemyHitSfx"),U(a.targetScore),z.current.floatingScores.push({x:a.x+67.5,y:a.y+s+u/2,vy:-1,amount:a.targetScore,age:0,maxAge:60})),!n&&a.alive&&e>=a.x&&e<=a.x+135&&r>=a.y&&r<=a.y+101.25){n=!0,a.alive=!1,x("enemyHitSfx"),U(100);let e=a.x+67.5,r=a.y+50.625;if(z.current.enemyCount+=1,.3>Math.random()){let t=Math.floor(9*Math.random()),a=O("medalFrames")[t];z.current.medals.push({x:e-32,y:r-32,vx:-z.current.groundSpeed(z.current.frameCount),frames:a,frameIndex:0,frameCounter:0,frameRate:8,id:t+1})}else if(.5>Math.random()){let a=l.length>0?l[Math.floor(Math.random()*l.length)]:b[Math.floor(Math.random()*b.length)];0===l.length&&!I.includes(a)&&.5>Math.random()&&(a=I[Math.floor(Math.random()*I.length)]),z.current.powerups.push({x:e-16,y:r-16,img:t[a],type:a})}z.current.floatingScores.push({x:e,y:r,vy:-1,amount:100,age:0,maxAge:60});let s=O("explosionImgs"),o=Math.floor(3*Math.random());if(0===o)for(let t=0;t<5;t++)setTimeout(()=>q(e,r),100*t);else 1===o?s.forEach((t,a)=>setTimeout(()=>z.current.puffs.push({x:e-16,y:r-16,img:t,vy:0,age:0,maxAge:10,size:96}),50*a)):(z.current.puffs.push({x:e-48,y:r-48,img:s[0],vy:0,age:0,maxAge:10,size:96}),z.current.falling.push({x:a.x,y:a.y,vy:0,img:a.frames[0]}));break}}n||(U(-25),z.current.streak=0,z.current.bulletHoles.push({x:e,y:r,age:0,maxAge:180})),(n||0)&&(z.current.streak+=1,z.current.streak>=3&&W("Streak: ".concat(z.current.streak),1,!0,!0,T.width-800,88,120))},[x,O,z,U,X,W,T.width,T.height,q]),Q=(0,n.useCallback)(e=>!!D.activePowerups[e]&&D.activePowerups[e].expires>D.frameCount,[D.activePowerups,D.frameCount]),Z=(0,n.useCallback)(()=>{s.current&&cancelAnimationFrame(s.current),t.current.forEach(clearTimeout),t.current=[],m("ready"),r(3),t.current.push(window.setTimeout(()=>r(2),1e3),window.setTimeout(()=>r(1),2e3),window.setTimeout(()=>r(null),3e3),window.setTimeout(()=>m("go"),3e3),window.setTimeout(()=>{m("playing"),z.current={...A(T,R,h),groundIndex:Math.floor(Math.random()*O("groundImgs").length)}},3500)),x("flightSfx")},[T,R,h,O,x]),ee=(0,n.useCallback)(()=>{if(console.log("Game initLoop"),L.current)return void console.log("initLoop called, but loop already runningâ€”skipping.");L.current=!0;let e=O("waterImgs");s.current&&cancelAnimationFrame(s.current);let r=a.current;if(!r)return;let t=r.getContext("2d");if(!t)return;let{width:n,height:o}=T;r.width=n,r.height=o,B(),x("flightSfx");let u=o-50,l=O("groundImgs"),c=l[0].width,g=()=>{let a=z.current.isActive("shrink",z.current.frameCount)?.4:1,m=z.current.isActive("freeze",z.current.frameCount)?0:z.current.isActive("hourglass",z.current.frameCount)?.15:.3,h=z.current.isActive("wings",z.current.frameCount)?-16:-8;if(z.current.isActive("thunderstrike",z.current.frameCount)&&(z.current.thunderCooldown-=1,z.current.thunderCooldown<=0)){z.current.thunderCooldown=180;let e=[...z.current.enemies.filter(e=>e.alive)];if(e.length>0){let r=235,t=z.current.y+50.625;e.sort((e,a)=>Math.hypot(r-e.x,t-e.y)-Math.hypot(r-a.x,t-a.y));let a=[],n=e[0];a.push(n);let s=n.x,o=n.y;for(let r=1;r<e.length&&a.length<3;r++)300>Math.hypot(s-e[r].x,o-e[r].y)&&a.push(e[r]);a.forEach((e,r)=>{if("alive"in e&&(e.alive=!1),"hit"in e&&(e.hit=!0),z.current.floatingScores.push({x:e.x,y:e.y,vy:-1,amount:200,age:0,maxAge:60}),U(200),z.current.enemyCount+=1,z.current.sparkEffects.push({x:e.x,y:e.y-50,age:0,maxAge:60,frameIndex:0}),r>0){let r=a[0];z.current.sparkEffects.push({x:(r.x+e.x)/2,y:(r.y+e.y)/2-30,age:0,maxAge:20,frameIndex:0})}}),x("thunderSfx")}}if(z.current.isActive("homing",z.current.frameCount)&&.01>Math.random()){let e=z.current.enemies[0];z.current.homingMissiles.push({x:235,y:z.current.y+50.625,vx:0,vy:0,img:O("homingImg"),tailFrame:0,tailCounter:0,life:120,target:e})}if(z.current.isActive("artillery",z.current.frameCount)&&.02>Math.random()){let e=Math.random()*(n-200)+200,r=Math.PI/2+Math.PI/3*(Math.random()-.5),t=8+4*Math.random();z.current.artilleryShells.push({x:e,y:-32,vx:Math.cos(r)*t,vy:Math.sin(r)*t,img:O("artilleryImg")})}if(z.current.isActive("napalm",z.current.frameCount)&&.005>Math.random()){let e=.1+.19999999999999998*Math.random();z.current.napalmMissiles.push({x:-32,y:o*e,vx:4,life:Math.ceil((n+64)/4),dropsRemaining:6+Math.floor(4*Math.random()),dropTimer:20,img:O("napalmImg"),tailFrame:0,tailCounter:0,explodeX:400+600*Math.random()})}if(z.current.isActive("machineGuns",z.current.frameCount)&&(0===z.current.burstRemaining&&.01>Math.random()&&(z.current.burstRemaining=5,z.current.burstCooldown=0),z.current.burstRemaining>0))if(0===z.current.burstCooldown){let e=z.current.y+50.625;z.current.cannonballs.push({x:235,y:e,vx:12,img:O("cannonballImg")}),x("cannonballSfx"),z.current.burstRemaining--,z.current.burstCooldown=5}else z.current.burstCooldown--;let p=O("planeFrames");z.current.planeFrameCounter++,z.current.planeFrameCounter>=6&&(z.current.planeFrameCounter=0,z.current.planeFrame=(z.current.planeFrame+1)%p.length),z.current.frameCount++;let d=O("enemyFrames");if(Math.random()<z.current.dynamicDensity){let e=Math.floor(Math.random()*d.length),r=.25>Math.random(),t=-1,a=-1;r&&(a=[500,250,100][t=Math.floor(3*Math.random())]),z.current.enemies.push({x:n+135,y:50+Math.random()*(o-200),vy:0,flapStrength:-(8+4*Math.random()),frames:d[e],propFrame:Math.floor(3*Math.random()),frameRate:6,frameCounter:0,alive:!0,glide:!0,loopProgress:-1,baseY:50+Math.random()*(o-200),rotation:0,stepProgress:-1,stepDelta:0,hasStick:r,stickBroken:!1,stickImg:O("stickImg"),brokenStickImg:O("brokenStickImg"),targetImg:r?O("targetImgs")[t]:void 0,targetType:r?"red".concat(t+1):void 0,targetScore:r?a:0,targetFadeAge:0,targetFadeMax:60*!!r,targetHit:!1,targetVy:0})}if(t.fillStyle=i,t.fillRect(0,0,n,o),.001>Math.random()){let e=V(n,o),r=Math.min(...e.map(e=>e.x)),t=Math.max(...e.map(e=>e.x+e.width));z.current.mountains.some(e=>{let a=e.x;return r<e.x+e.width&&a<t})||z.current.mountains.push(...e)}if(z.current.mountains.forEach((e,a)=>{e.x+=e.vx,t.globalAlpha=.8,t.drawImage(e.img,e.x,e.y+40,e.width,e.height),t.globalAlpha=1,e.x+r.width<0&&z.current.mountains.splice(a,1)}),.005>Math.random()&&z.current.trees.push($(n,o)),z.current.trees.forEach((e,a)=>{e.x+=e.vx,t.globalAlpha=.9,t.drawImage(e.img,e.x,e.y,e.width,e.height),t.globalAlpha=1,e.x+e.width+r.width<0&&z.current.trees.splice(a,1)}),.0015>Math.random()&&(z.current.clouds.some(e=>e.x>n)||z.current.clouds.push(J(n,o))),z.current.clouds.forEach((e,a)=>{e.x+=e.vx,e.puffs.forEach(r=>{let{img:a,dx:n,dy:s,scale:o}=r,u=a.width*o,l=a.height*o;t.globalAlpha=.8,t.drawImage(a,e.x+n,e.y+s,u,l)}),t.globalAlpha=1,e.x+1.5*r.width<0&&z.current.clouds.splice(a,1)}),5e-4>Math.random()){let e=f[Math.floor(Math.random()*f.length)],r=o*(.1+.1*Math.random()),t=1+2*Math.random();z.current.airships.push({x:-492,baseY:r,frames:O("airshipFrames")[e],frameIndex:Math.floor(3*Math.random()),frameCounter:0,frameRate:10,speed:t,color:e,bobOffset:Math.random()*Math.PI*2})}z.current.airships=z.current.airships.filter(e=>{e.x+=e.speed;let r=80*Math.sin(.05*z.current.frameCount+e.bobOffset),a=e.baseY+r;e.frameCounter++,e.frameCounter>=e.frameRate&&(e.frameCounter=0,e.frameIndex=(e.frameIndex+1)%e.frames.length);let s=e.frames[e.frameIndex];return t.drawImage(s,e.x,a,164,164),e.x<=n+s.width}),!(z.current.airships.length>0)||z.current.whooshPlaying||z.current.crashed?0===z.current.airships.length&&z.current.whooshPlaying&&(y("whooshSfx"),z.current.whooshPlaying=!1):(x("whooshSfx"),z.current.whooshPlaying=!0),z.current.crashed&&z.current.whooshPlaying&&(y("whooshSfx"),z.current.whooshPlaying=!1),z.current.textLabels.forEach(e=>{t.globalAlpha=e.fade?1-e.age/e.maxAge:1;let r=e.fixed?e.x:e.x-z.current.groundOffset,a=24*e.scale;for(let n of e.text)if(" "===n)r+=a;else{let a=O("letterImgs"),s=O("numberImgs"),o=O("digitImgs"),u=a[n.toUpperCase()]||s[n]||o[n];if(u){let a=u.width*e.scale;t.drawImage(u,r,e.y,a,u.height*e.scale),r+=a+2}}t.globalAlpha=1,e.age++}),z.current.textLabels=z.current.textLabels.filter(e=>e.age<e.maxAge),z.current.bulletHoles.forEach(e=>{t.globalAlpha=1-e.age/e.maxAge,t.drawImage(O("bulletHoleImg"),e.x-16,e.y-16,32,32),e.age++}),z.current.bulletHoles=z.current.bulletHoles.filter(e=>e.age<e.maxAge),t.globalAlpha=1;let w=z.current.isActive("freeze",z.current.frameCount);z.current.enemies.forEach(e=>{let r=e.x+67.5,n=e.y+50.625,s=135*a,o=101.25*a;if(!e.alive)return;if(w||e.glide){if(!w){if(e.loopProgress<0&&.001>Math.random()&&(e.loopProgress=0,e.baseY=e.y),e.loopProgress>=0){let r=e.loopProgress/180*Math.PI*2;e.y=e.baseY+100*Math.sin(r),e.rotation=r,e.loopProgress++,e.loopProgress>180&&(e.loopProgress=-1,e.rotation=0,e.y=e.baseY)}if(e.loopProgress<0){if(e.stepProgress<0&&.005>Math.random()){e.stepProgress=0;let r=u-101.25-50,t=50-e.baseY,a=r-e.baseY;e.stepDelta=Math.min(t+Math.random()*(a-t),150)}if(e.stepProgress>=0){let r=e.stepProgress/60;e.y=e.baseY+e.stepDelta*r;let t=e.stepDelta/60;e.rotation=-1*Math.atan2(t,z.current.enemySpeed(z.current.frameCount)),e.stepProgress++,e.stepProgress>60&&(e.baseY+=e.stepDelta,e.y=e.baseY,e.stepProgress=-1,e.rotation=0)}else e.rotation=0;if(e.stepProgress>=0){let r=e.stepProgress/60;e.y=e.baseY+e.stepDelta*r,e.stepProgress++,e.stepProgress>60&&(e.baseY+=e.stepDelta,e.y=e.baseY,e.stepProgress=-1)}}}}else z.current.frameCount%60==0&&(e.vy=e.flapStrength),e.vy+=m,e.y+=e.vy,e.y+101.25>=u&&(e.y=u-101.25,e.vy=e.flapStrength);if(!w&&z.current.isActive("windy",z.current.frameCount)&&(e.x+=(2*Math.random()-1)*8,e.y+=(2*Math.random()-1)*8,e.flapStrength=-(8+4*Math.random())),!w){let r=Math.cos(e.rotation||0);e.x-=z.current.enemySpeed(z.current.frameCount)*r}e.frameCounter++,e.frameCounter>=e.frameRate&&(e.frameCounter=0,e.propFrame=(e.propFrame+1)%e.frames.length);let l=e.frames[e.propFrame];if(t.save(),t.translate(r,n),e.rotation&&t.rotate(e.rotation),t.scale(-1,1),t.drawImage(l,-s/2,-o/2,s,o),t.restore(),e.hasStick){t.save(),t.translate(r,n),e.rotation&&t.rotate(e.rotation),t.scale(-1,1);let a=.5*e.stickImg.width,s=.5*e.stickImg.height;if(t.save(),t.rotate(Math.PI),t.drawImage(e.stickBroken?e.brokenStickImg:e.stickImg,-a/2,-s,a,s),t.restore(),!e.targetHit){let r=.5*e.targetImg.width,a=.5*e.targetImg.height;t.drawImage(e.targetImg,-r/2,-s+120,r,a)}t.restore()}.02>Math.random()&&q(r,n),e.x+135<0&&(e.alive=!1)}),z.current.enemies=z.current.enemies.filter(e=>e.alive);let v=()=>{z.current.vy=h,z.current.planeAngle=-.5;let e=167.5,r=z.current.y+50.625;z.current.puffs.push({x:e-16,y:r-16,img:O("puffLargeImg"),vy:0,age:0,maxAge:20}),setTimeout(()=>z.current.puffs.push({x:e-16,y:r-16,img:O("puffSmallImg"),vy:0,age:0,maxAge:15}),100)};!z.current.crashed&&.025>Math.random()&&z.current.y>0&&v(),z.current.crashed||(z.current.vy+=m,z.current.y+=z.current.vy,z.current.y+101.25>=u&&v(),z.current.isActive("ghost",z.current.frameCount)||z.current.crashed||z.current.enemies.forEach(e=>{let r=167.5,t=z.current.y+50.625;if(e.x<r+67.5&&e.x+135>r-67.5&&e.y<t+50.625&&e.y+101.25>t-50.625){z.current.crashed=!0,z.current.groundContactFrames=0,e.alive=!1;let r=O("explosionImgs"),t=r[Math.floor(Math.random()*r.length)];z.current.falling.push({x:e.x,y:e.y,vy:0,img:t});let a=r[Math.floor(Math.random()*r.length)];z.current.falling.push({x:100,y:z.current.y,vy:0,img:a})}}),z.current.crashed&&!z.current.isActive("ghost",z.current.frameCount)&&(z.current.isActive("shield",z.current.frameCount)?(z.current.activePowerups.shield.expires=0,z.current.shieldFlash=10,z.current.crashed=!1,x("shieldSfx")):(z.current.crashed=!0,Object.keys(z.current.activePowerups).forEach(e=>{z.current.activePowerups[e].expires=0}),x("crashSfx"),y("flightSfx"))));let k=z.current.y,C={x:167.5,y:z.current.y+50.625};for(let e=z.current.medals.length-1;e>=0;e--){let r=z.current.medals[e];r.x<235&&r.x+64>100&&r.y<k+101.25&&r.y+64>k&&(x("medalSfx"),U(500),z.current.floatingScores.push({x:r.x+32,y:r.y+32,vy:-1,amount:500,age:0,maxAge:60}),z.current.medals.splice(e,1),z.current.medalCount++)}z.current.medals.forEach((e,r)=>{e.frameCounter++,e.frameCounter>=e.frameRate&&(e.frameCounter=0,e.frameIndex=(e.frameIndex+1)%e.frames.length),e.x+=e.vx,(z.current.isActive("magnet",z.current.frameCount)||z.current.isActive("supermag",z.current.frameCount))&&500>Math.hypot(C.x-(e.x+32),C.y-(e.y+32))&&(e.x+=(100-e.x)*.05,e.y+=(z.current.y-e.y)*.05);let a=e.frames[e.frameIndex];t.drawImage(a,e.x,e.y,64,64),e.x+64<0&&z.current.medals.splice(r,1)}),z.current.powerups.forEach((e,r)=>{!e.collected&&(e.x-=z.current.groundSpeed(z.current.frameCount),t.drawImage(e.img,e.x,e.y,128,128),e.x+128<0&&z.current.powerups.splice(r,1))}),z.current.isActive("supermag",z.current.frameCount)&&(z.current.ducks=z.current.ducks.filter(e=>{let r=C.x-(e.x+e.width/2),t=C.y-(e.y+e.height/2);500>Math.hypot(r,t)&&(e.x+=.1*r,e.y+=.1*t);let a=z.current.isActive("megaducks",z.current.frameCount)?2.5:1,n=e.width*a,s=e.height*a,o=(n-e.width)/2,u=(s-e.height)/2,l=e.x-o,i=e.y-u;return!(C.x>l)||!(C.x<l+n)||!(C.y>i)||!(C.y<i+s)||(U(1e3),z.current.floatingScores.push({x:e.x+e.width/2,y:e.y+e.height/2,vy:-1,amount:1e3,age:0,maxAge:60}),z.current.duckCount++,!1)}),z.current.powerups=z.current.powerups.filter(e=>{if(I.includes(e.type))return!0;let r=C.x-(e.x+32),t=C.y-(e.y+32);return 500>Math.hypot(r,t)&&(e.x+=.1*r,e.y+=.1*t),!(C.x>e.x)||!(C.x<e.x+64)||!(C.y>e.y)||!(C.y<e.y+64)||(z.current.activePowerups[e.type].expires=z.current.frameCount+1200,x("powerupSfx"),z.current.floatingScores.push({x:e.x+32,y:e.y+32,vy:-1,amount:25,age:0,maxAge:60}),!1)})),z.current.groundOffset=(z.current.groundOffset+z.current.groundSpeed(z.current.frameCount))%c;let b=O("explosionImgs");!z.current.crashed&&z.current.y+101.25>=u?(z.current.groundContactFrames++,z.current.groundContactFrames>=180&&(z.current.groundContactFrames=0,x("groundTouchSfx"),U(-100),W("SHOOT PLANE TO FLY",1.5,!0,!0,100,T.height/2,60),W("OUCH",.5,!0,!0,147.5,z.current.y-30,30),z.current.ouchExplodeIdx=Math.floor(Math.random()*b.length),z.current.ouchFrames=30)):z.current.groundContactFrames=0;for(let e=-z.current.groundOffset;e<n;e+=c)t.drawImage(l[z.current.groundIndex],e,u,c,50);if(!z.current.crashed){if(z.current.ouchFrames>0){let e=b[z.current.ouchExplodeIdx],r=z.current.y;t.drawImage(e,167.5-e.width/2,r-e.height,67.5,50.625)}let e=0,r=0;z.current.ouchFrames>0&&(e=(Math.random()-.5)*10,r=(Math.random()-.5)*6,z.current.ouchFrames--),z.current.planeFrameCounter++,z.current.planeFrameCounter>=6&&(z.current.planeFrameCounter=0,z.current.planeFrame=(z.current.planeFrame+1)%p.length);let a=p[z.current.planeFrame],n=167.5+e,s=z.current.y+50.625+r+10;if(t.save(),t.translate(n,s),z.current.isActive("shield",z.current.frameCount)||z.current.shieldFlash>0){z.current.shieldFlash>0&&(t.globalAlpha=z.current.shieldFlash%2==0?.2:.6);let e=236.25;t.drawImage(O("shieldImg"),-e/2,-e/2,e,e),z.current.shieldFlash>0&&(t.globalAlpha=1,z.current.shieldFlash--)}t.rotate(z.current.planeAngle),z.current.isActive("ghost",z.current.frameCount)&&(t.globalAlpha=.4),t.drawImage(a,-67.5,-50.625,135,101.25),t.globalAlpha=1,t.restore(),z.current.planeAngle=Math.min(0,z.current.planeAngle+.02),z.current.ouchFrames--}z.current.artilleryShells=z.current.artilleryShells.filter(r=>{r.x+=r.vx,r.y+=r.vy;let a=Math.atan2(r.vy,r.vx),n=r.img,s=32/n.naturalHeight,l=n.naturalWidth*s,i=.8*l;t.save(),t.translate(r.x,r.y),t.rotate(a),t.drawImage(n,-i,-16,l,32),t.restore();let c=!1;if(r.y>=u){let t=.5*e[0].width;z.current.waters.some(e=>r.x>=e.x&&r.x<=e.x+e.size*t)?x("artillerySplashSfx"):(b.forEach((e,t)=>setTimeout(()=>{z.current.puffs.push({x:r.x-16,y:u-16,img:e,vy:0,age:0,maxAge:10,size:96})},50*t)),x("artilleryExplodeSfx")),c=!0}z.current.enemies.forEach(e=>{if(!c&&e.alive&&r.x>=e.x&&r.x<=e.x+135&&r.y>=e.y&&r.y<=e.y+101.25){e.alive=!1;U(300),z.current.enemyCount++,z.current.floatingScores.push({x:r.x,y:r.y,vy:-1,amount:300,age:0,maxAge:60}),b.forEach((r,t)=>setTimeout(()=>{z.current.puffs.push({x:e.x,y:e.y,img:r,vy:0,age:0,maxAge:10,size:96})},50*t)),x("artilleryExplodeSfx"),c=!0}});let g=O("duckTargetImgs");return z.current.ducks.forEach(e=>{if(!c&&!e.hit&&r.x>=e.x&&r.x<=e.x+e.width&&r.y>=e.y&&r.y<=e.y+e.height){e.hit=!0,e.fadeAge=0,e.fadeMax=60,e.targetImg=g[e.srcIdx],z.current.shotLakes.add(e.waterRef);U(1200),z.current.duckCount++,z.current.floatingScores.push({x:r.x,y:r.y,vy:-1,amount:1200,age:0,maxAge:60}),b.forEach((r,t)=>setTimeout(()=>{z.current.puffs.push({x:e.x,y:e.y,img:r,vy:0,age:0,maxAge:10,size:96})},50*t)),x("artilleryExplodeSfx"),c=!0}}),!c&&r.y<o+32}),!(z.current.artilleryShells.length>0)||z.current.artilleryPlaying||z.current.crashed?0===z.current.artilleryShells.length&&z.current.artilleryPlaying&&(y("artillerySfx"),z.current.artilleryPlaying=!1):(x("artillerySfx"),z.current.artilleryPlaying=!0),z.current.crashed&&z.current.artilleryPlaying&&(y("artillerySfx"),z.current.artilleryPlaying=!1);let M=O("fireImgs");z.current.napalmMissiles=z.current.napalmMissiles.filter(e=>{e.x+=e.vx,e.life--,++e.tailCounter>=5&&(e.tailCounter=0,e.tailFrame=(e.tailFrame+1)%M.length);let r=M[e.tailFrame],a=Math.atan2(0,e.vx),s=e.x-52*Math.cos(a),o=e.y-52*Math.sin(a);t.save(),t.translate(s,o),t.rotate(-Math.PI/2),t.drawImage(r,-r.width/2,-r.height/2,r.width,r.height),t.restore(),t.save(),t.translate(e.x,e.y),t.rotate(a),t.drawImage(e.img,-32,-32,64,64),t.restore();{let r=!1;for(let t of z.current.enemies)if(t.alive&&e.x>=t.x&&e.x<=t.x+135&&e.y>=t.y&&e.y<=t.y+101.25){r=!0,t.alive=!1,U(100),z.current.floatingScores.push({x:t.x+67.5,y:t.y+50.625,vy:-1,amount:100,age:0,maxAge:60});break}return r||e.x>=e.explodeX?(X(e.x,e.y,!1),!1):e.life>0&&e.x<n+64}});let P=[];z.current.napalmTiles=z.current.napalmTiles.filter(r=>{r.x-=z.current.groundSpeed(z.current.frameCount);let a=r.y+36-30>=u,n=.5*e[0].width,s=u-.5*e[0].height+120,o=z.current.waters.some(e=>{let t=e.x,a=e.x+e.size*n;return r.x>=t&&r.x<=a&&r.y+36>=s});a||o?(a?r.y=u-36+30:r.y=s-36,r.vy=0):(r.vy+=m,r.y+=r.vy),r.life--;let l=O("flameImgs"),i=l.length,c=l[Math.floor((r.maxLife-r.life)/r.maxLife*i)%i];return t.globalAlpha=r.life/r.maxLife,t.drawImage(c,r.x-36,r.y-36,72,72),t.globalAlpha=1,z.current.ducks=z.current.ducks.filter(e=>!!e.hit||!(r.x>=e.x)||!(r.x<=e.x+e.width)||!(r.y>=e.y)||!(r.y<=e.y+e.height)||(U(1e3),z.current.floatingScores.push({x:e.x+e.width/2,y:e.y+e.height/2,vy:-1,amount:1e3,age:0,maxAge:60}),z.current.napalmTiles.push({x:e.x+e.width/2,y:e.y+e.height/2,vy:0,life:600,maxLife:600,killsPlayer:!1}),z.current.shotLakes.has(e.waterRef)||z.current.shotLakes.add(e.waterRef),!1)),z.current.enemies=z.current.enemies.filter(e=>{if(e.alive&&r.x>=e.x&&r.x<=e.x+135&&r.y>=e.y&&r.y<=e.y+101.25){U(100),z.current.floatingScores.push({x:e.x+67.5,y:e.y+50.625,vy:-1,amount:100,age:0,maxAge:60});let r=e.x+67.5,t=e.y+50.625;return P.push({x:r,y:t}),!1}return!0}),z.current.medals=z.current.medals.filter(e=>!(r.x>=e.x)||!(r.x<=e.x+64)||!(r.y>=e.y)||!(r.y<=e.y+64)||(U(500),z.current.floatingScores.push({x:e.x+32,y:e.y+32,vy:-1,amount:500,age:0,maxAge:60}),z.current.napalmTiles.push({x:e.x+32,y:e.y+32,vy:0,life:600,maxLife:600,killsPlayer:!1}),!1)),r.killsPlayer&&!z.current.isActive("ghost",z.current.frameCount)&&!z.current.crashed&&r.x>=100&&r.x<=235&&r.y>=z.current.y&&r.y<=z.current.y+101.25&&(z.current.isActive("shield",z.current.frameCount)?(z.current.activePowerups.shield.expires=0,z.current.shieldFlash=10,x("shieldSfx")):(z.current.crashed=!0,x("crashSfx"),y("flightSfx"))),r.life>0}),P.forEach(e=>{let{x:r,y:t}=e;X(r,t,!1)}),z.current.homingMissiles=z.current.homingMissiles.filter(e=>{if(e.target){let r=("x"in e.target?e.target.x:0)+67.5,t=Math.atan2(("y"in e.target?e.target.y:0)+50.625-e.y,r-e.x);e.vx=6*Math.cos(t),e.vy=6*Math.sin(t)}else e.vx=6,e.vy=0;e.x+=e.vx,e.y+=e.vy,++e.tailCounter>=5&&(e.tailCounter=0,e.tailFrame=(e.tailFrame+1)%2);let r=M[e.tailFrame],a=Math.atan2(e.vy,e.vx),n=e.x-16*Math.cos(a),s=e.y-16*Math.sin(a);for(let o of(t.save(),t.translate(n,s),t.rotate(a+Math.PI),t.drawImage(r,-r.width/2,-r.height/2,r.width,r.height),t.restore(),t.save(),t.translate(e.x,e.y),t.rotate(Math.atan2(e.vy,e.vx)),t.drawImage(e.img,-16,-16,32,32),t.restore(),z.current.enemies))if(o.alive&&e.x>=o.x&&e.x<=o.x+135&&e.y>=o.y&&e.y<=o.y+101.25){o.alive=!1,x("homingExplSfx");return U(200),z.current.floatingScores.push({x:e.x+50.625,y:e.y+67.5,vy:-1,amount:200,age:0,maxAge:60}),z.current.enemyCount++,b.forEach((r,t)=>setTimeout(()=>{z.current.puffs.push({x:e.x+50.625,y:e.y+67.5,img:r,vy:0,age:0,maxAge:10,size:96})},50*t)),!1}return!(--e.life<=0)||(x("homingExplSfx"),!1)}),(z.current.homingMissiles.length>0||z.current.napalmMissiles.length>0)&&!z.current.missileThrusterPlaying?(x("thrusterSfx"),z.current.missileThrusterPlaying=!0):0===z.current.homingMissiles.length&&0===z.current.napalmMissiles.length&&z.current.missileThrusterPlaying&&(y("thrusterSfx"),z.current.missileThrusterPlaying=!1),(z.current.activePowerups.bomb.expires===z.current.frameCount||z.current.activePowerups.bomb.expires===z.current.frameCount)&&(z.current.enemies.forEach(e=>{e.alive=!1;for(let r=0;r<5;r++)setTimeout(()=>q(e.x+67.5,e.y+50.625),50*r)}),x("bombSfx"),z.current.screenShake=20),z.current.falling.forEach((e,r)=>{e.vy+=m,e.y+=e.vy;let n=e.x+67.5,s=e.y+50.625,o=135*a,l=101.25*a;if(t.save(),t.translate(n,s),t.scale(-1,1),t.drawImage(e.img,-o/2,-l/2,o,l),t.restore(),.1>Math.random()&&q(n,s),e.y+101.25>=u){for(let e=0;e<5;e++)setTimeout(()=>q(n,u),100*e);z.current.falling.splice(r,1)}}),z.current.cannonballs.forEach((e,r)=>{e.x+=e.vx,t.drawImage(e.img,e.x,e.y,16,16),z.current.enemies.forEach(t=>{if(t.alive&&e.x>=t.x&&e.x<=t.x+135&&e.y>=t.y&&e.y<=t.y+101.25){t.alive=!1,b.forEach((r,t)=>setTimeout(()=>{z.current.puffs.push({x:e.x-16,y:e.y-16,img:r,vy:0,age:0,maxAge:10,size:96})},50*t));U(150),z.current.floatingScores.push({x:e.x+50.625,y:e.y+67.5,vy:-1,amount:150,age:0,maxAge:60}),z.current.cannonballs.splice(r,1)}}),e.x>n+50&&z.current.cannonballs.splice(r,1)}),z.current.crashed&&z.current.groundCrashPuffsLeft>0&&(q(100,z.current.y+50.625),z.current.groundCrashPuffsLeft--);let A=[];if(z.current.puffs.forEach(e=>{var r;e.y+=e.vy,t.globalAlpha=1-e.age/e.maxAge;let a=null!=(r=e.size)?r:32;t.drawImage(e.img,e.x,e.y,a,a),t.globalAlpha=1,e.age++,e.age<e.maxAge&&A.push(e)}),z.current.puffs=A,z.current.floatingScores.forEach(e=>{t.globalAlpha=1-e.age/e.maxAge,t.drawImage(O("plusImg"),e.x-16,e.y-64,32,32);let r=e.x+18;if(void 0!=e.amount&&e.amount.toString().split("").forEach(a=>{let n=O("digitImgs")[a];n&&(t.drawImage(n,r,e.y-64,24,32),r+=26)}),z.current.isActive("coin2x",z.current.frameCount)){let a=O("powerupImgs");t.drawImage(a.coin2x,r,e.y-64,32,32)}e.y+=e.vy,e.age++}),z.current.floatingScores=z.current.floatingScores.filter(e=>e.age<e.maxAge),t.globalAlpha=1,.002>Math.random()){let r={x:n+200*Math.random(),y:u-32,size:3+Math.floor(5*Math.random()),frameIndex:0,frameCounter:0,frameRate:30},t=.5*e[0].width,a=.5*e[0].height,s=r.x,o=r.x+r.size*t;if(!z.current.waters.some(e=>{let r=e.x;return s<e.x+e.size*t&&r<o})){z.current.waters.push(r);let e=O("duckImgs"),n=O("duckTargetImgs"),s=O("duckOutlineImgs"),o=Math.floor(Math.random()*e.length),l=Math.floor(Math.random()*r.size),i=e[o],c=.5*i.width,g=.5*i.height,m=u-a+100;z.current.ducks.push({x:r.x+l*t,y:m-g,img:i,targetImg:n[o],outlineImg:s[o],width:c,height:g,srcIdx:o,bobPhase:Math.random()*Math.PI*2,vx:1.5,dir:.5>Math.random()?1:-1,waterRef:r})}}z.current.waters.forEach((a,n)=>{a.frameCounter++,a.frameCounter>=a.frameRate&&(a.frameCounter=0,a.frameIndex=+(0===a.frameIndex));let s=e[a.frameIndex],o=.5*s.width,l=.5*s.height;for(let e=0;e<a.size;e++)t.drawImage(s,a.x+e*o,u-l+100,o,l);a.x-=z.current.groundSpeed(z.current.frameCount),a.x+a.size*o+r.width<0&&z.current.waters.splice(n,1)}),z.current.isActive("supermag",z.current.frameCount)||z.current.isActive("napalm",z.current.frameCount)||z.current.crashed||z.current.waters.forEach(r=>{if(!z.current.ducks.some(e=>e.waterRef===r)&&!z.current.shotLakes.has(r)){let t=O("duckImgs"),a=O("duckTargetImgs"),n=O("duckOutlineImgs"),s=.5*e[0].width,o=Math.floor(Math.random()*t.length),l=t[o],i=.5*l.width,c=.5*l.height,g=r.x+(r.size*s-i)/2;z.current.ducks.push({x:g,y:u-c,img:l,targetImg:a[o],outlineImg:n[o],width:i,height:c,srcIdx:o,bobPhase:Math.random()*Math.PI*2,vx:1.5,dir:.5>Math.random()?1:-1,waterRef:r})}}),z.current.ducks.forEach((r,a)=>{r.x-=z.current.groundSpeed(z.current.frameCount);let s=r.y;if(r.hit||z.current.isActive("supermag",z.current.frameCount)||(s+=5*Math.sin(.05*z.current.frameCount+r.bobPhase)+20),!r.hit&&!z.current.isActive("supermag",z.current.frameCount)){let t=.5*e[0].width,a=r.waterRef.x,n=r.waterRef.x+r.waterRef.size*t;r.x+=r.vx*r.dir,r.x<=a?(r.x=a,r.dir=1):r.x+r.width>=n&&(r.x=n-r.width,r.dir=-1)}let o=z.current.isActive("megaducks",z.current.frameCount);s=o?s-20:s;let u=o?3:z.current.isActive("ducksight",z.current.frameCount)?1.33:1,l=r.width*u,i=r.height*u,c=r.x-(l-r.width)/2,g=s-(i-r.height)/2;if(r.hit&&r.targetImg)t.globalAlpha=1-r.fadeAge/r.fadeMax,r.y-=.5,t.save(),r.dir<0?(t.translate(c+l/2,g+i/2),t.scale(-1,1),t.drawImage(r.targetImg,-l/2,-i/2,l,i)):t.drawImage(r.targetImg,c,g,l,i),t.restore(),t.restore(),r.fadeAge++,r.fadeAge>=r.fadeMax&&z.current.ducks.splice(a,1),t.globalAlpha=1;else{let e=z.current.isActive("ducksight",z.current.frameCount);t.save(),r.dir<0?(t.translate(c+l/2,g+i/2),t.scale(-1,1),t.drawImage(e?r.outlineImg:r.img,-l/2,-i/2,l,i)):t.drawImage(e?r.outlineImg:r.img,c,g,l,i),t.restore()}(r.x+r.width<-50||r.x>n+50)&&z.current.ducks.splice(a,1)});let S=O("sparkImgs");z.current.sparkEffects.forEach(e=>{e.age++,e.frameIndex=Math.floor(e.age/e.maxAge*S.length),e.frameIndex>=S.length&&(e.frameIndex=S.length-1);let r=S[e.frameIndex];t.save(),t.globalAlpha=.8-e.age/e.maxAge*.8,t.filter="hue-rotate(-30deg) brightness(1.2)",t.globalCompositeOperation="lighter",t.drawImage(r,e.x,e.y,64,128),t.restore()}),z.current.sparkEffects=z.current.sparkEffects.filter(e=>e.age<e.maxAge),s.current=requestAnimationFrame(g),Y()};g()},[O,T,B,x,Y,U,V,$,J,y,q,W,X]);return(0,n.useEffect)(()=>{if("playing"===o&&0===z.current.frameCount){L.current=!1,ee(),z.current.dynamicDensity=.01;let e=setInterval(()=>{z.current.dynamicDensity+=.005},45e3);return()=>clearInterval(e)}},[o,ee]),(0,n.useEffect)(()=>()=>{s.current&&cancelAnimationFrame(s.current)},[]),{phase:o,setPhase:m,ui:D,setUI:H,canvasRef:a,state:z,startSplash:Z,handleClick:e=>{if("playing"!==o||D.crashed||D.ammo<=0){if(z.current.ammo<=1){let e=T.height/2;for(let r=0;r<3;r++)window.setTimeout(()=>W("RELOAD",2,!0,!0,100,e,30),200*r)}return}let r=z.current.isActive("spray",z.current.frameCount),t=r?Math.min(1,z.current.ammo):1,n=z.current.isActive("infiniteAmmo",z.current.frameCount)?z.current.ammo:Math.max(0,z.current.ammo-t);z.current.ammo=n,z.current.cursor=g,setTimeout(()=>z.current.cursor=c,100);let s=a.current.getBoundingClientRect(),u=e.clientX-s.left,l=e.clientY-s.top;if(r)for(let e=0;e<5;e++){let r=(2*Math.random()-1)*40,t=(2*Math.random()-1)*40;window.setTimeout(()=>K(u+r,l+t),50*e)}else K(u,l)},handleContext:e=>{e.preventDefault(),"playing"===o&&!z.current.crashed&&z.current.ammo<12&&(x("reloadSfx"),U(25),z.current.ammo=12,z.current.floatingScores.push({x:Math.random()*T.width,y:Math.random()*T.height,vy:-1,amount:25,age:0,maxAge:60}))},getImg:O,isActive:Q,resetGame:()=>{x("gameOverSfx"),Z()},resetState:B,countdown:e}};function O(){let{phase:e,countdown:r,ui:t,canvasRef:n,handleClick:s,handleContext:o,resetGame:l,getImg:g,startSplash:m}=R();return"title"===e?(0,a.jsx)(h,{onStart:m,titleSrc:u("/assets/titles/warbirds_title.png"),backgroundColor:i,cursor:c}):"ready"===e||"go"===e?(0,a.jsx)(y,{phase:e,countdown:r}):(0,a.jsx)(x,{ammo:t.ammo,medalCount:t.medalCount,duckCount:t.duckCount,enemyCount:t.enemyCount,score:t.score,crashed:t.crashed,frameCount:t.frameCount,activePowerups:t.activePowerups,cursor:t.cursor,canvasRef:n,handleClick:s,handleContext:o,resetGame:l,getImg:g})}function T(){return(0,a.jsx)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:(0,a.jsx)(O,{})})}},6567:(e,r,t)=>{Promise.resolve().then(t.bind(t,1641))}},e=>{var r=r=>e(e.s=r);e.O(0,[213,441,684,358],()=>r(6567)),_N_E=e.O()}]);