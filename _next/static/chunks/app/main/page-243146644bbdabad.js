(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[798],{3169:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var a=r(5155),n=r(2115),l=r(4991);let s="/lightgun-web";function i(e){return"".concat(s).concat(e)}let u="url('".concat(s,"/assets/shooting-gallery/PNG/HUD/crosshair_blue_small.png') 16 16, auto"),c="url('".concat(s,"/assets/shooting-gallery/PNG/HUD/crosshair_white_small.png') 16 16, auto"),o="url('".concat(s,"/assets/shooting-gallery/PNG/HUD/crosshair_red_small.png') 16 16, auto");var h=r(6259);let d=e=>{let{onStart:t,titleSrc:r,backgroundColor:l,cursor:s}=e,i=(0,n.useRef)(null),u=(0,n.useRef)(null),c=(0,n.useRef)(!0);return(0,a.jsxs)(h.A,{position:"relative",width:"100vw",height:"100dvh",sx:{backgroundColor:l,cursor:s},display:"flex",justifyContent:"center",alignItems:"center",onClick:()=>{c.current=!1,u.current&&cancelAnimationFrame(u.current),t()},children:[(0,a.jsx)("canvas",{ref:i,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"}}),(0,a.jsx)(h.A,{component:"img",src:r,alt:"Zombiefish",sx:{width:"auto",height:"100%",cursor:s}})]})},g=function(e){let{ui:t,canvasRef:r,handleClick:n,handleContext:l,handleMouseMove:s}=e,{phase:u,cursor:c}=t;return(0,a.jsxs)(h.A,{position:"relative",width:"100vw",height:"100dvh",children:[(0,a.jsx)("canvas",{ref:r,onClick:n,onContextMenu:l,onTouchStart:e=>{e.preventDefault();let t=e.touches[0];n({clientX:t.clientX,clientY:t.clientY})},onMouseMove:s,style:{display:"block",width:"100%",height:"100%",cursor:c}}),"gameover"===u&&(0,a.jsx)(h.A,{component:"img",src:i("/assets/shooting-gallery/PNG/HUD/text_gameover.png"),alt:"Game Over",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:300,height:"auto",pointerEvents:"none"}})]})};function f(e,t,r){let{text:a,scale:n,fixed:l,fade:s,x:i,y:u,py:c,vy:o,vs:h,maxAge:d,onClick:g,color:f}=e,{spaceGap:m}=e,{getImg:p}=t;if(!p)throw Error("Asset manager does not have getImg method");let y=p("letterImgs"),b=p("numberImgs"),_=p("digitImgs"),x=p("plusImg"),v=p("minusImg"),w=0;m=m||y&&1.5*y.A.width*n||10;let k=[];return Array.from(a).forEach(e=>{if(" "===e)w+=m,k.push(null);else{let t="+"===e?x:"-"===e?v:(null==y?void 0:y[e.toUpperCase()])||(null==b?void 0:b[e])||(null==_?void 0:_[e]);t&&(w+=t.width*n+2,k.push(t))}}),{text:a,imgs:k,scale:n,fixed:l,fade:s,x:null!=i?i:(null==r?void 0:r.width)!==void 0?(r.width-w)/2:0,y:(null!=u?u:(null==r?void 0:r.height)!==void 0?.2*r.height:0)+(null!=c?c:0),py:null!=c?c:0,vy:null!=o?o:0,vs:null!=h?h:0,age:0,maxAge:d||(s?60:1/0),spaceGap:m,...f?{color:f}:{},...g?{onClick:g}:{}}}let m=[.05,.1],p=[.1,.2],y=[.2,.4],b=[.3,.6],_=(e,t)=>{if(Math.abs(e)>=Math.abs(t)){let r=.5*Math.abs(e);return{vx:e,vy:Math.max(Math.min(t,r),-r)}}let r=.5*Math.abs(t);return{vx:Math.max(Math.min(e,r),-r),vy:t}},x=(e,t)=>{let r=Math.atan2(t,e),a=!1;return r>Math.PI/2?(r=Math.PI-r,a=!0):r<-Math.PI/2&&(r=-Math.PI-r,a=!0),{angle:r,flipped:a}};function v(){let{ui:e,canvasRef:t,handleMouseMove:r,handleClick:l,handleContext:s,startSplash:h,ready:v}=function(){let e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=function(){let[e,t]=(0,n.useState)(!1),r=(0,n.useRef)({});return(0,n.useEffect)(()=>{let e=e=>{let t=new window.Image;return t.src=i(e),t},a=(t,r)=>Object.fromEntries(r.map(r=>[r,e("/assets/fish/PNG/".concat(t,"/").concat(r,".png"))])),n=e("/assets/fish/Spritesheet/spritesheet.png"),l={blue:[[1152,256]],brown:[[1024,1280]],green:[[1024,1024]],grey:[[1024,512]],grey_long_a:[[1024,384]],grey_long_b:[[1024,128]],orange:[[896,1280]],pink:[[896,768]],red:[[896,256]]},s={blue:[[1152,0]],green:[[1024,768]],orange:[[896,1024]],pink:[[896,512]],red:[[896,0]]};n.onload=()=>{let e=e=>Object.fromEntries(Object.entries(e).map(e=>{let[t,r]=e;return[t,r.map(e=>{let[t,r]=e,a=document.createElement("canvas");a.width=128,a.height=128;let l=a.getContext("2d");null==l||l.drawImage(n,t,r,128,128,0,0,128,128);let s=new window.Image;return s.src=a.toDataURL(),s})]}));r.current.fishFrames=e(l),r.current.skeletonFrames=e(s),t(!0)},r.current.fishImgs=Object.fromEntries(["blue","brown","brown_outline","green","grey","grey_long_a","grey_long_a_outline","grey_long_b","grey_long_b_outline","orange","pink","red"].map(t=>[t,e("/assets/fish/PNG/Objects/Fish/fish_".concat(t,".png"))])),r.current.fishFlashImg=e("/assets/smoke/PNG/Flash/flash00.png"),r.current.bubbleImgs=a("Objects/Bubbles",["bubble_a","bubble_b","bubble_c"]),r.current.rockImgs=a("Objects/Rocks",["background_rock_a","background_rock_b","rock_a","rock_a_outline","rock_b","rock_b_outline"]),r.current.rockBgImgs=[r.current.rockImgs.background_rock_a,r.current.rockImgs.background_rock_b],r.current.seaGrassImgs=a("Objects/SeaGrass",["seaweed_grass_a","seaweed_grass_a_outline","seaweed_grass_b","seaweed_grass_b_outline"]),r.current.seaGrassFgImgs=[r.current.seaGrassImgs.seaweed_grass_a,r.current.seaGrassImgs.seaweed_grass_b];let u=[];"abcdefgh".split("").forEach(e=>{u.push("background_seaweed_".concat(e))}),"abcd".split("").forEach(e=>{u.push("seaweed_green_".concat(e)),u.push("seaweed_green_".concat(e,"_outline"))}),"ab".split("").forEach(e=>{u.push("seaweed_orange_".concat(e)),u.push("seaweed_orange_".concat(e,"_outline"))}),"abcd".split("").forEach(e=>{u.push("seaweed_pink_".concat(e)),u.push("seaweed_pink_".concat(e,"_outline"))}),r.current.seaweedImgs=a("Objects/Seaweed",u),r.current.seaweedBgImgs="abcdefgh".split("").map(e=>r.current.seaweedImgs["background_seaweed_".concat(e)]||void 0),r.current.surfaceImgs=[e("/assets/shooting-gallery/PNG/Stall/water1.png"),e("/assets/shooting-gallery/PNG/Stall/water2.png")],r.current.cloudImgs=[e("/assets/shooting-gallery/PNG/Stall/cloud1.png"),e("/assets/shooting-gallery/PNG/Stall/cloud2.png")];let c="abcdefgh".split(""),o=["terrain_dirt_a","terrain_dirt_b","terrain_dirt_c","terrain_dirt_d",...c.flatMap(e=>["terrain_dirt_top_".concat(e),"terrain_dirt_top_".concat(e,"_outline")])],h=["terrain_sand_a","terrain_sand_b","terrain_sand_c","terrain_sand_d",...c.flatMap(e=>["terrain_sand_top_".concat(e),"terrain_sand_top_".concat(e,"_outline")])];r.current.terrainDirtImgs=a("Terrain/Dirt",o),r.current.terrainSandImgs=a("Terrain/Sand",h),r.current.terrainWaterImgs=a("Terrain/Water",["water_terrain","water_terrain_top"]),r.current.digitImgs={};for(let t=0;t<=9;t++)r.current.digitImgs[t.toString()]=e("/assets/fish/PNG/HUDText/hud_number_".concat(t,".png"));r.current.digitImgs[":"]=e("/assets/fish/PNG/HUDText/hud_colon.png"),r.current.letterImgs={};for(let t=65;t<=90;t++){let a=String.fromCharCode(t);r.current.letterImgs[a]=e("/assets/tappyplane/PNG/Letters/letter".concat(a,".png"))}r.current.dotImg=e("/assets/fish/PNG/HUDText/hud_dot.png"),r.current.pctImg=e("/assets/fish/PNG/HUDText/hud_percent.png"),r.current.plusImg=e("/assets/fish/PNG/HUDText/hud_plus.png");let d=document.createElement("canvas");d.width=r.current.plusImg.width||32,d.height=r.current.plusImg.height||32;let g=d.getContext("2d");if(g){g.fillStyle="white";let e=Math.max(1,Math.floor(d.height/5)),t=Math.floor((d.height-e)/2);g.fillRect(0,t,d.width,e)}let f=new window.Image;f.src=d.toDataURL(),r.current.minusImg=f},[]),{get:(0,n.useCallback)(e=>r.current[e],[]),getImg:(0,n.useCallback)(e=>{var t;return null!=(t=r.current[e])?t:void 0},[]),assetRefs:r.current,ready:e}}(),{getImg:a,ready:l}=r,s=function(){let e=(0,n.useMemo)(()=>{if("undefined"==typeof Audio)return{};let e=document.createElement("audio");e.src=i("/audio/laser4.ogg"),e.preload="auto";let t=document.createElement("audio");t.src=i("/audio/laser9.ogg"),t.preload="auto";let r=document.createElement("audio");r.src=i("/audio/powerUp8.ogg"),r.preload="auto";let a=document.createElement("audio");a.src=i("/audio/error_004.ogg"),a.preload="auto";let n=document.createElement("audio");n.src=i("/audio/splash.ogg"),n.preload="auto";let l=document.createElement("audio");l.src=i("/audio/lowDown.ogg"),l.preload="auto";let s=document.createElement("audio");s.src=i("/audio/zap1.ogg"),s.preload="auto";let u=document.createElement("audio");u.src=i("/audio/glass_001.ogg"),u.preload="auto";let c=document.createElement("audio");c.src=i("/audio/back_001.ogg"),c.preload="auto",c.loop=!0;let o=document.createElement("audio");o.src=i("/audio/tick_002.ogg"),o.preload="auto";let h=document.createElement("audio");return h.src=i("/audio/warning.ogg"),h.preload="auto",{shoot:e,hit:t,bonus:r,penalty:a,skeleton:n,death:l,convert:s,pop:u,tick:o,warning:h,bgm:c}},[]),t=(0,n.useCallback)((t,r)=>{let a=e[t];a&&((null==r?void 0:r.loop)!==void 0&&(a.loop=r.loop),(null==r?void 0:r.volume)!==void 0&&(a.volume=r.volume),a.currentTime=0,a.play())},[e]),r=(0,n.useCallback)(t=>{let r=e[t];r&&r.pause()},[e]),a=(0,n.useCallback)(()=>{Object.values(e).forEach(e=>e.pause())},[e]);return(0,n.useMemo)(()=>({play:t,pause:r,pauseAll:a}),[t,r,a])}(),h=function(){let[e,t]=(0,n.useState)({width:0,height:0});return(0,n.useEffect)(()=>{function e(){t({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e}(),d=(0,n.useRef)({phase:"title",timer:99,shots:0,hits:0,score:0,accuracy:0,cursor:u,dims:h,fish:[],bubbles:[],textLabels:[],missParticles:[],conversions:0,hitCounts:{},warningPlayed:!1}),g=(0,n.useRef)(1),v=(0,n.useRef)(1),w=(0,n.useRef)(1),k=(0,n.useRef)(1),I=(0,n.useRef)([]),M=(0,n.useRef)([]),S=(0,n.useRef)(0),E=(0,n.useRef)(null),C=(0,n.useRef)(null),R=(0,n.useRef)(0),T=(0,n.useRef)(null),P=(0,n.useRef)(m.map(()=>0)),A=(0,n.useRef)(p.map(()=>0)),G=(0,n.useRef)(y.map(()=>0)),j=(0,n.useRef)(b.map(()=>0)),N=(0,n.useRef)(null),O=(0,n.useRef)(0),F=(0,n.useRef)(0),L=e=>{e>Number(localStorage.getItem("bestAccuracy")||0)&&localStorage.setItem("bestAccuracy",e.toString())},D=(0,n.useRef)(null),H=(0,n.useRef)(null),U=(0,n.useRef)(null),z=(0,n.useRef)(null),q=(0,n.useRef)(null),B=(0,n.useRef)(null),W=(0,n.useRef)(null),X=(0,n.useRef)(null),Y=(0,n.useRef)(null),Z=(0,n.useRef)(null),J=(0,n.useRef)(null),K=(0,n.useRef)({x:0,y:0,width:0,height:0}),[Q,V]=(0,n.useState)({phase:"title",timer:99,shots:0,hits:0,score:0,accuracy:0,cursor:u});(0,n.useEffect)(()=>{d.current.dims=h},[h]);let $=(0,n.useCallback)(e=>{d.current.cursor=e,V({phase:d.current.phase,timer:d.current.timer,shots:d.current.shots,hits:d.current.hits,score:d.current.score,accuracy:d.current.accuracy,cursor:e})},[]),ee=(0,n.useCallback)((e,t,r,n)=>{let l=f({text:e,scale:1,fixed:!0,fade:!0,x:t,y:r,vy:-.5,...n?{color:n}:{}},{getImg:a},d.current.dims);d.current.textLabels.push(l)},[a]),et=(0,n.useCallback)(e=>{let{width:t,height:r}=d.current.dims,n=a("terrainWaterImgs"),l=null==n?void 0:n.water_terrain;if(l)for(let a=0;a<t;a+=l.width)for(let t=0;t<r;t+=l.height)e.drawImage(l,a,t);else e.fillStyle="#1d8fde",e.fillRect(0,0,t,r);let s=a("surfaceImgs"),i=a("cloudImgs");if(s&&s.length){let r=s[0].width*s.length;m.forEach((e,t)=>{P.current[t]=(P.current[t]-e)%r});for(let a=0;a<m.length;a++){let n=P.current[a];for(let a=-r;a<t+r;a+=r)s.forEach((t,r)=>{e.drawImage(t,a+n+r*s[0].width,0)})}}if(i&&i.length){let r=i[0].width*i.length;for(let a=0;a<m.length;a++){let n=P.current[a];for(let a=-r;a<t+r;a+=r)i.forEach((t,r)=>{e.drawImage(t,a+n+r*i[0].width,0)})}}let u=a("terrainSandImgs"),c=null==u?void 0:u.terrain_sand_a,o=null==u?void 0:u.terrain_sand_top_a,h=r;if(c){h=r-c.height;for(let r=0;r<t;r+=c.width)e.drawImage(c,r,h)}else h=r-64,e.fillStyle="#c2b280",e.fillRect(0,h,t,64);if(o){let r=h-o.height;for(let a=0;a<t;a+=o.width)e.drawImage(o,a,r)}let g=a("seaweedBgImgs");if(g&&g.length){let r=h,a=g[0].width*g.length;y.forEach((e,t)=>{G.current[t]=(G.current[t]-e)%a});for(let n=0;n<y.length;n++){let l=G.current[n];for(let n=-a;n<t+a;n+=a)g.forEach((t,a)=>{if(!t)return;let s=r-t.height;e.drawImage(t,n+l+a*g[0].width,s)})}}let f=a("rockBgImgs");if(f&&f.length){let r=f[0].width*f.length;p.forEach((e,t)=>{A.current[t]=(A.current[t]-e)%r});for(let a=0;a<p.length;a++){let n=A.current[a],l=h-f[0].height;for(let a=-r;a<t+r;a+=r)f.forEach((t,r)=>{t&&e.drawImage(t,a+n+r*f[0].width,l)})}}let _=a("seaGrassFgImgs");if(_&&_.length){let r=_[0].width*_.length;b.forEach((e,t)=>{j.current[t]=(j.current[t]-e)%r});for(let a=0;a<b.length;a++){let n=j.current[a],l=h-_[0].height;for(let a=-r;a<t+r;a+=r)_.forEach((t,r)=>{t&&e.drawImage(t,a+n+r*_[0].width,l)})}}},[a]),er=(0,n.useCallback)(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(!e)return;let l=(r>0?t.toString().padStart(r,"0"):t.toString())+n,s=a("digitImgs");e.text=l,e.imgs=l.split("").map(e=>s[e])},[a]),ea=(0,n.useCallback)(()=>{let t=d.current,{width:r,height:n}=t.dims,l=a("fishFlashImg"),i=e.current,u=null==i?void 0:i.getContext("2d");t.fish.forEach(e=>{let t=a(e.isSkeleton?"skeletonFrames":"fishFrames")[e.kind];t&&t.length>0&&(e.frameCounter+=1,e.frameCounter>=6&&(e.frameCounter=0,e.frame=(e.frame+1)%t.length)),e.pendingSkeleton&&(u&&l&&u.drawImage(l,e.x,e.y,128,128),e.flashTimer=(e.flashTimer||0)-1,e.flashTimer<=0&&(e.isSkeleton=!0,e.health=2,e.hurtTimer=0,e.pendingSkeleton=void 0,e.flashTimer=void 0))});let c={};t.fish.forEach(e=>{if(void 0===e.groupId)return;c[e.groupId]||(c[e.groupId]={vx:0,vy:0,members:[]});let t=c[e.groupId];t.vx+=e.vx,t.vy+=e.vy,t.members.push(e)}),Object.values(c).forEach(e=>{let t=e.vx/e.members.length,r=e.vy/e.members.length;e.members.forEach(e=>{e.vx+=(t-e.vx)*.05,e.vy+=(r-e.vy)*.05})});let o={};t.fish.forEach(e=>{var t;if(void 0===e.pairId)return;let r=o[t=e.pairId]||(o[t]={});"grey_long_a"===e.kind?r.a=e:"grey_long_b"===e.kind&&(r.b=e)}),Object.values(o).forEach(e=>{let{a:t,b:r}=e;if(!t||!r)return;r.vy=t.vy;let a=r.x>=t.x?1:-1,n=t.x+128*a-r.x;r.vx+=.05*n});let h=new Set(["brown","grey_long_a","grey_long_b"]),g=1048576,f=t.fish.filter(e=>e.isSkeleton||e.pendingSkeleton).length;t.fish.forEach(e=>{let r;if(!e.isSkeleton)return;let a=g;for(let n of t.fish){if(n.isSkeleton||n.pendingSkeleton||h.has(n.kind))continue;let t=n.x-e.x,l=n.y-e.y,s=t*t+l*l;s<a&&(a=s,r=n)}if(!r)return;let n=r.x-e.x,l=r.y-e.y,i=Math.sqrt(a);i>0&&(e.vx=n/i*2,e.vy=l/i*2),i<64&&f<20&&!r.pendingSkeleton&&(ee("POOF",r.x,r.y),r.pendingSkeleton=!0,r.flashTimer=5,r.vx=0,r.vy=0,r.frame=0,r.frameCounter=0,delete r.groupId,t.conversions+=1,s.play("convert"),f+=1)}),t.fish.forEach(e=>{if(!e.isSkeleton&&(e.wanderTimer-=1,e.wanderTimer<=0)){let t=2*Math.random()+1,r=_((2*Math.random()-1)*t,(2*Math.random()-1)*t);e.vx=r.vx,e.vy=r.vy,e.wanderTimer=Math.floor(60*Math.random())+60}});let m=t.fish.filter(e=>e.isSkeleton);for(let e=0;e<m.length;e++){let t=m[e];for(let r=e+1;r<m.length;r++){let e=m[r],a=e.x-t.x,n=e.y-t.y,l=a*a+n*n;if(l<16384&&l>0){let r=Math.sqrt(l),s=(128-r)/128*.05,i=a/r*s,u=n/r*s;t.vx-=i,t.vy-=u,e.vx+=i,e.vy+=u}}}t.fish.forEach(e=>{e.hurtTimer>0&&(e.hurtTimer-=1);let t=.5*Math.sin((R.current+e.id)/20),a=_(e.vx,e.vy+t);e.x+=a.vx,e.y+=a.vy;let l=x(a.vx,a.vy);e.angle=l.angle,e.flipped=l.flipped,e.isSkeleton&&(e.x=Math.max(0,Math.min(e.x,r-128)),e.y=Math.max(0,Math.min(e.y,n-128)))})},[s,ee,a]),en=(0,n.useCallback)(()=>{let{width:e,height:t}=d.current.dims,r=["bubble_a","bubble_b","bubble_c"],a=r[Math.floor(Math.random()*r.length)],n=64*Math.random()+32,l=Math.random()*(e-n),s=Math.random()-.5,i=+Math.random()+-1.5,u=2*Math.random()+.5,c=.05*Math.random()+.01;if(d.current.bubbles.length>=20)return;let o=M.current.pop()||{};o.id=k.current++,o.kind=a,o.x=l,o.y=t+n,o.vx=s,o.vy=i,o.size=n,o.amp=u,o.freq=c,d.current.bubbles.push(o)},[]),el=(0,n.useCallback)(()=>{let n=d.current;if(J.current){var l,i;let e=J.current,t=e.imgs.reduce((t,r)=>t+(r?r.width*e.scale+2:e.spaceGap),0),r=e.imgs.reduce((t,r)=>Math.max(t,((null==r?void 0:r.height)||0)*e.scale),0);K.current={x:e.x,y:e.y-(null!=(l=e.py)?l:0),width:t,height:r+(null!=(i=e.py)?i:0)*2}}let u=e.current,c=null==u?void 0:u.getContext("2d");if(!u||!c){t.current=requestAnimationFrame(el);return}if("playing"===n.phase){if(ea(),S.current-=1,S.current<=0&&(en(),S.current=Math.floor(60*Math.random())+30),n.bubbles.forEach(e=>{e.x+=e.vx+Math.sin(R.current*e.freq)*e.amp,e.y+=e.vy}),n.bubbles=n.bubbles.filter(e=>{let t=e.y+e.size>0&&e.x+e.size>0&&e.x-e.size<n.dims.width;return t||M.current.push(e),t}),R.current+=1,R.current>=60&&(R.current=0,n.timer=Math.max(0,n.timer-1),s.play("tick"),er(H.current,n.timer,2,":"),10!==n.timer||n.warningPlayed||(s.play("warning"),n.warningPlayed=!0)),0===n.timer){n.phase="gameover",O.current=n.shots>0?Math.round(n.hits/n.shots*100):0,L(O.current),F.current=0,s.pause("bgm");let e=a("pctImg"),t=[a("digitImgs")["0"],e],l=t.reduce((e,t)=>e+ +t.width+2,0),i=f({text:"0",scale:1,fixed:!0,fade:!1,x:(n.dims.width-l)/2,y:n.dims.height/2,py:8},r);i.text="0%",i.imgs=t,N.current=i,n.textLabels.push(i);let u=(e,t)=>{let a=f({text:e,scale:1,fixed:!0,fade:!1,y:t,py:8},r,n.dims);return n.textLabels.push(a),a},c=i.y+40;Y.current=u("TIME ".concat(n.timer.toString().padStart(2,"0")),c),W.current=u("SHOTS ".concat(n.shots),c+40),X.current=u("HITS ".concat(n.hits),c+80);let o=c+120;Object.entries(n.hitCounts).sort((e,t)=>{let[r]=e,[a]=t;return r.localeCompare(a)}).forEach(e=>{let[t,r]=e;u("".concat(t.replace(/_/g," ")," ").concat(r),o),o+=40}),Z.current=u("SCORE ".concat(n.score),c+120)}if(!D.current){let e=Number(localStorage.getItem("bestAccuracy")||0),t=a("pctImg"),l=a("digitImgs"),s=f({text:"".concat(e,"%"),scale:1,fixed:!0,fade:!1,x:16,y:16,py:8},r);s.imgs=[...e.toString().split("").map(e=>l[e]),t],D.current=s,n.textLabels.push(s)}let{width:e,height:t}=n.dims;n.fish=n.fish.filter(r=>{let a=r.x>-256&&r.x<e+256&&r.y>-256&&r.y<t+256;return a||I.current.push(r),a})}if(n.missParticles.forEach(e=>{e.radius+=4,e.alpha-=.05}),n.missParticles=n.missParticles.filter(e=>e.alpha>0),"gameover"===n.phase&&N.current){let e=N.current;if(F.current<O.current){F.current+=1,s.play("tick");let t=Math.min(F.current,O.current).toString(),r=a("digitImgs"),n=a("pctImg");e.text="".concat(t,"%"),e.imgs=[...t.split("").map(e=>r[e]),n]}e.scale=1+.05*Math.sin(.1*R.current);let t=e.imgs.reduce((t,r)=>t+((null==r?void 0:r.width)||0)*e.scale+2,0);e.x=(n.dims.width-t)/2}if("playing"===n.phase){let{width:e,height:t}=n.dims;n.fish=n.fish.filter(r=>{let a=r.x>-256&&r.x<e+256&&r.y>-256&&r.y<t+256;return a||I.current.push(r),a})}if("paused"===n.phase?B.current||(B.current=f({text:"PAUSED",scale:2,fixed:!0,fade:!1},r,n.dims),n.textLabels.push(B.current)):B.current&&(n.textLabels=n.textLabels.filter(e=>e!==B.current),B.current=null),u&&c){u.width=n.dims.width,u.height=n.dims.height,c.clearRect(0,0,u.width,u.height),et(c);let e=n.timer/99*u.width;c.fillStyle="rgba(0,0,0,0.5)",c.fillRect(0,0,e,8);let t=a("bubbleImgs");n.bubbles.forEach(e=>{let r=t[e.kind];r&&c.drawImage(r,e.x,e.y,e.size,e.size)}),n.missParticles.forEach(e=>{c.beginPath(),c.arc(e.x,e.y,e.radius,0,2*Math.PI),c.strokeStyle="rgba(255,255,255,".concat(e.alpha,")"),c.lineWidth=2,c.stroke()}),n.fish.forEach(e=>{let t=a(e.isSkeleton?"skeletonFrames":"fishFrames")[e.kind];if(!t||0===t.length)return;let r=t[e.frame];if(!r)return;c.save();let n=e.x+64,l=e.y+64,s=-64;("grey_long_a"===e.kind||"grey_long_b"===e.kind)&&(n=e.x+128*("grey_long_a"===e.kind),s="grey_long_a"===e.kind?-128:0);let i=Math.atan2(e.vy,e.vx);if(c.translate(n,l),c.rotate(i),e.flipped&&c.scale(-1,1),e.highlight){let t=a("fishImgs")["".concat(e.kind,"_outline")];t&&(c.globalAlpha=(Math.sin(R.current/10)+1)/2,c.drawImage(t,s,-64,128,128),c.globalAlpha=1)}if(c.drawImage(r,s,-64,128,128),e.pendingSkeleton){let e=a("fishFlashImg");e&&c.drawImage(e,s,-64,128,128)}e.isSkeleton&&e.hurtTimer>0&&(c.fillStyle="rgba(255,0,0,0.5)",c.fillRect(s,-64,128,128)),c.restore()}),n.textLabels=function(e){let{textLabels:t,ctx:r,offsetX:a,offsetY:n,cull:l}=e,s=r.globalAlpha,i=r.fillStyle;return t.forEach(e=>{var t,l,s;r.globalAlpha=e.fade?1-e.age/e.maxAge:1,r.fillStyle=null!=(t=e.color)?t:i;let u=e.fixed?e.x:e.x-(a||0);for(let t of e.imgs)if(t){let a=t.width*e.scale,l=t.height*e.scale;r.drawImage(t,u,e.y-(n||0),a,l),u+=a+2}else u+=e.spaceGap;e.y+=null!=(l=e.vy)?l:0,e.scale+=null!=(s=e.vs)?s:0,e.age++}),r.globalAlpha=s,r.fillStyle=i,l&&(t=t.filter(e=>e.age<e.maxAge)),t}({textLabels:n.textLabels,ctx:c,cull:!0})}n.accuracy=n.shots>0?n.hits/n.shots*100:0,V({phase:n.phase,timer:n.timer,shots:n.shots,hits:n.hits,score:n.score,accuracy:n.accuracy,cursor:n.cursor}),t.current=requestAnimationFrame(el)},[ea,a,r,en,er]),es=(0,n.useCallback)(()=>{var e;let n=d.current;n.phase="playing",n.timer=99,n.shots=0,n.hits=0,n.score=0,n.accuracy=0,I.current.push(...n.fish),n.fish=[],M.current.push(...n.bubbles),n.bubbles=[],n.missParticles=[],n.warningPlayed=!1,R.current=0,N.current=null,D.current=null,O.current=0,F.current=0,P.current.fill(0),A.current.fill(0),G.current.fill(0),j.current.fill(0),B.current=null,W.current=null,X.current=null,Y.current=null,Z.current=null;let l=((null==(e=a("digitImgs")["0"])?void 0:e.height)||0)+8;s.play("bgm",{loop:!0});let i=e=>e.imgs.reduce((t,r)=>t+(r?r.width+2:e.spaceGap),0),c=f({text:"TIME",scale:1,fixed:!0,fade:!1,x:16,y:16,py:8},r);J.current=c,K.current={x:c.x,y:c.y-((null==c?void 0:c.py)||0),width:i(c),height:c.imgs.reduce((e,t)=>Math.max(e,((null==t?void 0:t.height)||0)*c.scale),0)+2*((null==c?void 0:c.py)||0)},H.current=f({text:"".concat(n.timer.toString().padStart(2,"0"),":"),scale:1,fixed:!0,fade:!1,x:16+i(c),y:16,py:8},r),er(H.current,n.timer,2,":");let o=f({text:"SHOTS",scale:1,fixed:!0,fade:!1,x:16,y:16+l,py:8},r);U.current=f({text:n.shots.toString(),scale:1,fixed:!0,fade:!1,x:16+i(o),y:16+l,py:8},r);let h=f({text:"HITS",scale:1,fixed:!0,fade:!1,x:16,y:16+2*l,py:8},r);z.current=f({text:n.hits.toString(),scale:1,fixed:!0,fade:!1,x:16+i(h),y:16+2*l,py:8},r);let g=f({text:"SCORE",scale:1,fixed:!0,fade:!1,x:16,y:16+3*l,py:8},r);q.current=f({text:n.score.toString(),scale:1,fixed:!0,fade:!1,x:16+i(g),y:16+3*l,py:8},r),S.current=0,d.current.textLabels=[c,H.current,o,U.current,h,z.current,g,q.current],n.cursor=u,V({phase:n.phase,timer:n.timer,shots:n.shots,hits:n.hits,score:n.score,accuracy:n.accuracy,cursor:n.cursor}),t.current&&cancelAnimationFrame(t.current),t.current=requestAnimationFrame(el)},[el,r,a,er]),ei=(0,n.useCallback)(()=>{let e=d.current;T.current&&(clearTimeout(T.current),T.current=null),e.phase="title",e.timer=99,e.shots=0,e.hits=0,e.score=0,e.accuracy=0,e.conversions=0,e.hitCounts={},I.current.push(...e.fish),e.fish=[],e.cursor=u,M.current.push(...e.bubbles),e.bubbles=[],e.missParticles=[],e.warningPlayed=!1,N.current=null,D.current=null,O.current=0,F.current=0,R.current=0,H.current=null,U.current=null,z.current=null,q.current=null,W.current=null,X.current=null,Y.current=null,Z.current=null,d.current.textLabels=[],S.current=0,g.current=1,v.current=1,w.current=1,k.current=1,P.current.fill(0),A.current.fill(0),G.current.fill(0),j.current.fill(0),B.current=null,V({phase:e.phase,timer:e.timer,shots:e.shots,hits:e.hits,score:e.score,accuracy:e.accuracy,cursor:e.cursor}),t.current&&cancelAnimationFrame(t.current),E.current&&(clearTimeout(E.current),E.current=null),C.current&&(clearTimeout(C.current),C.current=null),s.pause("bgm"),s.pauseAll()},[]);(0,n.useEffect)(()=>{let e=e=>{let t=d.current;if("Escape"===e.code&&("playing"===t.phase||"paused"===t.phase)){t.phase="playing"===t.phase?"paused":"playing",V({phase:t.phase,timer:t.timer,shots:t.shots,hits:t.hits,score:t.score,accuracy:t.accuracy,cursor:t.cursor});return}"gameover"===t.phase&&"Space"===e.code?(ei(),es()):"title"===d.current.phase&&es()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ei,es]);let eu=(0,n.useCallback)(t=>{let r=d.current;if("playing"!==r.phase||r.cursor===c)return;let a=e.current;if(!a)return;let{left:n,top:l,width:s,height:i}=a.getBoundingClientRect(),h=(t.clientX-n)/s*r.dims.width,g=(t.clientY-l)/i*r.dims.height,f=r.fish.some(e=>h>=e.x&&h<=e.x+128&&g>=e.y&&g<=e.y+128)?o:u;f!==r.cursor&&$(f)},[$]),ec=(0,n.useCallback)(t=>{var r,a;null==(r=t.preventDefault)||r.call(t);let n=d.current;if("gameover"===n.phase){ei(),es();return}let l=e.current;if(!l)return void V({phase:n.phase,timer:n.timer,shots:n.shots,hits:n.hits,score:n.score,accuracy:n.accuracy,cursor:n.cursor});let i=l.getBoundingClientRect(),o=(t.clientX-i.left)/i.width*n.dims.width,h=(t.clientY-i.top)/i.height*n.dims.height,g=K.current;if(o>=g.x&&o<=g.x+g.width&&h>=g.y&&h<=g.y+g.height){("playing"===n.phase||"paused"===n.phase)&&(n.phase="playing"===n.phase?"paused":"playing",V({phase:n.phase,timer:n.timer,shots:n.shots,hits:n.hits,score:n.score,accuracy:n.accuracy,cursor:n.cursor}));return}if("playing"!==n.phase)return;$(c),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{$(u)},100),n.shots+=1,er(U.current,n.shots),s.play("shoot");for(let e=n.bubbles.length-1;e>=0;e--){let t=n.bubbles[e];if(o>=t.x&&o<=t.x+t.size&&h>=t.y&&h<=t.y+t.size){let[t]=n.bubbles.splice(e,1);t&&M.current.push(t),s.play("pop"),n.accuracy=n.shots>0?n.hits/n.shots*100:0,V({phase:n.phase,timer:n.timer,shots:n.shots,hits:n.hits,score:n.score,accuracy:n.accuracy,cursor:n.cursor});return}}let f=!1;for(let e=n.fish.length-1;e>=0;e--){let t=n.fish[e];if(o>=t.x&&o<=t.x+128&&h>=t.y&&h<=t.y+128){n.hits+=1,n.hitCounts[t.kind]=(n.hitCounts[t.kind]||0)+1,er(z.current,n.hits),s.play("hit"),f=!0;let r={brown:50,grey_long_a:5,grey_long_b:5},l=(t.isSkeleton?20:null!=(a=r[t.kind])?a:10)+n.conversions;if(n.score+=l,er(q.current,n.score),"brown"===t.kind){n.timer+=3,er(H.current,n.timer,2,":"),ee("+".concat(3),t.x,t.y,"#0f0");let[r]=n.fish.splice(e,1);r&&I.current.push(r),s.play("bonus")}else if("grey_long_a"===t.kind||"grey_long_b"===t.kind){n.timer+=5,er(H.current,n.timer,2,":"),ee("+".concat(5),t.x,t.y,"#f00");let r=t.pairId;if(void 0!==r){let e=n.fish.filter(e=>e.pairId===r);n.fish=n.fish.filter(e=>e.pairId!==r),I.current.push(...e)}else{let[t]=n.fish.splice(e,1);t&&I.current.push(t)}s.play("bonus")}else{let r=n.fish.filter(e=>e.isSkeleton||e.pendingSkeleton).length;if(t.isSkeleton)if(t.health=Math.max(0,t.health-1),t.health>0)t.hurtTimer=10,s.play("skeleton");else{let[t]=n.fish.splice(e,1);t&&I.current.push(t),s.play("death")}else if(.5>Math.random()&&r<20)t.isSkeleton=!0,t.health=1,t.hurtTimer=0,t.frame=0,t.frameCounter=0,delete t.groupId,s.play("skeleton");else{let[t]=n.fish.splice(e,1);t&&I.current.push(t),s.play("death")}}break}}f||n.missParticles.push({x:o,y:h,radius:0,alpha:1}),n.accuracy=n.shots>0?n.hits/n.shots*100:0,V({phase:n.phase,timer:n.timer,shots:n.shots,hits:n.hits,score:n.score,accuracy:n.accuracy,cursor:n.cursor})},[s,ee,er,ei,es]),eo=(0,n.useCallback)(e=>{e.preventDefault()},[]),eh=()=>1+(1-d.current.timer/99),ed=(0,n.useCallback)((e,t)=>{if("skeleton"===e)return[];let r=[],{width:a,height:n}=d.current.dims,l=["brown","grey_long_a","grey_long_b"],s=["grey_long"],i=l.includes(e)||s.includes(e),u=()=>I.current.pop()||{};i&&(t=1),t=Math.min(t,4);let c=Math.floor(4*Math.random()),o=2===c?-128:3===c?n+128:0,h=()=>{let e,t,r=eh(),a=(2*Math.random()+1)*r,n=(2*Math.random()-1)*r;switch(c){case 0:e=a,t=n;break;case 1:e=-a,t=n;break;case 2:e=n,t=a;break;default:e=n,t=-a}return _(e,t)};if(s.includes(e)){let e=v.current++,t=w.current++,{vx:l,vy:s}=h();if(0===c||1===c){let i=0===c?-256:a+256,o=Math.random()*n;["grey_long_a","grey_long_b"].forEach((a,n)=>{let h=u();h.id=g.current++,h.kind=a,h.x=i+(0===c?128*n:-(128*n)),h.y=o,h.vx=l,h.vy=s;let d=x(l,s);h.angle=d.angle,h.flipped=d.flipped,h.health=0,h.hurtTimer=0,h.isSkeleton=!1,h.groupId=e,h.pairId=t,r.push(h)})}else{let n=Math.random()*(a-256);["grey_long_a","grey_long_b"].forEach((a,i)=>{let c=u();c.id=g.current++,c.kind=a,c.x=n+128*i,c.y=o,c.vx=l,c.vy=s;let h=x(l,s);c.angle=h.angle,c.flipped=h.flipped,c.health=0,c.hurtTimer=0,c.isSkeleton=!1,c.groupId=e,c.pairId=t,r.push(c)})}}else{let s=0===c||1===c?0===c?-128:1===c?a+128:0:Math.random()*a,d=2===c||3===c?o:Math.random()*n,f=h(),m=t>1&&!l.includes(e)?v.current++:void 0;for(let l=0;l<t;l++){let t=s,o=d,h=f.vx,p=f.vy;if(void 0!==m&&l>0){0===c||1===c?(o+=(Math.random()-.5)*128,t+=0===c?-(64*Math.random()):64*Math.random()):(t+=(Math.random()-.5)*128,o+=2===c?-(64*Math.random()):64*Math.random());let e=_(h+=(Math.random()-.5)*.5,p+=(Math.random()-.5)*.5);h=e.vx,p=e.vy}else 0===c||1===c?o=Math.random()*n:t=Math.random()*a;let y=function(e,t,r,a,n,l){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=u();i.id=g.current++,i.kind=e,i.x=t,i.y=r,i.vx=a,i.vy=n;let c=x(a,n);return i.angle=c.angle,i.flipped=c.flipped,i.frame=0,i.frameCounter=0,i.health=0,i.hurtTimer=0,i.isSkeleton=!1,i.groupId=l,i.pairId=void 0,i.highlight=!!s||void 0,i.pendingSkeleton=void 0,i.flashTimer=void 0,i.wanderTimer=Math.floor(60*Math.random())+60,i}(e,t,o,h,p,m,i&&0===l);r.push(y)}}return d.current.fish.push(...r),r},[]);return(0,n.useEffect)(()=>{if("playing"!==Q.phase)return;let e=["blue","green","orange","pink","red"],t=()=>{let{timer:r,conversions:a}=d.current;T.current=setTimeout(()=>{if("playing"!==d.current.phase)return;ed(e[Math.floor(Math.random()*e.length)],Math.floor(5*Math.random())+1);let r=Math.random();r<.1?ed("brown",1):r<.15&&ed("grey_long",1),"playing"===d.current.phase&&t()},Math.max((1e3+2e3*Math.random())/(1+(1-r/99)+.1*a),250))};return t(),()=>{T.current&&(clearTimeout(T.current),T.current=null)}},[Q.phase,ed]),(0,n.useEffect)(()=>()=>{t.current&&cancelAnimationFrame(t.current)},[]),{ui:Q,canvasRef:e,handleMouseMove:eu,handleClick:ec,handleContext:eo,resetGame:ei,startSplash:es,getImg:a,ready:l,spawnFish:ed}}(),[w,k]=(0,n.useState)(!1),I=(0,n.useCallback)(()=>{v?h():k(!0)},[v,h]);(0,n.useEffect)(()=>{v&&w&&(h(),k(!1))},[v,w,h]);let{phase:M}=e;return"title"===M?(0,a.jsx)(d,{onStart:I,titleSrc:i("/assets/titles/zombiefish_title.png"),backgroundColor:"#1d8fde",cursor:u}):(0,a.jsx)(g,{ui:e,canvasRef:t,handleClick:l,handleContext:s,handleMouseMove:r})}function w(){return(0,a.jsx)(l.A,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:(0,a.jsx)(v,{})})}},6567:(e,t,r)=>{Promise.resolve().then(r.bind(r,3169))}},e=>{var t=t=>e(e.s=t);e.O(0,[213,441,684,358],()=>t(6567)),_N_E=e.O()}]);