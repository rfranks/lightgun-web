(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[798],{5263:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>L});var a=t(5155),n=t(2115),s=t(4991);let o="/lightgun-web";function u(e){return"".concat(o).concat(e)}let l=[],i="#6CA6CD",c="url('".concat(o,"/assets/shooting-gallery/PNG/HUD/crosshair_red_small.png') 16 16, auto"),m="url('".concat(o,"/assets/shooting-gallery/PNG/Objects/shot_brown_large.png') 16 16, auto");var h=t(6259);let g=e=>{let{onStart:r,titleSrc:t,backgroundColor:n,cursor:s}=e;return(0,a.jsx)(h.A,{position:"relative",width:"100vw",height:"100dvh",sx:{backgroundColor:n,cursor:s},display:"flex",justifyContent:"center",alignItems:"center",onClick:r,children:(0,a.jsx)(h.A,{component:"img",src:t,alt:"Warbirds",sx:{width:"auto",height:"100%",cursor:s}})})},p="/assets/shooting-gallery/PNG/HUD/text_",d=["/assets/tappyplane/PNG/Planes/planeBlue1.png","/assets/tappyplane/PNG/Planes/planeGreen1.png","/assets/tappyplane/PNG/Planes/planeRed1.png"],f=["green","red"],x=function(e){var r,t;let{ui:n,canvasRef:s,handleClick:o,handleContext:l,resetGame:i,getImg:m}=e,{ammo:g,medalCount:f,duckCount:x,enemyCount:y,score:w,crashed:v,frameCount:C,activePowerups:b,cursor:k,phase:I}=n,M=m("medalFrames");return(0,a.jsxs)(h.A,{position:"relative",width:"100vw",height:"100dvh",children:[(0,a.jsx)(h.A,{position:"absolute",top:16,left:16,display:"flex",zIndex:1,onClick:l,children:Array.from({length:12}).map((e,r)=>(0,a.jsx)(h.A,{component:"img",src:r<g?u("/assets/tanks/PNG/Retina/tank_bullet5.png"):u("/assets/tanks/PNG/Retina/tank_bullet1.png"),width:64,height:64,sx:{mr:1.5,rotate:"-90deg",cursor:c}},r))}),f>0&&(0,a.jsxs)(h.A,{position:"absolute",top:56,left:16,display:"flex",alignItems:"center",zIndex:1,sx:{cursor:c},children:[(0,a.jsx)(h.A,{component:"img",src:(null==(t=M[0])||null==(r=t[0])?void 0:r.src)||u("/assets/medals/PNG/flat_medal1.png"),width:48,height:48,sx:{mr:2}}),(0,a.jsxs)(h.A,{component:"span",sx:{fontSize:48,color:"white",fontWeight:"bold"},children:["x",f]})]}),x>0&&(0,a.jsxs)(h.A,{position:"absolute",top:112,left:16,display:"flex",alignItems:"center",zIndex:1,sx:{cursor:c},children:[(0,a.jsx)(h.A,{component:"img",src:u("/assets/shooting-gallery/PNG/Objects/duck_brown.png"),width:48,height:48,sx:{mr:2}}),(0,a.jsxs)(h.A,{sx:{fontSize:48,color:"white",fontWeight:"bold"},children:["x",x]})]}),y>0&&(0,a.jsxs)(h.A,{position:"absolute",top:168,left:16,display:"flex",alignItems:"center",zIndex:1,sx:{cursor:c},children:[(0,a.jsx)(h.A,{component:"img",src:u(d[0]),width:48,height:48,sx:{mr:2}}),(0,a.jsxs)(h.A,{sx:{fontSize:48,color:"white",fontWeight:"bold"},children:["x",y]})]}),(0,a.jsxs)(h.A,{position:"absolute",top:16,right:16,display:"flex",alignItems:"center",zIndex:1,children:[(0,a.jsx)(h.A,{component:"img",src:u("/assets/shooting-gallery/PNG/HUD/text_score_small.png"),alt:"Score",sx:{mr:1}}),String(w).split("").map((e,r)=>(0,a.jsx)(h.A,{component:"img",src:u("".concat(p).concat(e,".png")),alt:e,width:24,height:32,sx:{mr:.5}},r))]}),(0,a.jsx)("canvas",{ref:s,onClick:o,onContextMenu:l,style:{display:"block",width:"100%",height:"100%",cursor:k}}),v&&"playing"===I&&(0,a.jsx)(h.A,{component:"img",src:u("/assets/shooting-gallery/PNG/HUD/text_gameover.png"),alt:"Game Over",onClick:i,sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:450,height:"auto",cursor:c}}),!v&&(0,a.jsx)(h.A,{position:"absolute",bottom:16,right:16,display:"flex",gap:1,zIndex:2,children:Object.keys(b).filter(e=>b[e].expires>C).map(e=>{let r=b[e].expires-C,t=m("powerupImgs")[e].src;return(0,a.jsx)(h.A,{component:"img",src:t,width:64,height:64,sx:{opacity:r<60&&r%10<5?.3:1}},e)})})]})},y=["/assets/tappyplane/PNG/groundDirt.png","/assets/tappyplane/PNG/groundGrass.png","/assets/tappyplane/PNG/groundIce.png","/assets/tappyplane/PNG/groundRock.png","/assets/tappyplane/PNG/groundSnow.png"],w=["/assets/shooting-gallery/PNG/Stall/tree_oak.png","/assets/shooting-gallery/PNG/Stall/tree_pine.png"],v=["/assets/shooting-gallery/PNG/Stall/water1.png","/assets/shooting-gallery/PNG/Stall/water2.png"],C=["/assets/tappyplane/PNG/rock.png","/assets/tappyplane/PNG/rockGrass.png","/assets/tappyplane/PNG/rockIce.png","/assets/tappyplane/PNG/rockSnow.png"],b=["artillery","bomb","coin2x","ducksight","freeze","ghost","homing","hourglass","infiniteAmmo","machineGuns","autoReload","megaducks","napalm","magnet","shield","supershield","shrink","skull","gunjam","sticky","heavy","spray","supermag","laserbeam","thunderstrike","windy","turbulence","blindfold","wings"],k=["skull","gunjam","sticky","heavy","windy","turbulence","blindfold"],I=["artillery","freeze","supermag","megaducks","napalm","supershield","laserbeam","thunderstrike"],M=["/assets/flame/flame_frame_1.png","/assets/flame/flame_frame_2.png","/assets/flame/flame_frame_3.png","/assets/flame/flame_frame_4.png"];function A(e,r,t){let a={artillery:{expires:0},bomb:{expires:0},coin2x:{expires:0},ducksight:{expires:0},freeze:{expires:0},ghost:{expires:0},gunjam:{expires:0},heavy:{expires:0},homing:{expires:0},hourglass:{expires:0},infiniteAmmo:{expires:0},machineGuns:{expires:0},autoReload:{expires:0},megaducks:{expires:0},magnet:{expires:0},napalm:{expires:0},shield:{expires:0},supershield:{expires:0},shrink:{expires:0},skull:{expires:0},spray:{expires:0},sticky:{expires:0},supermag:{expires:0},laserbeam:{expires:0},thunderstrike:{expires:0},windy:{expires:0},turbulence:{expires:0},blindfold:{expires:0},wings:{expires:0}};l.forEach(e=>{a[e].expires=1200});let n=(e,r)=>a[e].expires>0&&a[e].expires>r;return{dims:e,assets:r,audio:t,cursor:c,frameCount:0,gameOver:!1,y:.2*e.height,vy:0,groundOffset:0,score:0,ammo:12,medalCount:0,duckCount:0,enemyCount:0,dynamicDensity:.01,enemies:[],airships:[],mountains:[],trees:[],clouds:[],waters:[],shotLakes:new Set,ducks:[],powerups:[],medals:[],cannonballs:[],homingMissiles:[],artilleryShells:[],laserBeams:[],napalmMissiles:[],napalmTiles:[],laserBurstRemaining:0,laserBurstCooldown:0,burstRemaining:0,burstCooldown:0,puffs:[],sparkEffects:[],bulletHoles:[],floatingScores:[],falling:[],activePowerups:a,shieldFlash:0,screenShake:0,thunderCooldown:0,crashed:!1,crashHandled:!1,groundCrashPuffsLeft:0,planeFrame:0,planeFrameCounter:0,groundIndex:0,planeAngle:0,smokeSpawned:!1,groundContactFrames:0,whooshPlaying:!1,artilleryPlaying:!1,missileThrusterPlaying:!1,textLabels:[],streak:0,ouchFrames:0,ouchExplodeIdx:0,readyTimeout:0,goTimeout:0,beepTimeouts:[],countdown:null,countdownTimeouts:[],isActive:n,enemySpeed:e=>n("hourglass",e)?2.5:5,groundSpeed:e=>n("hourglass",e)?1:2,phase:"title"}}let P=["/assets/tanks/PNG/Retina/tank_explosion2.png","/assets/tanks/PNG/Retina/tank_explosion3.png","/assets/tanks/PNG/Retina/tank_explosion4.png"],S=["/assets/shooting-gallery/PNG/Objects/duck_brown.png","/assets/shooting-gallery/PNG/Objects/duck_white.png","/assets/shooting-gallery/PNG/Objects/duck_yellow.png"],_=["/assets/shooting-gallery/PNG/Objects/duck_outline_brown.png","/assets/shooting-gallery/PNG/Objects/duck_outline_white.png","/assets/shooting-gallery/PNG/Objects/duck_outline_yellow.png"],G=["/assets/shooting-gallery/PNG/Objects/duck_target_brown.png","/assets/shooting-gallery/PNG/Objects/duck_target_white.png","/assets/shooting-gallery/PNG/Objects/duck_target_yellow.png"],E=function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let a=new Audio,n=!1;function s(e){if(!a)return;let t=e.split(".").pop()||"",o="mp3"===t?"audio/mpeg":"audio/".concat(t);if(""===a.canPlayType(o))return void("mp3"===t.toLowerCase()||n?console.warn("Skipping audio load, unsupported type: ".concat(o)):(n=!0,s(e.replace(/\.[^/.]+$/,".mp3"))));a.src=u(e),a.loop=r,a.load()}function o(){if(n)return void console.warn("Failed to load Audio (all formats):",e);"mp3"!==(e.split(".").pop()||"").toLowerCase()?(n=!0,s(e.replace(/\.[^/.]+$/,".mp3"))):console.warn("Failed to load Audio:",e)}a.addEventListener("error",o);try{s(e)}catch(r){console.warn("Failed to create/load Audio:",e,r)}return t.current=a,()=>{null==a||a.removeEventListener("error",o),a=null}},[e,r]),t},F=e=>{e&&e.current&&e.current.pause()},N=function(e,r){let t,a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&e.current){if("string"==typeof r?(t=r,a=n):a=r||{},t){var s,o;let r=null!=(o=null==(s=t.split(".").pop())?void 0:s.toLowerCase())?o:"";e.current.canPlayType&&""===e.current.canPlayType("mp3"===r?"audio/mpeg":"audio/".concat(r))&&"mp3"!==r&&""!==e.current.canPlayType("audio/mpeg")&&(t=t.replace(/\.[^/.]+$/,".mp3")),e.current.src=t,e.current.load&&e.current.load()}a.loop?e.current.loop=!0:e.current.loop=!1,void 0!==a.volume?e.current.volume=a.volume:e.current.volume=1,e.current.currentTime=0,e.current.play()}};function R(e){let{textLabels:r,ctx:t,offsetX:a,offsetY:n,cull:s}=e,o=t.globalAlpha;return r.forEach(e=>{t.globalAlpha=e.fade?1-e.age/e.maxAge:1;let r=e.fixed?e.x:e.x-(a||0);for(let a of e.imgs)if(a){let s=a.width*e.scale,o=a.height*e.scale;t.drawImage(a,r,e.y-(n||0),s,o),r+=s+2}else r+=e.spaceGap;e.age++}),t.globalAlpha=o,s&&(r=r.filter(e=>e.age<e.maxAge)),r}function j(e,r,t){let{text:a,scale:n,fixed:s,fade:o,x:u,y:l,maxAge:i}=e,{spaceGap:c}=e,{getImg:m}=r;if(!m)throw Error("Asset manager does not have getImg method");let h=m("letterImgs"),g=m("numberImgs"),p=m("digitImgs"),d=0;c=c||1.5*h.A.width*n;let f=[];return Array.from(a).forEach(e=>{if(" "===e)d+=c,f.push(null);else{let r=h[e.toUpperCase()]||g[e]||p[e];r&&(d+=r.width*n+2,f.push(r))}}),{text:a,imgs:f,scale:n,fixed:s,fade:o,x:null!=u?u:(null==t?void 0:t.width)!==void 0?(t.width-d)/2:0,y:null!=l?l:(null==t?void 0:t.height)!==void 0?.2*t.height:0,age:0,maxAge:i||(o?60:1/0),spaceGap:c}}let T=function(){let e=(0,n.useRef)(null),r=(0,n.useRef)(null),t=function(){let e=E("/audio/whistle_fall.ogg",!0),r=E("/audio/explosionCrunch_000.ogg"),t=E("/audio/splash.ogg"),a=E("/audio/drop_003.ogg"),s=E("/audio/drop_004.ogg"),o=E("/audio/explosionCrunch_004.ogg"),u=E("/audio/laserRetro_000.ogg"),l=E("/audio/explosionCrunch_002.ogg"),i=E("/audio/select_003.ogg"),c=E("/audio/laser9.ogg"),m=E("/audio/click_001.ogg"),h=E("/audio/engineCircular_001.ogg",!0),g=E("/audio/freeze.ogg"),p=E("/audio/select_005.ogg"),d=E("/audio/explosionCrunch_002.ogg"),f=E("/audio/explosionCrunch_001.ogg"),x=E("/audio/confirmation_003.ogg"),y=E("/audio/explosionCrunch_000.ogg"),w=E("/audio/powerUp8.ogg"),v=E("/audio/scratch_003.ogg"),C=E("/audio/forceField_002.ogg"),b=E("/audio/phaserDown1.ogg"),k=E("/audio/lowDown.ogg"),I=E("/audio/laserSmall_001.ogg"),M=E("/audio/laser4.ogg"),A=E("/audio/thunderstrike.ogg"),P=E("/audio/thrusterFire_000.ogg",!0),S=E("/audio/whoosh.ogg",!0),_=(0,n.useMemo)(()=>({artillerySfx:e,artilleryExplodeSfx:r,artillerySplashSfx:t,beepSfx:a,boopSfx:s,bombSfx:o,cannonballSfx:u,crashSfx:l,duckSfx:i,enemyHitSfx:c,flapSfx:m,freezeSfx:g,flightSfx:h,gameOverSfx:p,groundTouchSfx:d,homingExplSfx:f,medalSfx:x,napalmExplodeSfx:y,powerupSfx:w,reloadSfx:v,shieldSfx:C,shrinkSfx:b,skullSfx:k,laserBeamFireSfx:I,shotSfx:M,thunderSfx:A,thrusterSfx:P,whooshSfx:S}),[e,r,t,a,s,o,u,l,i,c,m,g,h,p,d,f,x,y,w,v,C,b,k,I,M,A,P,S]),G=(0,n.useCallback)((e,r)=>{let t=_[e];t&&t.current&&N(t,r||{loop:t.current.loop,volume:t.current.volume})},[_]),R=(0,n.useCallback)(e=>{let r=_[e];r&&r.current&&F(r)},[_]),j=(0,n.useCallback)(()=>{Object.values(_).forEach(e=>{e.current&&F(e)})},[_]);return(0,n.useMemo)(()=>({play:G,pause:R,pauseAll:j}),[G,R,j])}(),{play:a,pause:s}=t,o=function(){let[e,r]=(0,n.useState)(!1),t=(0,n.useRef)({});return(0,n.useEffect)(()=>{let e=e=>{let r=new window.Image;return r.src=u(e),r};t.current.airshipFrames=Object.fromEntries(f.map(r=>[r,[1,2,3].map(t=>e("/assets/airships/airship_".concat(r,"_").concat(t,".png")))])),t.current.artilleryImg=e("/assets/tanks/PNG/Retina/tank_bulletFly6.png"),t.current.blackSmokeImgs=Array.from({length:25},(r,t)=>e("/assets/smoke/PNG/Black smoke/blackSmoke".concat(String(t).padStart(2,"0"),".png"))),t.current.brokenStickImg=e("/assets/shooting-gallery/PNG/Objects/stick_wood_broken.png"),t.current.bulletHoleImg=e("/assets/shooting-gallery/PNG/Objects/shot_brown_large.png"),t.current.cannonballImg=e("/assets/pirates/PNG/Retina/Ship parts/cannonBall.png"),t.current.digitImgs={};for(let r=0;r<=9;r++)t.current.digitImgs[r.toString()]=e("".concat(p).concat(r,".png"));t.current.duckImgs=S.map(e),t.current.duckOutlineImgs=_.map(e),t.current.duckTargetImgs=G.map(e),t.current.enemyImgs=d.map(e),t.current.enemyFrames=d.map(r=>[1,2,3].map(t=>e(r.replace(/1\.png$/,"".concat(t,".png"))))),t.current.explosionImgs=P.map(e),t.current.fireImgs=[e("/assets/pirates/PNG/Retina/Effects/fire1.png"),e("/assets/pirates/PNG/Retina/Effects/fire2.png")],t.current.flameImgs=M.map(e),t.current.groundImgs=y.map(e),t.current.homingImg=e("/assets/tanks/PNG/Retina/tank_bullet3.png"),t.current.letterImgs={};for(let r=65;r<=90;r++){let a=String.fromCharCode(r);t.current.letterImgs[a]=e("/assets/tappyplane/PNG/Letters/letter".concat(a,".png"))}t.current.medalFrames=[];for(let r=1;r<=9;r++)t.current.medalFrames.push([e("/assets/medals/PNG/flat_medal".concat(r,".png")),e("/assets/medals/PNG/flatshadow_medal".concat(r,".png")),e("/assets/medals/PNG/shaded_medal".concat(r,".png"))]);t.current.napalmImg=e("/assets/tanks/PNG/Retina/tank_bullet4.png"),t.current.numberImgs={};for(let r=0;r<=9;r++)t.current.numberImgs[r.toString()]=e("/assets/tappyplane/PNG/Numbers/number".concat(r,".png"));t.current.planeFrames=[1,2,3].map(r=>e("/assets/tappyplane/PNG/Planes/planeYellow".concat(r,".png"))),t.current.planeImg=t.current.planeFrames[0],t.current.plusImg=e("/assets/shooting-gallery/PNG/HUD/text_plus_small.png"),t.current.powerupImgs=Object.fromEntries(b.map(r=>[r,e("/assets/powerups/".concat(r,".png"))])),t.current.powerupImgs.coin2x=e("/assets/powerups/coin_2x.png"),t.current.powerupImgs.infiniteAmmo=e("/assets/powerups/infinite_ammo.png"),t.current.powerupImgs.machineGuns=e("/assets/powerups/machine_guns.png"),t.current.powerupImgs.autoReload=e("/assets/powerups/autoReload.png"),t.current.powerupImgs.shrink=e("/assets/powerups/shrink_effect.png"),t.current.puffLargeImg=e("/assets/tappyplane/PNG/puffLarge.png"),t.current.puffSmallImg=e("/assets/tappyplane/PNG/puffSmall.png"),t.current.rockImgs=C.map(e),t.current.shieldImg=e("/assets/particles/PNG (Transparent)/circle_03.png"),t.current.sparkImgs=Array.from({length:7},(r,t)=>e("/assets/particles/PNG (Transparent)/spark_0".concat(t+1,".png"))),t.current.laserBeamImgs=[e("/assets/space-shooter-redux/PNG/Lasers/laserRed04.png"),e("/assets/space-shooter-redux/PNG/Lasers/laserRed04.png")],t.current.stickImg=e("/assets/shooting-gallery/PNG/Objects/stick_wood.png"),t.current.targetImgs=[e("/assets/shooting-gallery/PNG/Objects/target_red1.png"),e("/assets/shooting-gallery/PNG/Objects/target_red2.png"),e("/assets/shooting-gallery/PNG/Objects/target_red3.png")],t.current.treeImgs=w.map(e),t.current.waterImgs=v.map(e),t.current.whitePuffImgs=Array.from({length:25},(r,t)=>e("/assets/smoke/PNG/White puff/whitePuff".concat(String(t).padStart(2,"0"),".png"))),r(!0)},[]),{get:(0,n.useCallback)(e=>t.current[e],[]),getImg:(0,n.useCallback)(e=>{var r;return null!=(r=t.current[e])?r:void 0},[]),assetRefs:t.current,ready:e}}(),{getImg:h,ready:g}=o,x=function(){let[e,r]=(0,n.useState)({width:0,height:0});return(0,n.useEffect)(()=>{function e(){r({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e}(),T=x.width>0&&x.height>0?x:{width:window.innerWidth,height:window.innerHeight},O=(0,n.useRef)(A(T,o,t)),L=(0,n.useRef)(!1),[z,B]=(0,n.useState)({...O.current}),D=(0,n.useCallback)(()=>{let e=O.current;(z.score!==e.score||z.medalCount!==e.medalCount||z.duckCount!==e.duckCount||z.enemyCount!==e.enemyCount||z.ammo!==e.ammo||z.crashed!==e.crashed||z.frameCount!==e.frameCount||JSON.stringify(z.activePowerups)!==JSON.stringify(e.activePowerups)||z.cursor!==e.cursor||z.countdown!==e.countdown||z.phase!==e.phase)&&B({score:e.score,medalCount:e.medalCount,duckCount:e.duckCount,enemyCount:e.enemyCount,ammo:e.ammo,crashed:e.crashed,activePowerups:Object.fromEntries(Object.entries(e.activePowerups).map(e=>{let[r,t]=e;return[r,{expires:t.expires}]})),frameCount:e.frameCount,cursor:e.cursor,countdown:e.countdown,phase:e.phase})},[z.score,z.medalCount,z.duckCount,z.enemyCount,z.ammo,z.crashed,z.frameCount,z.activePowerups,z.cursor,z.countdown,z.phase]),H=(0,n.useCallback)(e=>{let r=O.current.isActive("coin2x",O.current.frameCount)&&e>0;O.current.score+=Math.max(r?2*e:e,0)},[O]),Y=(0,n.useCallback)(()=>{O.current={...A(x,o,t),groundIndex:Math.floor(Math.random()*h("groundImgs").length)}},[x,o,t,h]),W=(0,n.useCallback)((e,r,t,a,n,s,u)=>{let l=j({text:e,scale:r,fixed:t,fade:a,x:n,y:s,maxAge:u},o,x);O.current.textLabels.push(l)},[o,x]),U=(0,n.useCallback)((e,r,t)=>{let n=6+Math.floor(4*Math.random());for(let a=0;a<n;a++){let a=Math.random()*Math.PI*2,n=Math.sqrt(Math.random()),s=Math.cos(a)*n*200,o=Math.sin(a)*n*100;O.current.napalmTiles.push({x:e+s,y:r+o,vy:0,life:600,maxLife:600,killsPlayer:t})}a("napalmExplodeSfx")},[a]),X=(0,n.useCallback)((e,r)=>{let t=h("blackSmokeImgs"),a=t[Math.floor(Math.random()*t.length)];O.current.puffs.push({x:e-16,y:r-16,vy:-(+Math.random()+.5),img:a,age:0,maxAge:60})},[h]),$=(0,n.useCallback)((e,r)=>(function(e,r,t,a){let n=3+Math.floor(3*Math.random()),s=50+.1*r*Math.random(),o=[];for(let e=0;e<n;e++){let e=t[Math.floor(Math.random()*t.length)],r=(Math.random()-.5)*200,a=(Math.random()-.5)*50,n=1+.5*Math.random();o.push({img:e,dx:r,dy:a,scale:n})}return{x:e+100,y:s,vx:-1*a()*.3,puffs:o}})(e,r,h("whitePuffImgs"),()=>O.current.groundSpeed(O.current.frameCount)),[h,O]),q=(0,n.useCallback)((e,r)=>(function(e,r,t,a,n,s){let o=e+300*Math.random(),u=200+100*Math.random();return Array.from({length:3+Math.floor(3*Math.random())}).map((n,s)=>{let l=function(e,r,t,a,n,s){let o=t[Math.floor(Math.random()*t.length)],u=1+Math.random()*(2-n),l=u*(.8+.4*Math.random())*3,i=2*u,c=o.width*l,m=o.height*i;return{x:e+200*Math.random(),y:r-50-m,vx:-1*a()*.2,img:o,width:c,height:m,scaleX:l,scaleY:i}}(e,r,t,a,1,2);return l.x=o+s*u*(.8+.4*Math.random()),l})})(e,r,h("rockImgs"),()=>O.current.groundSpeed(O.current.frameCount),0,0),[h,O]),J=(0,n.useCallback)((e,r,t)=>(function(e,r,t,a,n){let s=t[Math.floor(Math.random()*t.length)],o=null!=n?n:.5+Math.random(),u=s.width*o,l=s.height*o;return{x:e+200*Math.random(),y:r-50-l+40,vx:-1*a()*.2,img:s,width:u,height:l,scaleX:o,scaleY:o}})(e,r,h("treeImgs"),()=>O.current.groundSpeed(O.current.frameCount),t),[h,O]),V=(0,n.useCallback)((e,r)=>{a("shotSfx");let t=h("powerupImgs"),n=-8;O.current.isActive("heavy",O.current.frameCount)&&(n*=.5),O.current.isActive("sticky",O.current.frameCount)&&(n=0),O.current.isActive("wings",O.current.frameCount)&&(n*=2),O.current.y;let s=!1;for(let a=0;a<O.current.airships.length;a++){let n=O.current.airships[a],o=80*Math.sin(.05*O.current.frameCount+n.bobOffset),u=n.baseY+o;if(e>=n.x&&e<=n.x+164&&r>=u&&r<=u+164){if(s=!0,O.current.airships.splice(a,1),"green"===n.color){let e=I[Math.floor(Math.random()*I.length)];O.current.powerups.push({x:n.x,y:u,img:t[e],type:e})}else{U(n.x+82,u+82,!0);let e=k[Math.floor(Math.random()*k.length)];O.current.powerups.push({x:n.x,y:u,img:t[e],type:e})}break}}for(let t=0;t<O.current.ducks.length;t++){let n=O.current.ducks[t],o=O.current.isActive("megaducks",O.current.frameCount)?3:O.current.isActive("ducksight",O.current.frameCount)?1.33:1,u=n.width*o,l=n.height*o,i=(u-n.width)/2,c=(l-n.height)/2,m=n.x-i,g=n.y-c;if(!n.hit&&e>=m&&e<=m+u&&r>=g&&r<=g+l){a("duckSfx"),H(1e3),n.hit=!0,n.fadeAge=0,n.fadeMax=60,n.targetImg=h("duckTargetImgs")[n.srcIdx],O.current.floatingScores.push({x:n.x+n.width/2,y:n.y+n.height/2,vy:-1,amount:1e3,age:0,maxAge:60}),O.current.shotLakes.add(n.waterRef),O.current.duckCount+=1,s=!0;break}}for(let t=0;t<O.current.powerups.length;t++){let n=O.current.powerups[t];if(!n.collected&&e>=n.x&&e<=n.x+128&&r>=n.y&&r<=n.y+128){n.collected=!0,["bomb"].includes(n.type)?(a("bombSfx"),O.current.activePowerups.bomb.expires=O.current.frameCount+1):k.includes(n.type)?["sticky","heavy","windy","turbulence","blindfold"].includes(n.type)?(O.current.activePowerups[n.type].expires=O.current.frameCount+1200,"turbulence"===n.type?W("Turbulence!",1,!0,!0,x.width-800,.8*x.height,120):"blindfold"===n.type&&W("Blinded!",1,!0,!0,x.width-800,.8*x.height,120)):O.current.activePowerups[n.type].expires=O.current.frameCount+30:"machineGuns"===n.type?(O.current.activePowerups.machineGuns.expires=O.current.frameCount+1200,O.current.burstRemaining=5,O.current.burstCooldown=0):"autoReload"===n.type?(O.current.activePowerups.autoReload.expires=O.current.frameCount+1200,a("powerupSfx")):"shrink"===n.type?(O.current.activePowerups.shrink.expires=O.current.frameCount+1200,a("shrinkSfx")):"freeze"===n.type?(O.current.activePowerups.freeze.expires=O.current.frameCount+1200,a("freezeSfx")):(O.current.activePowerups[n.type].expires=O.current.frameCount+1200,a("powerupSfx")),"skull"===n.type?(a("skullSfx"),Object.keys(O.current.activePowerups).forEach(e=>{"skull"!==e&&(O.current.activePowerups[e].expires=0)}),H(-500),W("Skull! Lose 500",1,!0,!0,x.width-800,.8*x.height,120)):"gunjam"===n.type&&(O.current.activePowerups.gunjam.expires=O.current.frameCount+1200,H(-25),a("reloadSfx"),W("Gunjam Lose 25",1,!0,!0,x.width-800,.8*x.height,120),O.current.ammo=0),s=!0,O.current.powerups.splice(t,1);break}}for(let t=0;t<O.current.medals.length;t++){let n=O.current.medals[t];if(e>=n.x&&e<=n.x+64&&r>=n.y&&r<=n.y+64){a("medalSfx"),H(500),O.current.floatingScores.push({x:n.x+32,y:n.y+32,vy:-1,amount:500,age:0,maxAge:60}),O.current.medals.splice(t,1),O.current.medalCount+=1,s=!0;break}}let o=h("targetImgs")[0],u=o.width,i=o.height;for(let n of O.current.enemies){let o=n.hasStick?0:101.25-i;if(n.alive&&n.hasStick&&!n.stickBroken&&e>=n.x+67.5-u/2&&e<=n.x+67.5+u/2&&r>=n.y+o&&r<=n.y+o+i&&(s=!0,n.stickBroken=!0,n.targetHit=!0,a("enemyHitSfx"),H(n.targetScore),O.current.floatingScores.push({x:n.x+67.5,y:n.y+o+i/2,vy:-1,amount:n.targetScore,age:0,maxAge:60})),!s&&n.alive&&e>=n.x&&e<=n.x+135&&r>=n.y&&r<=n.y+101.25){s=!0,n.alive=!1,a("enemyHitSfx"),H(100);let e=n.x+67.5,r=n.y+50.625;if(O.current.enemyCount+=1,.3>Math.random()){let t=Math.floor(9*Math.random()),a=h("medalFrames")[t];O.current.medals.push({x:e-32,y:r-32,vx:-O.current.groundSpeed(O.current.frameCount),frames:a,frameIndex:0,frameCounter:0,frameRate:8,id:t+1})}else if(.5>Math.random()){let a=l.length>0?l[Math.floor(Math.random()*l.length)]:b[Math.floor(Math.random()*b.length)];0===l.length&&!k.includes(a)&&.5>Math.random()&&(a=k[Math.floor(Math.random()*k.length)]),O.current.powerups.push({x:e-16,y:r-16,img:t[a],type:a})}O.current.floatingScores.push({x:e,y:r,vy:-1,amount:100,age:0,maxAge:60});let o=h("explosionImgs"),u=Math.floor(3*Math.random());if(0===u)for(let t=0;t<5;t++)setTimeout(()=>X(e,r),100*t);else 1===u?o.forEach((t,a)=>setTimeout(()=>O.current.puffs.push({x:e-16,y:r-16,img:t,vy:0,age:0,maxAge:10,size:96}),50*a)):(O.current.puffs.push({x:e-48,y:r-48,img:o[0],vy:0,age:0,maxAge:10,size:96}),O.current.falling.push({x:n.x,y:n.y,vy:0,img:n.frames[0]}));break}}s||(H(-25),O.current.streak=0,O.current.bulletHoles.push({x:e,y:r,age:0,maxAge:180})),(s||0)&&(O.current.streak+=1,O.current.streak>=3&&W("Streak: ".concat(O.current.streak),1,!0,!0,x.width-800,88,120))},[a,h,O,H,U,W,x.width,x.height,X]),K=(0,n.useCallback)(e=>!!z.activePowerups[e]&&z.activePowerups[e].expires>z.frameCount,[z.activePowerups,z.frameCount]),Q=(0,n.useCallback)(()=>{r.current&&cancelAnimationFrame(r.current),O.current.countdownTimeouts.forEach(clearTimeout),O.current.countdownTimeouts=[];let e=x.width>0&&x.height>0?x:{width:window.innerWidth,height:window.innerHeight},n=j({text:"READY",scale:4,fixed:!0,fade:!1,y:.3*e.height,maxAge:180},o,e);O.current.textLabels.push(n);let s=r=>{let t=j({text:"".concat(r),scale:3,fixed:!0,fade:!0,y:.55*e.height,maxAge:60},o,e);O.current.textLabels.push(t)},u="ready";O.current.phase=u,O.current.countdown=3,B(e=>({...e,countdown:3,phase:u})),s(3),O.current.countdownTimeouts.push(window.setTimeout(()=>{O.current.countdown=2,B(e=>({...e,countdown:2})),s(2)},1e3),window.setTimeout(()=>{O.current.countdown=1,B(e=>({...e,countdown:1})),s(1)},2e3),window.setTimeout(()=>{O.current.countdown=null,B(e=>({...e,countdown:null}))},3e3),window.setTimeout(()=>{let r=j({text:"GO",scale:4,fixed:!0,fade:!0,y:.4*e.height,maxAge:60},o,e);O.current.textLabels.push(r),O.current.phase="go",B(e=>({...e,phase:"go"}))},3e3),window.setTimeout(()=>{let r="playing";O.current={...A(e,o,t),groundIndex:Math.floor(Math.random()*h("groundImgs").length),countdown:null,countdownTimeouts:[],phase:r},B(e=>({...e,phase:r}))},3500)),a("flightSfx")},[x,o,t,h,a]),Z=(0,n.useCallback)(()=>{if(console.log("Game initLoop"),L.current)return void console.log("initLoop called, but loop already runningâ€”skipping.");L.current=!0;let t=h("waterImgs");r.current&&cancelAnimationFrame(r.current);let n=e.current;if(!n)return;let o=n.getContext("2d");if(!o)return;let{width:u,height:l}=x;n.width=u,n.height=l,Y(),O.current.phase="playing",a("flightSfx");let m=l-50,g=h("groundImgs"),p=g[0].width,d=!1,y=c,w=()=>{O.current.isActive("blindfold",O.current.frameCount)?(d||(y=O.current.cursor,d=!0),O.current.cursor="none"):d&&(O.current.cursor=y,d=!1);let e=O.current.isActive("shrink",O.current.frameCount)?.4:1,c=O.current.isActive("freeze",O.current.frameCount)?0:O.current.isActive("hourglass",O.current.frameCount)?.15:.3,v=O.current.isActive("wings",O.current.frameCount)?-16:-8;if(O.current.isActive("thunderstrike",O.current.frameCount)&&(O.current.thunderCooldown-=1,O.current.thunderCooldown<=0)){O.current.thunderCooldown=180;let e=[...O.current.enemies.filter(e=>e.alive)];if(e.length>0){let r=235,t=O.current.y+50.625;e.sort((e,a)=>Math.hypot(r-e.x,t-e.y)-Math.hypot(r-a.x,t-a.y));let n=[],s=e[0];n.push(s);let o=s.x,u=s.y;for(let r=1;r<e.length&&n.length<3;r++)300>Math.hypot(o-e[r].x,u-e[r].y)&&n.push(e[r]);n.forEach((e,r)=>{if("alive"in e&&(e.alive=!1),"hit"in e&&(e.hit=!0),O.current.floatingScores.push({x:e.x,y:e.y,vy:-1,amount:200,age:0,maxAge:60}),H(200),O.current.enemyCount+=1,O.current.sparkEffects.push({x:e.x,y:e.y-50,age:0,maxAge:60,frameIndex:0}),r>0){let r=n[0];O.current.sparkEffects.push({x:(r.x+e.x)/2,y:(r.y+e.y)/2-30,age:0,maxAge:20,frameIndex:0})}}),a("thunderSfx")}}if(O.current.isActive("homing",O.current.frameCount)&&.01>Math.random()){let e=O.current.enemies[0];O.current.homingMissiles.push({x:235,y:O.current.y+50.625,vx:0,vy:0,img:h("homingImg"),tailFrame:0,tailCounter:0,life:120,target:e})}if(O.current.isActive("artillery",O.current.frameCount)&&.02>Math.random()){let e=Math.random()*(u-200)+200,r=Math.PI/2+Math.PI/3*(Math.random()-.5),t=8+4*Math.random();O.current.artilleryShells.push({x:e,y:-32,vx:Math.cos(r)*t,vy:Math.sin(r)*t,img:h("artilleryImg")})}if(O.current.isActive("napalm",O.current.frameCount)&&.005>Math.random()){let e=.1+.19999999999999998*Math.random();O.current.napalmMissiles.push({x:-32,y:l*e,vx:4,life:Math.ceil((u+64)/4),dropsRemaining:6+Math.floor(4*Math.random()),dropTimer:20,img:h("napalmImg"),tailFrame:0,tailCounter:0,explodeX:400+600*Math.random()})}if(O.current.isActive("laserbeam",O.current.frameCount)&&(0===O.current.laserBurstRemaining&&.01>Math.random()&&(O.current.laserBurstRemaining=15,O.current.laserBurstCooldown=0),O.current.laserBurstRemaining>0&&(0===O.current.laserBurstCooldown?(O.current.laserBeams.push({x:235,y:O.current.y+50.625,frame:0,frameCounter:0}),a("laserBeamFireSfx"),O.current.laserBurstRemaining--,O.current.laserBurstCooldown=2):O.current.laserBurstCooldown--)),O.current.isActive("machineGuns",O.current.frameCount)&&(0===O.current.burstRemaining&&.01>Math.random()&&(O.current.burstRemaining=5,O.current.burstCooldown=0),O.current.burstRemaining>0))if(0===O.current.burstCooldown){let e=O.current.y+50.625;O.current.cannonballs.push({x:235,y:e,vx:12,img:h("cannonballImg")}),a("cannonballSfx"),O.current.burstRemaining--,O.current.burstCooldown=5}else O.current.burstCooldown--;O.current.isActive("autoReload",O.current.frameCount)&&O.current.ammo<12&&O.current.frameCount%15==0&&(O.current.ammo=Math.min(12,O.current.ammo+1),a("reloadSfx"));let C=h("planeFrames");O.current.planeFrameCounter++,O.current.planeFrameCounter>=6&&(O.current.planeFrameCounter=0,O.current.planeFrame=(O.current.planeFrame+1)%C.length),O.current.frameCount++;let b=h("enemyFrames");if(Math.random()<O.current.dynamicDensity){let e=Math.floor(Math.random()*b.length),r=.25>Math.random(),t=-1,a=-1;r&&(a=[500,250,100][t=Math.floor(3*Math.random())]),O.current.enemies.push({x:u+135,y:50+Math.random()*(l-200),vy:0,flapStrength:-(8+4*Math.random()),frames:b[e],propFrame:Math.floor(3*Math.random()),frameRate:6,frameCounter:0,alive:!0,glide:!0,loopProgress:-1,baseY:50+Math.random()*(l-200),rotation:0,stepProgress:-1,stepDelta:0,hasStick:r,stickBroken:!1,stickImg:h("stickImg"),brokenStickImg:h("brokenStickImg"),targetImg:r?h("targetImgs")[t]:void 0,targetType:r?"red".concat(t+1):void 0,targetScore:r?a:0,targetFadeAge:0,targetFadeMax:60*!!r,targetHit:!1,targetVy:0})}if(o.fillStyle=i,o.fillRect(0,0,u,l),.001>Math.random()){let e=q(u,l),r=Math.min(...e.map(e=>e.x)),t=Math.max(...e.map(e=>e.x+e.width));O.current.mountains.some(e=>{let a=e.x;return r<e.x+e.width&&a<t})||O.current.mountains.push(...e)}if(O.current.mountains.forEach((e,r)=>{e.x+=e.vx,o.globalAlpha=.8,o.drawImage(e.img,e.x,e.y+40,e.width,e.height),o.globalAlpha=1,e.x+n.width<0&&O.current.mountains.splice(r,1)}),.005>Math.random()&&O.current.trees.push(J(u,l)),O.current.trees.forEach((e,r)=>{e.x+=e.vx,o.globalAlpha=.9,o.drawImage(e.img,e.x,e.y,e.width,e.height),o.globalAlpha=1,e.x+e.width+n.width<0&&O.current.trees.splice(r,1)}),.0015>Math.random()&&(O.current.clouds.some(e=>e.x>u)||O.current.clouds.push($(u,l))),O.current.clouds.forEach((e,r)=>{e.x+=e.vx,e.puffs.forEach(r=>{let{img:t,dx:a,dy:n,scale:s}=r,u=t.width*s,l=t.height*s;o.globalAlpha=.8,o.drawImage(t,e.x+a,e.y+n,u,l)}),o.globalAlpha=1,e.x+1.5*n.width<0&&O.current.clouds.splice(r,1)}),5e-4>Math.random()){let e=f[Math.floor(Math.random()*f.length)],r=l*(.1+.1*Math.random()),t=1+2*Math.random();O.current.airships.push({x:-492,baseY:r,frames:h("airshipFrames")[e],frameIndex:Math.floor(3*Math.random()),frameCounter:0,frameRate:10,speed:t,color:e,bobOffset:Math.random()*Math.PI*2})}O.current.airships=O.current.airships.filter(e=>{e.x+=e.speed;let r=80*Math.sin(.05*O.current.frameCount+e.bobOffset),t=e.baseY+r;e.frameCounter++,e.frameCounter>=e.frameRate&&(e.frameCounter=0,e.frameIndex=(e.frameIndex+1)%e.frames.length);let a=e.frames[e.frameIndex];return o.drawImage(a,e.x,t,164,164),e.x<=u+a.width}),!(O.current.airships.length>0)||O.current.whooshPlaying||O.current.crashed?0===O.current.airships.length&&O.current.whooshPlaying&&(s("whooshSfx"),O.current.whooshPlaying=!1):(a("whooshSfx"),O.current.whooshPlaying=!0),O.current.crashed&&O.current.whooshPlaying&&(s("whooshSfx"),O.current.whooshPlaying=!1),O.current.textLabels=R({textLabels:O.current.textLabels,ctx:o,offsetX:O.current.groundOffset,cull:!0}),O.current.bulletHoles.forEach(e=>{o.globalAlpha=1-e.age/e.maxAge,o.drawImage(h("bulletHoleImg"),e.x-16,e.y-16,32,32),e.age++}),O.current.bulletHoles=O.current.bulletHoles.filter(e=>e.age<e.maxAge),o.globalAlpha=1;let I=O.current.isActive("freeze",O.current.frameCount);O.current.enemies.forEach(r=>{let t=r.x+67.5,a=r.y+50.625,n=135*e,s=101.25*e;if(!r.alive)return;if(I||r.glide){if(!I){if(r.loopProgress<0&&.001>Math.random()&&(r.loopProgress=0,r.baseY=r.y),r.loopProgress>=0){let e=r.loopProgress/180*Math.PI*2;r.y=r.baseY+100*Math.sin(e),r.rotation=e,r.loopProgress++,r.loopProgress>180&&(r.loopProgress=-1,r.rotation=0,r.y=r.baseY)}if(r.loopProgress<0){if(r.stepProgress<0&&.005>Math.random()){r.stepProgress=0;let e=m-101.25-50,t=50-r.baseY,a=e-r.baseY;r.stepDelta=Math.min(t+Math.random()*(a-t),150)}if(r.stepProgress>=0){let e=r.stepProgress/60;r.y=r.baseY+r.stepDelta*e;let t=r.stepDelta/60;r.rotation=-1*Math.atan2(t,O.current.enemySpeed(O.current.frameCount)),r.stepProgress++,r.stepProgress>60&&(r.baseY+=r.stepDelta,r.y=r.baseY,r.stepProgress=-1,r.rotation=0)}else r.rotation=0;if(r.stepProgress>=0){let e=r.stepProgress/60;r.y=r.baseY+r.stepDelta*e,r.stepProgress++,r.stepProgress>60&&(r.baseY+=r.stepDelta,r.y=r.baseY,r.stepProgress=-1)}}}}else O.current.frameCount%60==0&&(r.vy=r.flapStrength),r.vy+=c,r.y+=r.vy,r.y+101.25>=m&&(r.y=m-101.25,r.vy=r.flapStrength);if(!I&&O.current.isActive("windy",O.current.frameCount)&&(r.x+=(2*Math.random()-1)*8,r.y+=(2*Math.random()-1)*8,r.flapStrength=-(8+4*Math.random())),!I){let e=Math.cos(r.rotation||0);r.x-=O.current.enemySpeed(O.current.frameCount)*e}r.frameCounter++,r.frameCounter>=r.frameRate&&(r.frameCounter=0,r.propFrame=(r.propFrame+1)%r.frames.length);let u=r.frames[r.propFrame];if(o.save(),o.translate(t,a),r.rotation&&o.rotate(r.rotation),o.scale(-1,1),o.drawImage(u,-n/2,-s/2,n,s),o.restore(),r.hasStick){o.save(),o.translate(t,a),r.rotation&&o.rotate(r.rotation),o.scale(-1,1);let e=.5*r.stickImg.width,n=.5*r.stickImg.height;if(o.save(),o.rotate(Math.PI),o.drawImage(r.stickBroken?r.brokenStickImg:r.stickImg,-e/2,-n,e,n),o.restore(),!r.targetHit){let e=.5*r.targetImg.width,t=.5*r.targetImg.height;o.drawImage(r.targetImg,-e/2,-n+120,e,t)}o.restore()}.02>Math.random()&&X(t,a),r.x+135<0&&(r.alive=!1)}),O.current.enemies=O.current.enemies.filter(e=>e.alive);let M=()=>{O.current.vy=v,O.current.planeAngle=-.5;let e=167.5,r=O.current.y+50.625;O.current.puffs.push({x:e-16,y:r-16,img:h("puffLargeImg"),vy:0,age:0,maxAge:20}),setTimeout(()=>O.current.puffs.push({x:e-16,y:r-16,img:h("puffSmallImg"),vy:0,age:0,maxAge:15}),100)};!O.current.crashed&&.025>Math.random()&&O.current.y>0&&M(),O.current.crashed||(O.current.vy+=c,O.current.y+=O.current.vy,O.current.isActive("turbulence",O.current.frameCount)&&(O.current.vy+=(2*Math.random()-1)*.5,O.current.y+=(2*Math.random()-1)*8,O.current.planeAngle+=(2*Math.random()-1)*.2),O.current.y+101.25>=m&&M(),O.current.isActive("ghost",O.current.frameCount)||O.current.crashed||O.current.enemies.forEach(e=>{let r=167.5,t=O.current.y+50.625;if(e.x<r+67.5&&e.x+135>r-67.5&&e.y<t+50.625&&e.y+101.25>t-50.625){O.current.crashed=!0,O.current.groundContactFrames=0,e.alive=!1;let r=h("explosionImgs"),t=r[Math.floor(Math.random()*r.length)];O.current.falling.push({x:e.x,y:e.y,vy:0,img:t});let a=r[Math.floor(Math.random()*r.length)];O.current.falling.push({x:100,y:O.current.y,vy:0,img:a})}}),O.current.crashed&&!O.current.isActive("ghost",O.current.frameCount)&&(O.current.isActive("shield",O.current.frameCount)||O.current.isActive("supershield",O.current.frameCount)?(O.current.isActive("shield",O.current.frameCount)&&(O.current.activePowerups.shield.expires=0),O.current.shieldFlash=10,O.current.crashed=!1,a("shieldSfx")):(O.current.crashed=!0,Object.keys(O.current.activePowerups).forEach(e=>{O.current.activePowerups[e].expires=0}),a("crashSfx"),s("flightSfx"))));let A=O.current.y,P={x:167.5,y:O.current.y+50.625};for(let e=O.current.medals.length-1;e>=0;e--){let r=O.current.medals[e];r.x<235&&r.x+64>100&&r.y<A+101.25&&r.y+64>A&&(a("medalSfx"),H(500),O.current.floatingScores.push({x:r.x+32,y:r.y+32,vy:-1,amount:500,age:0,maxAge:60}),O.current.medals.splice(e,1),O.current.medalCount++)}O.current.medals.forEach((e,r)=>{e.frameCounter++,e.frameCounter>=e.frameRate&&(e.frameCounter=0,e.frameIndex=(e.frameIndex+1)%e.frames.length),e.x+=e.vx,(O.current.isActive("magnet",O.current.frameCount)||O.current.isActive("supermag",O.current.frameCount))&&500>Math.hypot(P.x-(e.x+32),P.y-(e.y+32))&&(e.x+=(100-e.x)*.05,e.y+=(O.current.y-e.y)*.05);let t=e.frames[e.frameIndex];o.drawImage(t,e.x,e.y,64,64),e.x+64<0&&O.current.medals.splice(r,1)}),O.current.powerups.forEach((e,r)=>{!e.collected&&(e.x-=O.current.groundSpeed(O.current.frameCount),o.drawImage(e.img,e.x,e.y,128,128),e.x+128<0&&O.current.powerups.splice(r,1))}),O.current.isActive("supermag",O.current.frameCount)&&(O.current.ducks=O.current.ducks.filter(e=>{let r=P.x-(e.x+e.width/2),t=P.y-(e.y+e.height/2);500>Math.hypot(r,t)&&(e.x+=.1*r,e.y+=.1*t);let a=O.current.isActive("megaducks",O.current.frameCount)?2.5:1,n=e.width*a,s=e.height*a,o=(n-e.width)/2,u=(s-e.height)/2,l=e.x-o,i=e.y-u;return!(P.x>l)||!(P.x<l+n)||!(P.y>i)||!(P.y<i+s)||(H(1e3),O.current.floatingScores.push({x:e.x+e.width/2,y:e.y+e.height/2,vy:-1,amount:1e3,age:0,maxAge:60}),O.current.duckCount++,!1)}),O.current.powerups=O.current.powerups.filter(e=>{if(k.includes(e.type))return!0;let r=P.x-(e.x+32),t=P.y-(e.y+32);return 500>Math.hypot(r,t)&&(e.x+=.1*r,e.y+=.1*t),!(P.x>e.x)||!(P.x<e.x+64)||!(P.y>e.y)||!(P.y<e.y+64)||(O.current.activePowerups[e.type].expires=O.current.frameCount+1200,a("powerupSfx"),O.current.floatingScores.push({x:e.x+32,y:e.y+32,vy:-1,amount:25,age:0,maxAge:60}),!1)})),O.current.groundOffset=(O.current.groundOffset+O.current.groundSpeed(O.current.frameCount))%p;let S=h("explosionImgs");!O.current.crashed&&O.current.y+101.25>=m?(O.current.groundContactFrames++,O.current.groundContactFrames>=180&&(O.current.groundContactFrames=0,a("groundTouchSfx"),H(-100),W("SHOOT PLANE TO FLY",1.5,!0,!0,100,x.height/2,60),W("OUCH",.5,!0,!0,147.5,O.current.y-30,30),O.current.ouchExplodeIdx=Math.floor(Math.random()*S.length),O.current.ouchFrames=30)):O.current.groundContactFrames=0;for(let e=-O.current.groundOffset;e<u;e+=p)o.drawImage(g[O.current.groundIndex],e,m,p,50);if(!O.current.crashed){if(O.current.ouchFrames>0){let e=S[O.current.ouchExplodeIdx],r=O.current.y;o.drawImage(e,167.5-e.width/2,r-e.height,67.5,50.625)}let e=0,r=0;O.current.ouchFrames>0&&(e=(Math.random()-.5)*10,r=(Math.random()-.5)*6,O.current.ouchFrames--),O.current.planeFrameCounter++,O.current.planeFrameCounter>=6&&(O.current.planeFrameCounter=0,O.current.planeFrame=(O.current.planeFrame+1)%C.length);let t=C[O.current.planeFrame],a=167.5+e,n=O.current.y+50.625+r+10;if(o.save(),o.translate(a,n),O.current.isActive("shield",O.current.frameCount)||O.current.isActive("supershield",O.current.frameCount)||O.current.shieldFlash>0){O.current.shieldFlash>0&&(o.globalAlpha=O.current.shieldFlash%2==0?.2:.6);let e=236.25;o.drawImage(h("shieldImg"),-e/2,-e/2,e,e),O.current.shieldFlash>0&&(o.globalAlpha=1,O.current.shieldFlash--)}o.rotate(O.current.planeAngle),O.current.isActive("ghost",O.current.frameCount)&&(o.globalAlpha=.4),o.drawImage(t,-67.5,-50.625,135,101.25),o.globalAlpha=1,o.restore(),O.current.planeAngle=Math.min(0,O.current.planeAngle+.02),O.current.ouchFrames--}O.current.artilleryShells=O.current.artilleryShells.filter(e=>{e.x+=e.vx,e.y+=e.vy;let r=Math.atan2(e.vy,e.vx),n=e.img,s=32/n.naturalHeight,u=n.naturalWidth*s,i=.8*u;o.save(),o.translate(e.x,e.y),o.rotate(r),o.drawImage(n,-i,-16,u,32),o.restore();let c=!1;if(e.y>=m){let r=.5*t[0].width;O.current.waters.some(t=>e.x>=t.x&&e.x<=t.x+t.size*r)?a("artillerySplashSfx"):(S.forEach((r,t)=>setTimeout(()=>{O.current.puffs.push({x:e.x-16,y:m-16,img:r,vy:0,age:0,maxAge:10,size:96})},50*t)),a("artilleryExplodeSfx")),c=!0}O.current.enemies.forEach(r=>{if(!c&&r.alive&&e.x>=r.x&&e.x<=r.x+135&&e.y>=r.y&&e.y<=r.y+101.25){r.alive=!1;H(300),O.current.enemyCount++,O.current.floatingScores.push({x:e.x,y:e.y,vy:-1,amount:300,age:0,maxAge:60}),S.forEach((e,t)=>setTimeout(()=>{O.current.puffs.push({x:r.x,y:r.y,img:e,vy:0,age:0,maxAge:10,size:96})},50*t)),a("artilleryExplodeSfx"),c=!0}});let g=h("duckTargetImgs");return O.current.ducks.forEach(r=>{if(!c&&!r.hit&&e.x>=r.x&&e.x<=r.x+r.width&&e.y>=r.y&&e.y<=r.y+r.height){r.hit=!0,r.fadeAge=0,r.fadeMax=60,r.targetImg=g[r.srcIdx],O.current.shotLakes.add(r.waterRef);H(1200),O.current.duckCount++,O.current.floatingScores.push({x:e.x,y:e.y,vy:-1,amount:1200,age:0,maxAge:60}),S.forEach((e,t)=>setTimeout(()=>{O.current.puffs.push({x:r.x,y:r.y,img:e,vy:0,age:0,maxAge:10,size:96})},50*t)),a("artilleryExplodeSfx"),c=!0}}),!c&&e.y<l+32}),!(O.current.artilleryShells.length>0)||O.current.artilleryPlaying||O.current.crashed?0===O.current.artilleryShells.length&&O.current.artilleryPlaying&&(s("artillerySfx"),O.current.artilleryPlaying=!1):(a("artillerySfx"),O.current.artilleryPlaying=!0),O.current.crashed&&O.current.artilleryPlaying&&(s("artillerySfx"),O.current.artilleryPlaying=!1);let _=h("fireImgs");O.current.napalmMissiles=O.current.napalmMissiles.filter(e=>{e.x+=e.vx,e.life--,++e.tailCounter>=5&&(e.tailCounter=0,e.tailFrame=(e.tailFrame+1)%_.length);let r=_[e.tailFrame],t=Math.atan2(0,e.vx),a=e.x-52*Math.cos(t),n=e.y-52*Math.sin(t);o.save(),o.translate(a,n),o.rotate(-Math.PI/2),o.drawImage(r,-r.width/2,-r.height/2,r.width,r.height),o.restore(),o.save(),o.translate(e.x,e.y),o.rotate(t),o.drawImage(e.img,-32,-32,64,64),o.restore();{let r=!1;for(let t of O.current.enemies)if(t.alive&&e.x>=t.x&&e.x<=t.x+135&&e.y>=t.y&&e.y<=t.y+101.25){r=!0,t.alive=!1,H(100),O.current.floatingScores.push({x:t.x+67.5,y:t.y+50.625,vy:-1,amount:100,age:0,maxAge:60});break}return r||e.x>=e.explodeX?(U(e.x,e.y,!1),!1):e.life>0&&e.x<u+64}});let G=[];O.current.napalmTiles=O.current.napalmTiles.filter(e=>{e.x-=O.current.groundSpeed(O.current.frameCount);let r=e.y+36-30>=m,n=.5*t[0].width,u=m-.5*t[0].height+120,l=O.current.waters.some(r=>{let t=r.x,a=r.x+r.size*n;return e.x>=t&&e.x<=a&&e.y+36>=u});r||l?(r?e.y=m-36+30:e.y=u-36,e.vy=0):(e.vy+=c,e.y+=e.vy),e.life--;let i=h("flameImgs"),g=i.length,p=i[Math.floor((e.maxLife-e.life)/e.maxLife*g)%g];return o.globalAlpha=e.life/e.maxLife,o.drawImage(p,e.x-36,e.y-36,72,72),o.globalAlpha=1,O.current.ducks=O.current.ducks.filter(r=>!!r.hit||!(e.x>=r.x)||!(e.x<=r.x+r.width)||!(e.y>=r.y)||!(e.y<=r.y+r.height)||(H(1e3),O.current.floatingScores.push({x:r.x+r.width/2,y:r.y+r.height/2,vy:-1,amount:1e3,age:0,maxAge:60}),O.current.napalmTiles.push({x:r.x+r.width/2,y:r.y+r.height/2,vy:0,life:600,maxLife:600,killsPlayer:!1}),O.current.shotLakes.has(r.waterRef)||O.current.shotLakes.add(r.waterRef),!1)),O.current.enemies=O.current.enemies.filter(r=>{if(r.alive&&e.x>=r.x&&e.x<=r.x+135&&e.y>=r.y&&e.y<=r.y+101.25){H(100),O.current.floatingScores.push({x:r.x+67.5,y:r.y+50.625,vy:-1,amount:100,age:0,maxAge:60});let e=r.x+67.5,t=r.y+50.625;return G.push({x:e,y:t}),!1}return!0}),O.current.medals=O.current.medals.filter(r=>!(e.x>=r.x)||!(e.x<=r.x+64)||!(e.y>=r.y)||!(e.y<=r.y+64)||(H(500),O.current.floatingScores.push({x:r.x+32,y:r.y+32,vy:-1,amount:500,age:0,maxAge:60}),O.current.napalmTiles.push({x:r.x+32,y:r.y+32,vy:0,life:600,maxLife:600,killsPlayer:!1}),!1)),e.killsPlayer&&!O.current.isActive("ghost",O.current.frameCount)&&!O.current.crashed&&e.x>=100&&e.x<=235&&e.y>=O.current.y&&e.y<=O.current.y+101.25&&(O.current.isActive("shield",O.current.frameCount)||O.current.isActive("supershield",O.current.frameCount)?(O.current.isActive("shield",O.current.frameCount)&&(O.current.activePowerups.shield.expires=0),O.current.shieldFlash=10,a("shieldSfx")):(O.current.crashed=!0,a("crashSfx"),s("flightSfx"))),e.life>0}),G.forEach(e=>{let{x:r,y:t}=e;U(r,t,!1)}),O.current.homingMissiles=O.current.homingMissiles.filter(e=>{if(e.target){let r=("x"in e.target?e.target.x:0)+67.5,t=Math.atan2(("y"in e.target?e.target.y:0)+50.625-e.y,r-e.x);e.vx=6*Math.cos(t),e.vy=6*Math.sin(t)}else e.vx=6,e.vy=0;e.x+=e.vx,e.y+=e.vy,++e.tailCounter>=5&&(e.tailCounter=0,e.tailFrame=(e.tailFrame+1)%2);let r=_[e.tailFrame],t=Math.atan2(e.vy,e.vx),n=e.x-16*Math.cos(t),s=e.y-16*Math.sin(t);for(let u of(o.save(),o.translate(n,s),o.rotate(t+Math.PI),o.drawImage(r,-r.width/2,-r.height/2,r.width,r.height),o.restore(),o.save(),o.translate(e.x,e.y),o.rotate(Math.atan2(e.vy,e.vx)),o.drawImage(e.img,-16,-16,32,32),o.restore(),O.current.enemies))if(u.alive&&e.x>=u.x&&e.x<=u.x+135&&e.y>=u.y&&e.y<=u.y+101.25){u.alive=!1,a("homingExplSfx");return H(200),O.current.floatingScores.push({x:e.x+50.625,y:e.y+67.5,vy:-1,amount:200,age:0,maxAge:60}),O.current.enemyCount++,S.forEach((r,t)=>setTimeout(()=>{O.current.puffs.push({x:e.x+50.625,y:e.y+67.5,img:r,vy:0,age:0,maxAge:10,size:96})},50*t)),!1}return!(--e.life<=0)||(a("homingExplSfx"),!1)}),(O.current.homingMissiles.length>0||O.current.napalmMissiles.length>0)&&!O.current.missileThrusterPlaying?(a("thrusterSfx"),O.current.missileThrusterPlaying=!0):0===O.current.homingMissiles.length&&0===O.current.napalmMissiles.length&&O.current.missileThrusterPlaying&&(s("thrusterSfx"),O.current.missileThrusterPlaying=!1),(O.current.activePowerups.bomb.expires===O.current.frameCount||O.current.activePowerups.bomb.expires===O.current.frameCount)&&(O.current.enemies.forEach(e=>{e.alive=!1;for(let r=0;r<5;r++)setTimeout(()=>X(e.x+67.5,e.y+50.625),50*r)}),a("bombSfx"),O.current.screenShake=20),O.current.falling.forEach((r,t)=>{r.vy+=c,r.y+=r.vy;let a=r.x+67.5,n=r.y+50.625,s=135*e,u=101.25*e;if(o.save(),o.translate(a,n),o.scale(-1,1),o.drawImage(r.img,-s/2,-u/2,s,u),o.restore(),.1>Math.random()&&X(a,n),r.y+101.25>=m){for(let e=0;e<5;e++)setTimeout(()=>X(a,m),100*e);O.current.falling.splice(t,1)}}),O.current.cannonballs.forEach((e,r)=>{e.x+=e.vx,o.drawImage(e.img,e.x,e.y,16,16),O.current.enemies.forEach(t=>{if(t.alive&&e.x>=t.x&&e.x<=t.x+135&&e.y>=t.y&&e.y<=t.y+101.25){t.alive=!1,S.forEach((r,t)=>setTimeout(()=>{O.current.puffs.push({x:e.x-16,y:e.y-16,img:r,vy:0,age:0,maxAge:10,size:96})},50*t));H(150),O.current.floatingScores.push({x:e.x+50.625,y:e.y+67.5,vy:-1,amount:150,age:0,maxAge:60}),O.current.cannonballs.splice(r,1)}}),e.x>u+50&&O.current.cannonballs.splice(r,1)});let E=h("laserBeamImgs");O.current.laserBeams=O.current.laserBeams.filter(e=>{e.x+=20,++e.frameCounter>=4&&(e.frameCounter=0,e.frame=(e.frame+1)%E.length);let r=E[e.frame];return o.save(),o.translate(e.x,e.y),o.rotate(Math.PI/2),o.drawImage(r,-r.width/2,-r.height/2,r.width,r.height),o.restore(),O.current.enemies.forEach(r=>{r.alive&&e.x>=r.x&&e.x<=r.x+135&&e.y>=r.y&&e.y<=r.y+101.25&&(r.alive=!1,H(100),O.current.floatingScores.push({x:r.x+67.5,y:r.y+50.625,vy:-1,amount:100,age:0,maxAge:60}),O.current.enemyCount++)}),e.x<u+50}),O.current.crashed&&O.current.groundCrashPuffsLeft>0&&(X(100,O.current.y+50.625),O.current.groundCrashPuffsLeft--);let F=[];if(O.current.puffs.forEach(e=>{var r;e.y+=e.vy,o.globalAlpha=1-e.age/e.maxAge;let t=null!=(r=e.size)?r:32;o.drawImage(e.img,e.x,e.y,t,t),o.globalAlpha=1,e.age++,e.age<e.maxAge&&F.push(e)}),O.current.puffs=F,O.current.floatingScores.forEach(e=>{o.globalAlpha=1-e.age/e.maxAge,o.drawImage(h("plusImg"),e.x-16,e.y-64,32,32);let r=e.x+18;if(void 0!=e.amount&&e.amount.toString().split("").forEach(t=>{let a=h("digitImgs")[t];a&&(o.drawImage(a,r,e.y-64,24,32),r+=26)}),O.current.isActive("coin2x",O.current.frameCount)){let t=h("powerupImgs");o.drawImage(t.coin2x,r,e.y-64,32,32)}e.y+=e.vy,e.age++}),O.current.floatingScores=O.current.floatingScores.filter(e=>e.age<e.maxAge),o.globalAlpha=1,.002>Math.random()){let e={x:u+200*Math.random(),y:m-32,size:3+Math.floor(5*Math.random()),frameIndex:0,frameCounter:0,frameRate:30},r=.5*t[0].width,a=.5*t[0].height,n=e.x,s=e.x+e.size*r;if(!O.current.waters.some(e=>{let t=e.x;return n<e.x+e.size*r&&t<s})){O.current.waters.push(e);let t=h("duckImgs"),n=h("duckTargetImgs"),s=h("duckOutlineImgs"),o=Math.floor(Math.random()*t.length),u=Math.floor(Math.random()*e.size),l=t[o],i=.5*l.width,c=.5*l.height,g=m-a+100;O.current.ducks.push({x:e.x+u*r,y:g-c,img:l,targetImg:n[o],outlineImg:s[o],width:i,height:c,srcIdx:o,bobPhase:Math.random()*Math.PI*2,vx:1.5,dir:.5>Math.random()?1:-1,waterRef:e})}}O.current.waters.forEach((e,r)=>{e.frameCounter++,e.frameCounter>=e.frameRate&&(e.frameCounter=0,e.frameIndex=+(0===e.frameIndex));let a=t[e.frameIndex],s=.5*a.width,u=.5*a.height;for(let r=0;r<e.size;r++)o.drawImage(a,e.x+r*s,m-u+100,s,u);e.x-=O.current.groundSpeed(O.current.frameCount),e.x+e.size*s+n.width<0&&O.current.waters.splice(r,1)}),O.current.isActive("supermag",O.current.frameCount)||O.current.isActive("napalm",O.current.frameCount)||O.current.crashed||O.current.waters.forEach(e=>{if(!O.current.ducks.some(r=>r.waterRef===e)&&!O.current.shotLakes.has(e)){let r=h("duckImgs"),a=h("duckTargetImgs"),n=h("duckOutlineImgs"),s=.5*t[0].width,o=Math.floor(Math.random()*r.length),u=r[o],l=.5*u.width,i=.5*u.height,c=e.x+(e.size*s-l)/2;O.current.ducks.push({x:c,y:m-i,img:u,targetImg:a[o],outlineImg:n[o],width:l,height:i,srcIdx:o,bobPhase:Math.random()*Math.PI*2,vx:1.5,dir:.5>Math.random()?1:-1,waterRef:e})}}),O.current.ducks.forEach((e,r)=>{e.x-=O.current.groundSpeed(O.current.frameCount);let a=e.y;if(e.hit||O.current.isActive("supermag",O.current.frameCount)||(a+=5*Math.sin(.05*O.current.frameCount+e.bobPhase)+20),!e.hit&&!O.current.isActive("supermag",O.current.frameCount)){let r=.5*t[0].width,a=e.waterRef.x,n=e.waterRef.x+e.waterRef.size*r;e.x+=e.vx*e.dir,e.x<=a?(e.x=a,e.dir=1):e.x+e.width>=n&&(e.x=n-e.width,e.dir=-1)}let n=O.current.isActive("megaducks",O.current.frameCount);a=n?a-20:a;let s=n?3:O.current.isActive("ducksight",O.current.frameCount)?1.33:1,l=e.width*s,i=e.height*s,c=e.x-(l-e.width)/2,m=a-(i-e.height)/2;if(e.hit&&e.targetImg)o.globalAlpha=1-e.fadeAge/e.fadeMax,e.y-=.5,o.save(),e.dir<0?(o.translate(c+l/2,m+i/2),o.scale(-1,1),o.drawImage(e.targetImg,-l/2,-i/2,l,i)):o.drawImage(e.targetImg,c,m,l,i),o.restore(),o.restore(),e.fadeAge++,e.fadeAge>=e.fadeMax&&O.current.ducks.splice(r,1),o.globalAlpha=1;else{let r=O.current.isActive("ducksight",O.current.frameCount);o.save(),e.dir<0?(o.translate(c+l/2,m+i/2),o.scale(-1,1),o.drawImage(r?e.outlineImg:e.img,-l/2,-i/2,l,i)):o.drawImage(r?e.outlineImg:e.img,c,m,l,i),o.restore()}(e.x+e.width<-50||e.x>u+50)&&O.current.ducks.splice(r,1)});let N=h("sparkImgs");O.current.sparkEffects.forEach(e=>{e.age++,e.frameIndex=Math.floor(e.age/e.maxAge*N.length),e.frameIndex>=N.length&&(e.frameIndex=N.length-1);let r=N[e.frameIndex];o.save(),o.globalAlpha=.8-e.age/e.maxAge*.8,o.filter="hue-rotate(-30deg) brightness(1.2)",o.globalCompositeOperation="lighter",o.drawImage(r,e.x,e.y,64,128),o.restore()}),O.current.sparkEffects=O.current.sparkEffects.filter(e=>e.age<e.maxAge),r.current=requestAnimationFrame(w),D()};w()},[h,x,Y,a,D,H,q,J,$,s,X,W,U]);return(0,n.useEffect)(()=>{if("playing"===z.phase&&0===O.current.frameCount){L.current=!1,Z(),O.current.dynamicDensity=.01;let e=setInterval(()=>{O.current.dynamicDensity+=.005},45e3);return()=>clearInterval(e)}},[z.phase,Z]),(0,n.useEffect)(()=>{if("ready"===z.phase||"go"===z.phase){let r,t=e.current,a=null==t?void 0:t.getContext("2d");if(!t||!a)return;let n=()=>{a.fillStyle=i,a.fillRect(0,0,x.width,x.height),O.current.textLabels=R({textLabels:O.current.textLabels,ctx:a,cull:!0}),r=requestAnimationFrame(n)};return n(),()=>cancelAnimationFrame(r)}},[z.phase,x,e]),(0,n.useEffect)(()=>()=>{r.current&&cancelAnimationFrame(r.current)},[]),{ui:z,setUI:B,canvasRef:e,state:O,startSplash:Q,handleClick:r=>{if("playing"!==z.phase||z.crashed||z.ammo<=0){if(O.current.ammo<=1){let e=x.height/2;for(let r=0;r<3;r++)window.setTimeout(()=>W("RELOAD",2,!0,!0,100,e,30),200*r)}return}let t=O.current.isActive("spray",O.current.frameCount),a=t?Math.min(1,O.current.ammo):1,n=O.current.isActive("infiniteAmmo",O.current.frameCount)?O.current.ammo:Math.max(0,O.current.ammo-a);O.current.ammo=n,O.current.isActive("blindfold",O.current.frameCount)||(O.current.cursor=m,setTimeout(()=>{O.current.isActive("blindfold",O.current.frameCount)||(O.current.cursor=c)},100));let s=e.current.getBoundingClientRect(),o=r.clientX-s.left,u=r.clientY-s.top;if(t)for(let e=0;e<5;e++){let r=(2*Math.random()-1)*40,t=(2*Math.random()-1)*40;window.setTimeout(()=>V(o+r,u+t),50*e)}else V(o,u)},handleContext:e=>{e.preventDefault(),"playing"===O.current.phase&&!O.current.crashed&&O.current.ammo<12&&(a("reloadSfx"),H(25),O.current.ammo=12,O.current.floatingScores.push({x:Math.random()*x.width,y:Math.random()*x.height,vy:-1,amount:25,age:0,maxAge:60}))},getImg:h,isActive:K,resetGame:()=>{a("gameOverSfx"),Q()},resetState:Y,ready:g}};function O(){let{ui:e,canvasRef:r,handleClick:t,handleContext:s,resetGame:o,getImg:l,startSplash:m,ready:h}=T(),[p,d]=(0,n.useState)(!1),f=(0,n.useCallback)(()=>{h?m():d(!0)},[h,m]);(0,n.useEffect)(()=>{h&&p&&(m(),d(!1))},[h,p,m]);let{phase:y}=e;return"title"===y?(0,a.jsx)(g,{onStart:f,titleSrc:u("/assets/titles/warbirds_title.png"),backgroundColor:i,cursor:c}):(0,a.jsx)(x,{ui:e,canvasRef:r,handleClick:t,handleContext:s,resetGame:o,getImg:l})}function L(){return(0,a.jsx)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:(0,a.jsx)(O,{})})}},6567:(e,r,t)=>{Promise.resolve().then(t.bind(t,5263))}},e=>{var r=r=>e(e.s=r);e.O(0,[213,441,684,358],()=>r(6567)),_N_E=e.O()}]);