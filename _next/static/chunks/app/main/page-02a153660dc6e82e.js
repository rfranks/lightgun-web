(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[798],{3169:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var n=r(5155),a=r(2115),l=r(4991);let s="/lightgun-web";function i(e){return"".concat(s).concat(e)}let u="url('".concat(s,"/assets/shooting-gallery/PNG/HUD/crosshair_blue_small.png') 16 16, auto"),c="url('".concat(s,"/assets/shooting-gallery/PNG/HUD/crosshair_white_small.png') 16 16, auto"),o="url('".concat(s,"/assets/shooting-gallery/PNG/HUD/crosshair_red_small.png') 16 16, auto");var h=r(6259);let d=e=>{let{onStart:t,titleSrc:r,backgroundColor:l,cursor:s}=e,i=(0,a.useRef)(null),u=(0,a.useRef)(null),c=(0,a.useRef)(!0);return(0,n.jsxs)(h.A,{position:"relative",width:"100vw",height:"100dvh",sx:{backgroundColor:l,cursor:s},display:"flex",justifyContent:"center",alignItems:"center",onClick:()=>{c.current=!1,u.current&&cancelAnimationFrame(u.current),t()},children:[(0,n.jsx)("canvas",{ref:i,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"}}),(0,n.jsx)(h.A,{component:"img",src:r,alt:"Zombiefish",sx:{width:"auto",height:"100%",cursor:s}})]})},g=function(e){let{ui:t,canvasRef:r,handleClick:a,handleContext:l,handleMouseMove:s}=e,{phase:u,cursor:c}=t;return(0,n.jsxs)(h.A,{position:"relative",width:"100vw",height:"100dvh",children:[(0,n.jsx)("canvas",{ref:r,onClick:a,onContextMenu:l,onTouchStart:e=>{e.preventDefault();let t=e.touches[0];a({clientX:t.clientX,clientY:t.clientY})},onMouseMove:s,style:{display:"block",width:"100%",height:"100%",cursor:c}}),"gameover"===u&&(0,n.jsx)(h.A,{component:"img",src:i("/assets/shooting-gallery/PNG/HUD/text_gameover.png"),alt:"Game Over",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:300,height:"auto",pointerEvents:"none"}})]})};function m(e,t,r){let{text:n,scale:a,fixed:l,fade:s,x:i,y:u,py:c,vy:o,vs:h,maxAge:d,onClick:g,color:m}=e,{spaceGap:f}=e,{getImg:p}=t;if(!p)throw Error("Asset manager does not have getImg method");let y=p("letterImgs"),b=p("numberImgs"),_=p("digitImgs"),x=p("plusImg"),v=p("minusImg"),w=0;f=f||y&&1.5*y.A.width*a||10;let k=[];return Array.from(n).forEach(e=>{if(" "===e)w+=f,k.push(null);else{let t="+"===e?x:"-"===e?v:(null==y?void 0:y[e.toUpperCase()])||(null==b?void 0:b[e])||(null==_?void 0:_[e]);t&&(w+=t.width*a+2,k.push(t))}}),{text:n,imgs:k,scale:a,fixed:l,fade:s,x:null!=i?i:(null==r?void 0:r.width)!==void 0?(r.width-w)/2:0,y:(null!=u?u:(null==r?void 0:r.height)!==void 0?.2*r.height:0)+(null!=c?c:0),py:null!=c?c:0,vy:null!=o?o:0,vs:null!=h?h:0,age:0,maxAge:d||(s?60:1/0),spaceGap:f,...m?{color:m}:{},...g?{onClick:g}:{}}}let f=[.05,.1],p=[.1,.2],y=[.2,.4],b=[.3,.6],_=(e,t)=>{if(Math.abs(e)>=Math.abs(t)){let r=.5*Math.abs(e);return{vx:e,vy:Math.max(Math.min(t,r),-r)}}let r=.5*Math.abs(t);return{vx:Math.max(Math.min(e,r),-r),vy:t}};function x(){let{ui:e,canvasRef:t,handleMouseMove:r,handleClick:l,handleContext:s,startSplash:h,ready:x}=function(){let e=(0,a.useRef)(null),t=(0,a.useRef)(null),r=function(){let[e,t]=(0,a.useState)(!1),r=(0,a.useRef)({});return(0,a.useEffect)(()=>{let e=e=>{let t=new window.Image;return t.src=i(e),t},n=(t,r)=>Object.fromEntries(r.map(r=>[r,e("/assets/fish/PNG/".concat(t,"/").concat(r,".png"))])),a=e("/assets/fish/Spritesheet/spritesheet.png"),l={blue:[[1152,256]],brown:[[1024,1280]],green:[[1024,1024]],grey:[[1024,512]],grey_long_a:[[1024,384]],grey_long_b:[[1024,128]],orange:[[896,1280]],pink:[[896,768]],red:[[896,256]]},s={blue:[[1152,0]],green:[[1024,768]],orange:[[896,1024]],pink:[[896,512]],red:[[896,0]]};a.onload=()=>{let e=e=>Object.fromEntries(Object.entries(e).map(e=>{let[t,r]=e;return[t,r.map(e=>{let[t,r]=e,n=document.createElement("canvas");n.width=128,n.height=128;let l=n.getContext("2d");null==l||l.drawImage(a,t,r,128,128,0,0,128,128);let s=new window.Image;return s.src=n.toDataURL(),s})]}));r.current.fishFrames=e(l),r.current.skeletonFrames=e(s),t(!0)},r.current.fishImgs=Object.fromEntries(["blue","brown","brown_outline","green","grey","grey_long_a","grey_long_a_outline","grey_long_b","grey_long_b_outline","orange","pink","red"].map(t=>[t,e("/assets/fish/PNG/Objects/Fish/fish_".concat(t,".png"))])),r.current.fishFlashImg=e("/assets/smoke/PNG/Flash/flash00.png"),r.current.bubbleImgs=n("Objects/Bubbles",["bubble_a","bubble_b","bubble_c"]),r.current.rockImgs=n("Objects/Rocks",["background_rock_a","background_rock_b","rock_a","rock_a_outline","rock_b","rock_b_outline"]),r.current.rockBgImgs=[r.current.rockImgs.background_rock_a,r.current.rockImgs.background_rock_b],r.current.seaGrassImgs=n("Objects/SeaGrass",["seaweed_grass_a","seaweed_grass_a_outline","seaweed_grass_b","seaweed_grass_b_outline"]),r.current.seaGrassFgImgs=[r.current.seaGrassImgs.seaweed_grass_a,r.current.seaGrassImgs.seaweed_grass_b];let u=[];"abcdefgh".split("").forEach(e=>{u.push("background_seaweed_".concat(e))}),"abcd".split("").forEach(e=>{u.push("seaweed_green_".concat(e)),u.push("seaweed_green_".concat(e,"_outline"))}),"ab".split("").forEach(e=>{u.push("seaweed_orange_".concat(e)),u.push("seaweed_orange_".concat(e,"_outline"))}),"abcd".split("").forEach(e=>{u.push("seaweed_pink_".concat(e)),u.push("seaweed_pink_".concat(e,"_outline"))}),r.current.seaweedImgs=n("Objects/Seaweed",u),r.current.seaweedBgImgs="abcdefgh".split("").map(e=>r.current.seaweedImgs["background_seaweed_".concat(e)]||void 0),r.current.surfaceImgs=[e("/assets/shooting-gallery/PNG/Stall/water1.png"),e("/assets/shooting-gallery/PNG/Stall/water2.png")],r.current.cloudImgs=[e("/assets/shooting-gallery/PNG/Stall/cloud1.png"),e("/assets/shooting-gallery/PNG/Stall/cloud2.png")];let c="abcdefgh".split(""),o=["terrain_dirt_a","terrain_dirt_b","terrain_dirt_c","terrain_dirt_d",...c.flatMap(e=>["terrain_dirt_top_".concat(e),"terrain_dirt_top_".concat(e,"_outline")])],h=["terrain_sand_a","terrain_sand_b","terrain_sand_c","terrain_sand_d",...c.flatMap(e=>["terrain_sand_top_".concat(e),"terrain_sand_top_".concat(e,"_outline")])];r.current.terrainDirtImgs=n("Terrain/Dirt",o),r.current.terrainSandImgs=n("Terrain/Sand",h),r.current.terrainWaterImgs=n("Terrain/Water",["water_terrain","water_terrain_top"]),r.current.digitImgs={};for(let t=0;t<=9;t++)r.current.digitImgs[t.toString()]=e("/assets/fish/PNG/HUDText/hud_number_".concat(t,".png"));r.current.digitImgs[":"]=e("/assets/fish/PNG/HUDText/hud_colon.png"),r.current.letterImgs={};for(let t=65;t<=90;t++){let n=String.fromCharCode(t);r.current.letterImgs[n]=e("/assets/tappyplane/PNG/Letters/letter".concat(n,".png"))}r.current.dotImg=e("/assets/fish/PNG/HUDText/hud_dot.png"),r.current.pctImg=e("/assets/fish/PNG/HUDText/hud_percent.png"),r.current.plusImg=e("/assets/fish/PNG/HUDText/hud_plus.png");let d=document.createElement("canvas");d.width=r.current.plusImg.width||32,d.height=r.current.plusImg.height||32;let g=d.getContext("2d");if(g){g.fillStyle="white";let e=Math.max(1,Math.floor(d.height/5)),t=Math.floor((d.height-e)/2);g.fillRect(0,t,d.width,e)}let m=new window.Image;m.src=d.toDataURL(),r.current.minusImg=m},[]),{get:(0,a.useCallback)(e=>r.current[e],[]),getImg:(0,a.useCallback)(e=>{var t;return null!=(t=r.current[e])?t:void 0},[]),assetRefs:r.current,ready:e}}(),{getImg:n,ready:l}=r,s=function(){let e=(0,a.useMemo)(()=>{if("undefined"==typeof Audio)return{};let e=document.createElement("audio");e.src=i("/audio/laser4.ogg"),e.preload="auto";let t=document.createElement("audio");t.src=i("/audio/laser9.ogg"),t.preload="auto";let r=document.createElement("audio");r.src=i("/audio/powerUp8.ogg"),r.preload="auto";let n=document.createElement("audio");n.src=i("/audio/error_004.ogg"),n.preload="auto";let a=document.createElement("audio");a.src=i("/audio/splash.ogg"),a.preload="auto";let l=document.createElement("audio");l.src=i("/audio/lowDown.ogg"),l.preload="auto";let s=document.createElement("audio");s.src=i("/audio/zap1.ogg"),s.preload="auto";let u=document.createElement("audio");u.src=i("/audio/glass_001.ogg"),u.preload="auto";let c=document.createElement("audio");c.src=i("/audio/back_001.ogg"),c.preload="auto",c.loop=!0;let o=document.createElement("audio");o.src=i("/audio/tick_002.ogg"),o.preload="auto";let h=document.createElement("audio");return h.src=i("/audio/warning.ogg"),h.preload="auto",{shoot:e,hit:t,bonus:r,penalty:n,skeleton:a,death:l,convert:s,pop:u,tick:o,warning:h,bgm:c}},[]),t=(0,a.useCallback)((t,r)=>{let n=e[t];n&&((null==r?void 0:r.loop)!==void 0&&(n.loop=r.loop),(null==r?void 0:r.volume)!==void 0&&(n.volume=r.volume),n.currentTime=0,n.play())},[e]),r=(0,a.useCallback)(t=>{let r=e[t];r&&r.pause()},[e]),n=(0,a.useCallback)(()=>{Object.values(e).forEach(e=>e.pause())},[e]);return(0,a.useMemo)(()=>({play:t,pause:r,pauseAll:n}),[t,r,n])}(),h=function(){let[e,t]=(0,a.useState)({width:0,height:0});return(0,a.useEffect)(()=>{function e(){t({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e}(),d=(0,a.useRef)({phase:"title",timer:99,shots:0,hits:0,score:0,accuracy:0,cursor:u,dims:h,fish:[],bubbles:[],textLabels:[],missParticles:[],conversions:0,hitCounts:{},warningPlayed:!1}),g=(0,a.useRef)(1),x=(0,a.useRef)(1),v=(0,a.useRef)(1),w=(0,a.useRef)(1),k=(0,a.useRef)([]),I=(0,a.useRef)([]),M=(0,a.useRef)(0),S=(0,a.useRef)(null),E=(0,a.useRef)(null),C=(0,a.useRef)(0),R=(0,a.useRef)(null),T=(0,a.useRef)(f.map(()=>0)),P=(0,a.useRef)(p.map(()=>0)),A=(0,a.useRef)(y.map(()=>0)),G=(0,a.useRef)(b.map(()=>0)),j=(0,a.useRef)(null),N=(0,a.useRef)(0),O=(0,a.useRef)(0),L=e=>{e>Number(localStorage.getItem("bestAccuracy")||0)&&localStorage.setItem("bestAccuracy",e.toString())},D=(0,a.useRef)(null),F=(0,a.useRef)(null),H=(0,a.useRef)(null),U=(0,a.useRef)(null),z=(0,a.useRef)(null),q=(0,a.useRef)(null),B=(0,a.useRef)(null),W=(0,a.useRef)(null),X=(0,a.useRef)(null),Y=(0,a.useRef)(null),Z=(0,a.useRef)(null),J=(0,a.useRef)({x:0,y:0,width:0,height:0}),[K,Q]=(0,a.useState)({phase:"title",timer:99,shots:0,hits:0,score:0,accuracy:0,cursor:u});(0,a.useEffect)(()=>{d.current.dims=h},[h]);let V=(0,a.useCallback)(e=>{d.current.cursor=e,Q({phase:d.current.phase,timer:d.current.timer,shots:d.current.shots,hits:d.current.hits,score:d.current.score,accuracy:d.current.accuracy,cursor:e})},[]),$=(0,a.useCallback)((e,t,r,a)=>{let l=m({text:e,scale:1,fixed:!0,fade:!0,x:t,y:r,vy:-.5,...a?{color:a}:{}},{getImg:n},d.current.dims);d.current.textLabels.push(l)},[n]),ee=(0,a.useCallback)(e=>{let{width:t,height:r}=d.current.dims,a=n("terrainWaterImgs"),l=null==a?void 0:a.water_terrain;if(l)for(let n=0;n<t;n+=l.width)for(let t=0;t<r;t+=l.height)e.drawImage(l,n,t);else e.fillStyle="#1d8fde",e.fillRect(0,0,t,r);let s=n("surfaceImgs"),i=n("cloudImgs");if(s&&s.length){let r=s[0].width*s.length;f.forEach((e,t)=>{T.current[t]-=e,T.current[t]<=-r&&(T.current[t]+=r)});for(let n=0;n<f.length;n++){let a=T.current[n];for(let n=-r;n<t+r;n+=r)s.forEach((t,r)=>{e.drawImage(t,n+a+r*s[0].width,0)})}}if(i&&i.length){let r=i[0].width*i.length;for(let n=0;n<f.length;n++){let a=T.current[n];for(let n=-r;n<t+r;n+=r)i.forEach((t,r)=>{e.drawImage(t,n+a+r*i[0].width,0)})}}let u=n("terrainSandImgs"),c=null==u?void 0:u.terrain_sand_a,o=null==u?void 0:u.terrain_sand_top_a,h=r;if(c){h=r-c.height;for(let r=0;r<t;r+=c.width)e.drawImage(c,r,h)}else h=r-64,e.fillStyle="#c2b280",e.fillRect(0,h,t,64);if(o){let r=h-o.height;for(let n=0;n<t;n+=o.width)e.drawImage(o,n,r)}let g=n("seaweedBgImgs");if(g&&g.length){let r=h,n=g[0].width*g.length;y.forEach((e,t)=>{A.current[t]-=e,A.current[t]<=-n&&(A.current[t]+=n)});for(let a=0;a<y.length;a++){let l=A.current[a];for(let a=-n;a<t+n;a+=n)g.forEach((t,n)=>{if(!t)return;let s=r-t.height;e.drawImage(t,a+l+n*g[0].width,s)})}}let m=n("rockBgImgs");if(m&&m.length){let r=m[0].width*m.length;p.forEach((e,t)=>{P.current[t]-=e,P.current[t]<=-r&&(P.current[t]+=r)});for(let n=0;n<p.length;n++){let a=P.current[n],l=h-m[0].height;for(let n=-r;n<t+r;n+=r)m.forEach((t,r)=>{t&&e.drawImage(t,n+a+r*m[0].width,l)})}}let _=n("seaGrassFgImgs");if(_&&_.length){let r=_[0].width*_.length;b.forEach((e,t)=>{G.current[t]-=e,G.current[t]<=-r&&(G.current[t]+=r)});for(let n=0;n<b.length;n++){let a=G.current[n],l=h-_[0].height;for(let n=-r;n<t+r;n+=r)_.forEach((t,r)=>{t&&e.drawImage(t,n+a+r*_[0].width,l)})}}},[n]),et=(0,a.useCallback)(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(!e)return;let l=(r>0?t.toString().padStart(r,"0"):t.toString())+a,s=n("digitImgs");e.text=l,e.imgs=l.split("").map(e=>s[e])},[n]),er=(0,a.useCallback)(()=>{let t=d.current,{width:r,height:a}=t.dims,l=n("fishFlashImg"),i=e.current,u=null==i?void 0:i.getContext("2d");t.fish.forEach(e=>{e.pendingSkeleton&&(u&&l&&u.drawImage(l,e.x,e.y,128,128),e.flashTimer=(e.flashTimer||0)-1,e.flashTimer<=0&&(e.isSkeleton=!0,e.health=2,e.hurtTimer=0,e.pendingSkeleton=void 0,e.flashTimer=void 0))});let c={};t.fish.forEach(e=>{if(void 0===e.groupId)return;c[e.groupId]||(c[e.groupId]={vx:0,vy:0,members:[]});let t=c[e.groupId];t.vx+=e.vx,t.vy+=e.vy,t.members.push(e)}),Object.values(c).forEach(e=>{let t=e.vx/e.members.length,r=e.vy/e.members.length;e.members.forEach(e=>{e.vx+=(t-e.vx)*.05,e.vy+=(r-e.vy)*.05})});let o={};t.fish.forEach(e=>{var t;if(void 0===e.pairId)return;let r=o[t=e.pairId]||(o[t]={});"grey_long_a"===e.kind?r.a=e:"grey_long_b"===e.kind&&(r.b=e)}),Object.values(o).forEach(e=>{let{a:t,b:r}=e;if(!t||!r)return;r.vy=t.vy;let n=r.x>=t.x?1:-1,a=t.x+128*n-r.x;r.vx+=.05*a});let h=new Set(["brown","grey_long_a","grey_long_b"]),g=2+.05*t.conversions,m=1048576,f=t.fish.filter(e=>e.isSkeleton||e.pendingSkeleton).length;t.fish.forEach(e=>{let r;if(!e.isSkeleton)return;let n=m;if(t.fish.forEach(t=>{if(t.isSkeleton||t.pendingSkeleton||h.has(t.kind))return;let a=t.x-e.x,l=t.y-e.y,s=a*a+l*l;s<n&&(n=s,r=t)}),r){let a=r.x-e.x,l=r.y-e.y,i=Math.sqrt(n);i>0&&(e.vx=a/i*g,e.vy=l/i*g),i<64&&f<20&&!r.pendingSkeleton&&($("POOF",r.x,r.y),r.pendingSkeleton=!0,r.flashTimer=5,r.vx=0,r.vy=0,r.frame=0,r.frameCounter=0,delete r.groupId,t.conversions+=1,s.play("convert"),f+=1)}}),t.fish.forEach(e=>{if(!e.isSkeleton&&(e.wanderTimer-=1,e.wanderTimer<=0)){e.wanderTimer=Math.floor(60*Math.random())+60,e.vx+=(Math.random()-.5)*.1,e.vy+=(Math.random()-.5)*.1;let t=_(e.vx,e.vy);e.vx=t.vx,e.vy=t.vy}});let p=t.fish.filter(e=>e.isSkeleton);for(let e=0;e<p.length;e++){let t=p[e];for(let r=e+1;r<p.length;r++){let e=p[r],n=e.x-t.x,a=e.y-t.y,l=n*n+a*a;if(l<16384&&l>0){let r=Math.sqrt(l),s=(128-r)/128*.05,i=n/r*s,u=a/r*s;t.vx-=i,t.vy-=u,e.vx+=i,e.vy+=u}}}t.fish.forEach(e=>{e.hurtTimer>0&&(e.hurtTimer-=1);let t=.5*Math.sin((C.current+e.id)/20),n=_(e.vx,e.vy+t);e.x+=n.vx,e.y+=n.vy,e.angle=Math.atan2(e.vy,e.vx),e.isSkeleton&&(e.x=Math.max(0,Math.min(e.x,r-128)),e.y=Math.max(0,Math.min(e.y,a-128)))})},[s,$,n]),en=(0,a.useCallback)(()=>{let{width:e,height:t}=d.current.dims,r=["bubble_a","bubble_b","bubble_c"],n=r[Math.floor(Math.random()*r.length)],a=64*Math.random()+32,l=Math.random()*(e-a),s=Math.random()-.5,i=+Math.random()+-1.5,u=2*Math.random()+.5,c=.05*Math.random()+.01,o=I.current.pop()||{};if(o.id=w.current++,o.kind=n,o.x=l,o.y=t+a,o.vx=s,o.vy=i,o.size=a,o.amp=u,o.freq=c,d.current.bubbles.push(o),d.current.bubbles.length>20){let e=d.current.bubbles.splice(0,d.current.bubbles.length-20);I.current.push(...e)}},[]),ea=(0,a.useCallback)(()=>{let a=d.current;if(Z.current){var l,i;let e=Z.current,t=e.imgs.reduce((t,r)=>t+(r?r.width*e.scale+2:e.spaceGap),0),r=e.imgs.reduce((t,r)=>Math.max(t,((null==r?void 0:r.height)||0)*e.scale),0);J.current={x:e.x,y:e.y-(null!=(l=e.py)?l:0),width:t,height:r+(null!=(i=e.py)?i:0)*2}}let u=e.current,c=null==u?void 0:u.getContext("2d");if(!u||!c){t.current=requestAnimationFrame(ea);return}if("playing"===a.phase){if(er(),M.current-=1,M.current<=0&&(en(),M.current=Math.floor(60*Math.random())+30),a.bubbles.forEach(e=>{e.x+=e.vx+Math.sin(C.current*e.freq)*e.amp,e.y+=e.vy}),a.bubbles=a.bubbles.filter(e=>{let t=e.y+e.size>0&&e.x+e.size>0&&e.x-e.size<a.dims.width;return t||I.current.push(e),t}),C.current+=1,C.current>=60&&(C.current=0,a.timer=Math.max(0,a.timer-1),s.play("tick"),et(F.current,a.timer,2,":"),10!==a.timer||a.warningPlayed||(s.play("warning"),a.warningPlayed=!0)),0===a.timer){a.phase="gameover",N.current=a.shots>0?Math.round(a.hits/a.shots*100):0,L(N.current),O.current=0,s.pause("bgm");let e=n("pctImg"),t=[n("digitImgs")["0"],e],l=t.reduce((e,t)=>e+ +t.width+2,0),i=m({text:"0",scale:1,fixed:!0,fade:!1,x:(a.dims.width-l)/2,y:a.dims.height/2,py:8},r);i.text="0%",i.imgs=t,j.current=i,a.textLabels.push(i);let u=(e,t)=>{let n=m({text:e,scale:1,fixed:!0,fade:!1,y:t,py:8},r,a.dims);return a.textLabels.push(n),n},c=i.y+40;X.current=u("TIME ".concat(a.timer.toString().padStart(2,"0")),c),B.current=u("SHOTS ".concat(a.shots),c+40),W.current=u("HITS ".concat(a.hits),c+80);let o=c+120;Object.entries(a.hitCounts).sort((e,t)=>{let[r]=e,[n]=t;return r.localeCompare(n)}).forEach(e=>{let[t,r]=e;u("".concat(t.replace(/_/g," ")," ").concat(r),o),o+=40}),Y.current=u("SCORE ".concat(a.score),c+120)}if(!D.current){let e=Number(localStorage.getItem("bestAccuracy")||0),t=n("pctImg"),l=n("digitImgs"),s=m({text:"".concat(e,"%"),scale:1,fixed:!0,fade:!1,x:16,y:16,py:8},r);s.imgs=[...e.toString().split("").map(e=>l[e]),t],D.current=s,a.textLabels.push(s)}let{width:e,height:t}=a.dims;a.fish=a.fish.filter(r=>{let n=r.x>-256&&r.x<e+256&&r.y>-256&&r.y<t+256;return n||k.current.push(r),n})}if(a.missParticles.forEach(e=>{e.radius+=4,e.alpha-=.05}),a.missParticles=a.missParticles.filter(e=>e.alpha>0),"gameover"===a.phase&&j.current){let e=j.current;if(O.current<N.current){O.current+=1,s.play("tick");let t=Math.min(O.current,N.current).toString(),r=n("digitImgs"),a=n("pctImg");e.text="".concat(t,"%"),e.imgs=[...t.split("").map(e=>r[e]),a]}e.scale=1+.05*Math.sin(.1*C.current);let t=e.imgs.reduce((t,r)=>t+((null==r?void 0:r.width)||0)*e.scale+2,0);e.x=(a.dims.width-t)/2}if("playing"===a.phase){let{width:e,height:t}=a.dims;a.fish=a.fish.filter(r=>{let n=r.x>-256&&r.x<e+256&&r.y>-256&&r.y<t+256;return n||k.current.push(r),n})}if("paused"===a.phase?q.current||(q.current=m({text:"PAUSED",scale:2,fixed:!0,fade:!1},r,a.dims),a.textLabels.push(q.current)):q.current&&(a.textLabels=a.textLabels.filter(e=>e!==q.current),q.current=null),u&&c){u.width=a.dims.width,u.height=a.dims.height,c.clearRect(0,0,u.width,u.height),ee(c);let e=a.timer/99*u.width;c.fillStyle="rgba(0,0,0,0.5)",c.fillRect(0,0,e,8);let t=n("bubbleImgs");a.bubbles.forEach(e=>{let r=t[e.kind];r&&c.drawImage(r,e.x,e.y,e.size,e.size)}),a.missParticles.forEach(e=>{c.beginPath(),c.arc(e.x,e.y,e.radius,0,2*Math.PI),c.strokeStyle="rgba(255,255,255,".concat(e.alpha,")"),c.lineWidth=2,c.stroke()}),a.fish.forEach(e=>{let t=n(e.isSkeleton?"skeletonFrames":"fishFrames")[e.kind];if(!t||0===t.length)return;e.frameCounter++,e.frameCounter>=6&&(e.frameCounter=0,e.frame=(e.frame+1)%t.length);let r=t[e.frame];if(!r)return;c.save();let a=e.x+64,l=e.y+64,s=-64;if(("grey_long_a"===e.kind||"grey_long_b"===e.kind)&&(a=e.x+128*("grey_long_a"===e.kind),s="grey_long_a"===e.kind?-128:0),c.translate(a,l),c.rotate(e.angle),e.highlight){let t=n("fishImgs")["".concat(e.kind,"_outline")];t&&(c.globalAlpha=(Math.sin(C.current/10)+1)/2,c.drawImage(t,s,-64,128,128),c.globalAlpha=1)}if(c.drawImage(r,s,-64,128,128),e.pendingSkeleton){let e=n("fishFlashImg");e&&c.drawImage(e,s,-64,128,128)}e.isSkeleton&&e.hurtTimer>0&&(c.fillStyle="rgba(255,0,0,0.5)",c.fillRect(s,-64,128,128)),c.restore()}),a.textLabels=function(e){let{textLabels:t,ctx:r,offsetX:n,offsetY:a,cull:l}=e,s=r.globalAlpha,i=r.fillStyle;return t.forEach(e=>{var t,l,s;r.globalAlpha=e.fade?1-e.age/e.maxAge:1,r.fillStyle=null!=(t=e.color)?t:i;let u=e.fixed?e.x:e.x-(n||0);for(let t of e.imgs)if(t){let n=t.width*e.scale,l=t.height*e.scale;r.drawImage(t,u,e.y-(a||0),n,l),u+=n+2}else u+=e.spaceGap;e.y+=null!=(l=e.vy)?l:0,e.scale+=null!=(s=e.vs)?s:0,e.age++}),r.globalAlpha=s,r.fillStyle=i,l&&(t=t.filter(e=>e.age<e.maxAge)),t}({textLabels:a.textLabels,ctx:c,cull:!0})}a.accuracy=a.shots>0?a.hits/a.shots*100:0,Q({phase:a.phase,timer:a.timer,shots:a.shots,hits:a.hits,score:a.score,accuracy:a.accuracy,cursor:a.cursor}),t.current=requestAnimationFrame(ea)},[er,n,r,en,et]),el=(0,a.useCallback)(()=>{var e;let a=d.current;a.phase="playing",a.timer=99,a.shots=0,a.hits=0,a.score=0,a.accuracy=0,k.current.push(...a.fish),a.fish=[],I.current.push(...a.bubbles),a.bubbles=[],a.missParticles=[],a.warningPlayed=!1,C.current=0,j.current=null,D.current=null,N.current=0,O.current=0,T.current.fill(0),P.current.fill(0),A.current.fill(0),G.current.fill(0),q.current=null,B.current=null,W.current=null,X.current=null,Y.current=null;let l=((null==(e=n("digitImgs")["0"])?void 0:e.height)||0)+8;s.play("bgm",{loop:!0});let i=e=>e.imgs.reduce((t,r)=>t+(r?r.width+2:e.spaceGap),0),c=m({text:"TIME",scale:1,fixed:!0,fade:!1,x:16,y:16,py:8},r);Z.current=c,J.current={x:c.x,y:c.y-((null==c?void 0:c.py)||0),width:i(c),height:c.imgs.reduce((e,t)=>Math.max(e,((null==t?void 0:t.height)||0)*c.scale),0)+2*((null==c?void 0:c.py)||0)},F.current=m({text:"".concat(a.timer.toString().padStart(2,"0"),":"),scale:1,fixed:!0,fade:!1,x:16+i(c),y:16,py:8},r),et(F.current,a.timer,2,":");let o=m({text:"SHOTS",scale:1,fixed:!0,fade:!1,x:16,y:16+l,py:8},r);H.current=m({text:a.shots.toString(),scale:1,fixed:!0,fade:!1,x:16+i(o),y:16+l,py:8},r);let h=m({text:"HITS",scale:1,fixed:!0,fade:!1,x:16,y:16+2*l,py:8},r);U.current=m({text:a.hits.toString(),scale:1,fixed:!0,fade:!1,x:16+i(h),y:16+2*l,py:8},r);let g=m({text:"SCORE",scale:1,fixed:!0,fade:!1,x:16,y:16+3*l,py:8},r);z.current=m({text:a.score.toString(),scale:1,fixed:!0,fade:!1,x:16+i(g),y:16+3*l,py:8},r),M.current=0,d.current.textLabels=[c,F.current,o,H.current,h,U.current,g,z.current],a.cursor=u,Q({phase:a.phase,timer:a.timer,shots:a.shots,hits:a.hits,score:a.score,accuracy:a.accuracy,cursor:a.cursor}),t.current&&cancelAnimationFrame(t.current),t.current=requestAnimationFrame(ea)},[ea,r,n,et]),es=(0,a.useCallback)(()=>{let e=d.current;R.current&&(clearTimeout(R.current),R.current=null),e.phase="title",e.timer=99,e.shots=0,e.hits=0,e.score=0,e.accuracy=0,e.conversions=0,e.hitCounts={},k.current.push(...e.fish),e.fish=[],e.cursor=u,I.current.push(...e.bubbles),e.bubbles=[],e.missParticles=[],e.warningPlayed=!1,j.current=null,D.current=null,N.current=0,O.current=0,C.current=0,F.current=null,H.current=null,U.current=null,z.current=null,B.current=null,W.current=null,X.current=null,Y.current=null,d.current.textLabels=[],M.current=0,g.current=1,x.current=1,v.current=1,w.current=1,T.current.fill(0),P.current.fill(0),A.current.fill(0),G.current.fill(0),q.current=null,Q({phase:e.phase,timer:e.timer,shots:e.shots,hits:e.hits,score:e.score,accuracy:e.accuracy,cursor:e.cursor}),t.current&&cancelAnimationFrame(t.current),S.current&&(clearTimeout(S.current),S.current=null),E.current&&(clearTimeout(E.current),E.current=null),s.pause("bgm"),s.pauseAll()},[]);(0,a.useEffect)(()=>{let e=e=>{let t=d.current;if("Escape"===e.code&&("playing"===t.phase||"paused"===t.phase)){t.phase="playing"===t.phase?"paused":"playing",Q({phase:t.phase,timer:t.timer,shots:t.shots,hits:t.hits,score:t.score,accuracy:t.accuracy,cursor:t.cursor});return}"gameover"===t.phase&&"Space"===e.code?(es(),el()):"title"===d.current.phase&&el()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[es,el]);let ei=(0,a.useCallback)(t=>{let r=d.current;if("playing"!==r.phase||r.cursor===c)return;let n=e.current;if(!n)return;let{left:a,top:l,width:s,height:i}=n.getBoundingClientRect(),h=(t.clientX-a)/s*r.dims.width,g=(t.clientY-l)/i*r.dims.height,m=r.fish.some(e=>h>=e.x&&h<=e.x+128&&g>=e.y&&g<=e.y+128)?o:u;m!==r.cursor&&V(m)},[V]),eu=(0,a.useCallback)(t=>{var r,n;null==(r=t.preventDefault)||r.call(t);let a=d.current;if("gameover"===a.phase){es(),el();return}let l=e.current;if(!l)return void Q({phase:a.phase,timer:a.timer,shots:a.shots,hits:a.hits,score:a.score,accuracy:a.accuracy,cursor:a.cursor});let i=l.getBoundingClientRect(),o=(t.clientX-i.left)/i.width*a.dims.width,h=(t.clientY-i.top)/i.height*a.dims.height,g=J.current;if(o>=g.x&&o<=g.x+g.width&&h>=g.y&&h<=g.y+g.height){("playing"===a.phase||"paused"===a.phase)&&(a.phase="playing"===a.phase?"paused":"playing",Q({phase:a.phase,timer:a.timer,shots:a.shots,hits:a.hits,score:a.score,accuracy:a.accuracy,cursor:a.cursor}));return}if("playing"!==a.phase)return;V(c),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{V(u)},100),a.shots+=1,et(H.current,a.shots),s.play("shoot");for(let e=a.bubbles.length-1;e>=0;e--){let t=a.bubbles[e];if(o>=t.x&&o<=t.x+t.size&&h>=t.y&&h<=t.y+t.size){let[t]=a.bubbles.splice(e,1);t&&I.current.push(t),s.play("pop"),a.accuracy=a.shots>0?a.hits/a.shots*100:0,Q({phase:a.phase,timer:a.timer,shots:a.shots,hits:a.hits,score:a.score,accuracy:a.accuracy,cursor:a.cursor});return}}let m=!1;for(let e=a.fish.length-1;e>=0;e--){let t=a.fish[e];if(o>=t.x&&o<=t.x+128&&h>=t.y&&h<=t.y+128){a.hits+=1,a.hitCounts[t.kind]=(a.hitCounts[t.kind]||0)+1,et(U.current,a.hits),s.play("hit"),m=!0;let r={brown:50,grey_long_a:5,grey_long_b:5},l=(t.isSkeleton?20:null!=(n=r[t.kind])?n:10)+a.conversions;if(a.score+=l,et(z.current,a.score),"brown"===t.kind){a.timer+=3,et(F.current,a.timer,2,":"),$("+3",t.x,t.y,"#0f0");let[r]=a.fish.splice(e,1);r&&k.current.push(r),s.play("bonus")}else if("grey_long_a"===t.kind||"grey_long_b"===t.kind){a.timer+=5,et(F.current,a.timer,2,":"),$("+5",t.x,t.y,"#f00");let r=t.pairId;if(void 0!==r){let e=a.fish.filter(e=>e.pairId===r);a.fish=a.fish.filter(e=>e.pairId!==r),k.current.push(...e)}else{let[t]=a.fish.splice(e,1);t&&k.current.push(t)}s.play("bonus")}else{let r=a.fish.filter(e=>e.isSkeleton||e.pendingSkeleton).length;if(t.isSkeleton)if(t.health=Math.max(0,t.health-1),t.health>0)t.hurtTimer=10,s.play("skeleton");else{let[t]=a.fish.splice(e,1);t&&k.current.push(t),s.play("death")}else if(.5>Math.random()&&r<20)t.isSkeleton=!0,t.health=1,t.hurtTimer=0,t.frame=0,t.frameCounter=0,delete t.groupId,s.play("skeleton");else{let[t]=a.fish.splice(e,1);t&&k.current.push(t),s.play("death")}}break}}m||a.missParticles.push({x:o,y:h,radius:0,alpha:1}),a.accuracy=a.shots>0?a.hits/a.shots*100:0,Q({phase:a.phase,timer:a.timer,shots:a.shots,hits:a.hits,score:a.score,accuracy:a.accuracy,cursor:a.cursor})},[s,$,et,es,el]),ec=(0,a.useCallback)(e=>{e.preventDefault()},[]),eo=()=>1+(1-d.current.timer/99),eh=(0,a.useCallback)((e,t)=>{if("skeleton"===e)return[];let r=[],{width:n,height:a}=d.current.dims,l=["brown","grey_long_a","grey_long_b"],s=["grey_long"],i=l.includes(e)||s.includes(e),u=()=>k.current.pop()||{};i&&(t=1),t=Math.min(t,4);let c=Math.floor(4*Math.random()),o=2===c?-128:3===c?a+128:0,h=()=>{let e,t,r=eo(),n=(2*Math.random()+1)*r,a=(2*Math.random()-1)*r;switch(c){case 0:e=n,t=a;break;case 1:e=-n,t=a;break;case 2:e=a,t=n;break;default:e=a,t=-n}return _(e,t)};if(s.includes(e)){let e=x.current++,t=v.current++,{vx:l,vy:s}=h();if(0===c||1===c){let i=0===c?-256:n+256,o=Math.random()*a;["grey_long_a","grey_long_b"].forEach((n,a)=>{let h=u();h.id=g.current++,h.kind=n,h.x=i+(0===c?128*a:-(128*a)),h.y=o,h.vx=l,h.vy=s,h.angle=0,h.health=0,h.hurtTimer=0,h.isSkeleton=!1,h.groupId=e,h.pairId=t,r.push(h)})}else{let a=Math.random()*(n-256);["grey_long_a","grey_long_b"].forEach((n,i)=>{let c=u();c.id=g.current++,c.kind=n,c.x=a+128*i,c.y=o,c.vx=l,c.vy=s,c.angle=0,c.health=0,c.hurtTimer=0,c.isSkeleton=!1,c.groupId=e,c.pairId=t,r.push(c)})}}else{let s=0===c||1===c?0===c?-128:1===c?n+128:0:Math.random()*n,d=2===c||3===c?o:Math.random()*a,m=h(),f=t>1&&!l.includes(e)?x.current++:void 0;for(let l=0;l<t;l++){let t=s,o=d,h=m.vx,p=m.vy;if(void 0!==f&&l>0){0===c||1===c?(o+=(Math.random()-.5)*128,t+=0===c?-(64*Math.random()):64*Math.random()):(t+=(Math.random()-.5)*128,o+=2===c?-(64*Math.random()):64*Math.random());let e=_(h+=(Math.random()-.5)*.5,p+=(Math.random()-.5)*.5);h=e.vx,p=e.vy}else 0===c||1===c?o=Math.random()*a:t=Math.random()*n;let y=function(e,t,r,n,a,l){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=u();return i.id=g.current++,i.kind=e,i.x=t,i.y=r,i.vx=n,i.vy=a,i.frame=0,i.frameCounter=0,i.angle=0,i.health=0,i.hurtTimer=0,i.isSkeleton=!1,i.groupId=l,i.pairId=void 0,i.highlight=!!s||void 0,i.pendingSkeleton=void 0,i.flashTimer=void 0,i.wanderTimer=Math.floor(60*Math.random())+60,i}(e,t,o,h,p,f,i&&0===l);r.push(y)}}return d.current.fish.push(...r),r},[]);return(0,a.useEffect)(()=>{if("playing"!==K.phase)return;let e=["blue","green","orange","pink","red"],t=()=>{let{timer:r,conversions:n}=d.current;R.current=setTimeout(()=>{if("playing"!==d.current.phase)return;let r=Math.random();r<.1?eh("brown",1):r<.15?eh("grey_long",1):eh(e[Math.floor(Math.random()*e.length)],Math.floor(5*Math.random())+1),"playing"===d.current.phase&&t()},Math.max((1e3+2e3*Math.random())/(1+(1-r/99)+.1*n),250))};return t(),()=>{R.current&&(clearTimeout(R.current),R.current=null)}},[K.phase,eh]),(0,a.useEffect)(()=>()=>{t.current&&cancelAnimationFrame(t.current)},[]),{ui:K,canvasRef:e,handleMouseMove:ei,handleClick:eu,handleContext:ec,resetGame:es,startSplash:el,getImg:n,ready:l,spawnFish:eh}}(),[v,w]=(0,a.useState)(!1),k=(0,a.useCallback)(()=>{x?h():w(!0)},[x,h]);(0,a.useEffect)(()=>{x&&v&&(h(),w(!1))},[x,v,h]);let{phase:I}=e;return"title"===I?(0,n.jsx)(d,{onStart:k,titleSrc:i("/assets/titles/zombiefish_title.png"),backgroundColor:"#1d8fde",cursor:u}):(0,n.jsx)(g,{ui:e,canvasRef:t,handleClick:l,handleContext:s,handleMouseMove:r})}function v(){return(0,n.jsx)(l.A,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:(0,n.jsx)(x,{})})}},6567:(e,t,r)=>{Promise.resolve().then(r.bind(r,3169))}},e=>{var t=t=>e(e.s=t);e.O(0,[213,441,684,358],()=>t(6567)),_N_E=e.O()}]);